(self.webpackChunkdiscuz=self.webpackChunkdiscuz||[]).push([[859],{7859:function(e,n,r){var t,o=r(271),i=r(2653),u=r(573),a=r(2102),c=(t=r(9141))&&"object"==typeof t&&"default"in t?t.default:t,s=r(7313);function d(e,n){try{var r=e()}catch(e){return n(e)}return r&&r.then?r.then(void 0,n):r}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var f=function(){},l=function(){return Promise.resolve()},h=function(e,n){try{var r=e,t=function(){if(r.uid&&r.isAnonymous){r.displayName=null,r.photoURL="https://www.gravatar.com/avatar/"+c(e.uid)+"?d=identicon";var t=d((function(){return Promise.resolve(u.getDoc(u.doc(n,"check","requireAnonymousModeration"))).then((function(){r.canSavePost=!0,a.log("anon can save post")}))}),(function(){}));if(t&&t.then)return t.then((function(){}))}else{var o=function(){if(r.emailVerified){var e=d((function(){return Promise.resolve(u.getDoc(u.doc(n,"check","imAdmin"))).then((function(){r.isAdmin=!0,r.canSavePost=!0,a.log("admin")}))}),(function(){var e=d((function(){return Promise.resolve(u.getDoc(u.doc(n,"check","requireModeration"))).then((function(){r.canSavePost=!0,a.log("verified can save post")}))}),(function(){}));return e&&e.then?e.then((function(){})):void 0}));if(e&&e.then)return e.then((function(){}))}}();if(o&&o.then)return o.then((function(){}))}}();return Promise.resolve(t&&t.then?t.then((function(){return r})):r)}catch(e){return Promise.reject(e)}};e.exports=function(e){var n=null,r=(e.id||"discuzz")+"_auth";try{n=o.getApp(r)}catch(i){n=o.initializeApp(e,r)}var t=i.getAuth(n),c=u.getFirestore(n);return{useCurrentUser:function(){var e=s.useState(void 0),n=e[0],r=e[1];return s.useEffect((function(){if(c)return i.onAuthStateChanged(t,(function(e){try{var n=function(){if(e)return Promise.resolve(h(e,c)).then((function(e){r(e)}));r({uid:"",displayName:null,photoURL:null,emailVerified:!1,isAnonymous:!0,metadata:{},providerData:[],refreshToken:"",tenantId:"",delete:l,getIdToken:function(){return new Promise(f)},getIdTokenResult:function(){return new Promise(f)},reload:l,toJSON:function(){return{}},email:"",phoneNumber:"",providerId:""})}();return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(e){return Promise.reject(e)}}))}),[t,c]),n},useSignIn:function(){return s.useCallback((function(e){try{if(void 0===e)return Promise.resolve(i.signInAnonymously(t)).then((function(e){return h(e.user,c)}));var n=null;switch(e){case a.SignInProviderId.GOOGLE:n=new i.GoogleAuthProvider;break;case a.SignInProviderId.FACEBOOK:n=new i.FacebookAuthProvider;break;case a.SignInProviderId.TWITTER:n=new i.TwitterAuthProvider;break;case a.SignInProviderId.GITHUB:n=new i.GithubAuthProvider;break;case a.SignInProviderId.MICROSOFT:n=new i.OAuthProvider("microsoft.com");break;case a.SignInProviderId.APPLE:(n=new i.OAuthProvider("apple.com")).addScope("name"),n.addScope("email");break;case a.SignInProviderId.YAHOO:n=new i.OAuthProvider("yahoo.com")}if(null===n)throw new Error("SIGN_IN_PROVIDER_NOT_AVAILABLE");return Promise.resolve(i.signInWithPopup(t,n))}catch(e){return Promise.reject(e)}}),[t])},useSignOut:function(){return s.useCallback((function(){try{return Promise.resolve(i.signOut(t))}catch(e){return Promise.reject(e)}}),[t])},data:{app:n}}}}}]);