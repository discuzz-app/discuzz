/*! For license information please see 573.a97db9ff.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkdiscuz=self.webpackChunkdiscuz||[]).push([[573],{4766:function(e,t,n){n.d(t,{BH:function(){return p},LL:function(){return Z},ZR:function(){return A},US:function(){return f},tV:function(){return v},$s:function(){return K},Sg:function(){return y},ne:function(){return U},vZ:function(){return L},pd:function(){return V},Rd:function(){return S},m9:function(){return z},z$:function(){return m},ru:function(){return k},d:function(){return b},xb:function(){return O},w1:function(){return I},hl:function(){return x},uI:function(){return g},b$:function(){return w},G6:function(){return T},Mn:function(){return E},DO:function(){return R},xO:function(){return P},zd:function(){return F}});var r=n(7762),i=n(9439),a=n(7326),o=n(136),s=n(3668),u=n(8664),c=n(5671),l=n(3144),h=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=a>>2,h=(3&a)<<4|s>>4,f=(15&s)<<2|c>>6,d=63&c;u||(d=64,o||(f=64)),r.push(n[l],n[h],n[f],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(h(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],u=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&u)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==u)throw Error();var c=a<<2|o>>4;if(r.push(c),64!==s){var l=o<<4&240|s>>2;if(r.push(l),64!==u){var h=s<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},d=function(e){return function(e){var t=h(e);return f.encodeByteArray(t,!0)}(e).replace(/\./g,"")},v=function(e){try{return f.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};var p=function(){function e(){var t=this;(0,c.Z)(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return(0,l.Z)(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function y(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[d(JSON.stringify({alg:"none",type:"JWT"})),d(JSON.stringify(a)),""].join(".")}function m(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function g(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function k(){var e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function w(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function b(){return m().indexOf("Electron/")>=0}function I(){var e=m();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function E(){return m().indexOf("MSAppHost/")>=0}function T(){return!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function x(){return"object"===typeof indexedDB}function S(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}var A=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i){var o;return(0,c.Z)(this,n),(o=t.call(this,r)).code=e,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf((0,a.Z)(o),n.prototype),Error.captureStackTrace&&Error.captureStackTrace((0,a.Z)(o),Z.prototype.create),o}return(0,l.Z)(n)}((0,u.Z)(Error)),Z=function(){function e(t,n,r){(0,c.Z)(this,e),this.service=t,this.serviceName=n,this.errors=r}return(0,l.Z)(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?_(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,")."),o=new A(n,a,t);return o}}]),e}();function _(e,t){return e.replace(D,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}var D=/\{\$([^}]+)}/g;function C(e){return JSON.parse(e)}var N=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=C(v(a[0])||""),n=C(v(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}},R=function(e){var t=N(e).claims;return"object"===typeof t&&t.hasOwnProperty("iat")?t.iat:null};function O(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function L(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(M(s)&&M(u)){if(!L(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function M(e){return null!==e&&"object"===typeof e}function P(e){for(var t=[],n=function(){var e=(0,i.Z)(a[r],2),n=e[0],o=e[1];Array.isArray(o)?o.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))},r=0,a=Object.entries(e);r<a.length;r++)n();return t.length?"&"+t.join("&"):""}function F(e){var t={};return e.replace(/^\?/,"").split("&").forEach((function(e){if(e){var n=e.split("="),r=(0,i.Z)(n,2),a=r[0],o=r[1];t[decodeURIComponent(a)]=decodeURIComponent(o)}})),t}function V(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function U(e,t){var n=new q(e,t);return n.subscribe.bind(n)}var q=function(){function e(t,n){var r=this;(0,c.Z)(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then((function(){t(r)})).catch((function(e){r.error(e)}))}return(0,l.Z)(e,[{key:"next",value:function(e){this.forEachObserver((function(t){t.next(e)}))}},{key:"error",value:function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)}},{key:"complete",value:function(){this.forEachObserver((function(e){e.complete()})),this.close()}},{key:"subscribe",value:function(e,t,n){var i,a=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(i=function(e,t){if("object"!==typeof e||null===e)return!1;var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in e&&"function"===typeof e[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(i.next=B),void 0===i.error&&(i.error=B),void 0===i.complete&&(i.complete=B);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{a.finalError?i.error(a.finalError):i.complete()}catch(e){}})),this.observers.push(i),o}},{key:"unsubscribeOne",value:function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))}}]),e}();function B(){}var j=144e5;function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(j,r+i)}function z(e){return e&&e._delegate?e._delegate:e}},573:function(e,t,n){n.r(t),n.d(t,{AbstractUserDataWriter:function(){return Uv},Bytes:function(){return Md},CACHE_SIZE_UNLIMITED:function(){return md},CollectionReference:function(){return ud},DocumentReference:function(){return od},DocumentSnapshot:function(){return pv},FieldPath:function(){return Od},FieldValue:function(){return Pd},Firestore:function(){return gd},FirestoreError:function(){return Yr},GeoPoint:function(){return Fd},LoadBundleTask:function(){return yd},Query:function(){return sd},QueryConstraint:function(){return bv},QueryDocumentSnapshot:function(){return yv},QuerySnapshot:function(){return mv},SnapshotMetadata:function(){return vv},Timestamp:function(){return di},Transaction:function(){return op},WriteBatch:function(){return jv},_DatabaseId:function(){return Wf},_DocumentKey:function(){return Li},_EmptyAppCheckTokenProvider:function(){return oi},_EmptyAuthCredentialsProvider:function(){return $r},_FieldPath:function(){return bi},_cast:function(){return td},_debugAssert:function(){return Hr},_isBase64Available:function(){return Ei},_logWarn:function(){return jr},_validateIsNotUsedTogether:function(){return Xf},addDoc:function(){return tp},arrayRemove:function(){return hp},arrayUnion:function(){return lp},clearIndexedDbPersistence:function(){return Sd},collection:function(){return cd},collectionGroup:function(){return ld},connectFirestoreEmulator:function(){return ad},deleteDoc:function(){return ep},deleteField:function(){return up},disableNetwork:function(){return _d},doc:function(){return hd},documentId:function(){return Ld},enableIndexedDbPersistence:function(){return Ed},enableMultiTabIndexedDbPersistence:function(){return Td},enableNetwork:function(){return Zd},endAt:function(){return Lv},endBefore:function(){return Ov},ensureFirestoreConfigured:function(){return bd},executeWrite:function(){return ip},getDoc:function(){return zv},getDocFromCache:function(){return Hv},getDocFromServer:function(){return Wv},getDocs:function(){return Qv},getDocsFromCache:function(){return Yv},getDocsFromServer:function(){return Xv},getFirestore:function(){return wd},increment:function(){return fp},initializeFirestore:function(){return kd},limit:function(){return Zv},limitToLast:function(){return _v},loadBundle:function(){return Cd},namedQuery:function(){return Nd},onSnapshot:function(){return np},onSnapshotsInSync:function(){return rp},orderBy:function(){return Sv},query:function(){return Iv},queryEqual:function(){return dd},refEqual:function(){return fd},runTransaction:function(){return sp},serverTimestamp:function(){return cp},setDoc:function(){return Jv},setLogLevel:function(){return Ur},snapshotEqual:function(){return kv},startAfter:function(){return Nv},startAt:function(){return Cv},terminate:function(){return Dd},updateDoc:function(){return $v},waitForPendingWrites:function(){return Ad},where:function(){return Tv},writeBatch:function(){return dp}});var r,i=n(5647),a=n(1752),o=n(1120),s=n(9439),u=n(7762),c=n(5861),l=n(136),h=n(3668),f=n(8664),d=n(3433),v=n(5671),p=n(3144),y=n(7757),m=n.n(y),g=n(6085),k=n(2339),w=n(2413),b=n(4766),I="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},E={},T=T||{},x=I||self;function S(){}function A(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Z(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var _="closure_uid_"+(1e9*Math.random()>>>0),D=0;function C(e,t,n){return e.call.apply(e.bind,arguments)}function N(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function R(e,t,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:N).apply(null,arguments)}function O(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function L(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function M(){this.s=this.s,this.o=this.o}var P={};M.prototype.s=!1,M.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,_)&&e[_]||(e[_]=++D)}(this);delete P[e]}},M.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var F=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},V=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"===typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};function U(e){return Array.prototype.concat.apply([],arguments)}function q(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function B(e){return/^[\s\xa0]*$/.test(e)}var j,K=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function z(e,t){return-1!=e.indexOf(t)}function G(e,t){return e<t?-1:e>t?1:0}e:{var H=x.navigator;if(H){var W=H.userAgent;if(W){j=W;break e}}j=""}function Q(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Y(e){var t={};for(var n in e)t[n]=e[n];return t}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<X.length;a++)n=X[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function $(e){return $[" "](e),e}$[" "]=S;var ee,te=z(j,"Opera"),ne=z(j,"Trident")||z(j,"MSIE"),re=z(j,"Edge"),ie=re||ne,ae=z(j,"Gecko")&&!(z(j.toLowerCase(),"webkit")&&!z(j,"Edge"))&&!(z(j,"Trident")||z(j,"MSIE"))&&!z(j,"Edge"),oe=z(j.toLowerCase(),"webkit")&&!z(j,"Edge");function se(){var e=x.document;return e?e.documentMode:void 0}e:{var ue="",ce=function(){var e=j;return ae?/rv:([^\);]+)(\)|;)/.exec(e):re?/Edge\/([\d\.]+)/.exec(e):ne?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):oe?/WebKit\/(\S+)/.exec(e):te?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(ce&&(ue=ce?ce[1]:""),ne){var le=se();if(null!=le&&le>parseFloat(ue)){ee=String(le);break e}}ee=ue}var he,fe={};function de(){return function(e){var t=fe;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){for(var e=0,t=K(String(ee)).split("."),n=K("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var a=t[i]||"",o=n[i]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==a[0].length&&0==o[0].length)break;e=G(0==a[1].length?0:parseInt(a[1],10),0==o[1].length?0:parseInt(o[1],10))||G(0==a[2].length,0==o[2].length)||G(a[2],o[2]),a=a[3],o=o[3]}while(0==e)}return 0<=e}))}if(x.document&&ne){var ve=se();he=ve||(parseInt(ee,10)||void 0)}else he=void 0;var pe=he,ye=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{x.addEventListener("test",S,t),x.removeEventListener("test",S,t)}catch(n){}return e}();function me(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function ge(e,t){if(me.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ae){e:{try{$(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:ke[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ge.Z.h.call(this)}}me.prototype.h=function(){this.defaultPrevented=!0},L(ge,me);var ke={2:"touch",3:"pen",4:"mouse"};ge.prototype.h=function(){ge.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var we="closure_listenable_"+(1e6*Math.random()|0),be=0;function Ie(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++be,this.ca=this.fa=!1}function Ee(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Te(e){this.src=e,this.g={},this.h=0}function xe(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=F(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(Ee(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Se(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.ca&&a.listener==t&&a.capture==!!n&&a.ia==r)return i}return-1}Te.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=Se(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Ie(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var Ae="closure_lm_"+(1e6*Math.random()|0),Ze={};function _e(e,t,n,r,i){if(r&&r.once)return Ce(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)_e(e,t[a],n,r,i);return null}return n=Fe(n),e&&e[we]?e.N(t,n,Z(r)?!!r.capture:!!r,i):De(e,t,n,!1,r,i)}function De(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=Z(i)?!!i.capture:!!i,s=Me(e);if(s||(e[Ae]=s=new Te(e)),(n=s.add(t,n,r,o,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Le;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ye||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Oe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ce(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)Ce(e,t[a],n,r,i);return null}return n=Fe(n),e&&e[we]?e.O(t,n,Z(r)?!!r.capture:!!r,i):De(e,t,n,!0,r,i)}function Ne(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)Ne(e,t[a],n,r,i);else r=Z(r)?!!r.capture:!!r,n=Fe(n),e&&e[we]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Se(a=e.g[t],n,r,i))&&(Ee(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Me(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Se(t,n,r,i)),(n=-1<e?t[e]:null)&&Re(n))}function Re(e){if("number"!==typeof e&&e&&!e.ca){var t=e.src;if(t&&t[we])xe(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Oe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Me(t))?(xe(n,e),0==n.h&&(n.src=null,t[Ae]=null)):Ee(e)}}}function Oe(e){return e in Ze?Ze[e]:Ze[e]="on"+e}function Le(e,t){if(e.ca)e=!0;else{t=new ge(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Re(e),e=n.call(r,t)}return e}function Me(e){return(e=e[Ae])instanceof Te?e:null}var Pe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fe(e){return"function"===typeof e?e:(e[Pe]||(e[Pe]=function(t){return e.handleEvent(t)}),e[Pe])}function Ve(){M.call(this),this.i=new Te(this),this.P=this,this.I=null}function Ue(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new me(t,e);else if(t instanceof me)t.target=t.target||e;else{var i=t;J(t=new me(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=qe(o,r,!0,t)&&i}if(i=qe(o=t.g=e,r,!0,t)&&i,i=qe(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=qe(o=t.g=n[a],r,!1,t)&&i}function qe(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.ca&&o.capture==n){var s=o.listener,u=o.ia||o.src;o.fa&&xe(e.i,o),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}L(Ve,M),Ve.prototype[we]=!0,Ve.prototype.removeEventListener=function(e,t,n,r){Ne(this,e,t,n,r)},Ve.prototype.M=function(){if(Ve.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Ee(n[r]);delete t.g[e],t.h--}}this.I=null},Ve.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ve.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Be=x.JSON.stringify;function je(){var e=Xe,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Ke,ze=function(){function e(){(0,v.Z)(this,e),this.h=this.g=null}return(0,p.Z)(e,[{key:"add",value:function(e,t){var n=Ge.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),Ge=new(function(){function e(t,n){(0,v.Z)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return(0,p.Z)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())((function(){return new He}),(function(e){return e.reset()})),He=function(){function e(){(0,v.Z)(this,e),this.next=this.g=this.h=null}return(0,p.Z)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function We(e){x.setTimeout((function(){throw e}),0)}function Qe(e,t){Ke||function(){var e=x.Promise.resolve(void 0);Ke=function(){e.then(Je)}}(),Ye||(Ke(),Ye=!0),Xe.add(e,t)}var Ye=!1,Xe=new ze;function Je(){for(var e;e=je();){try{e.h.call(e.g)}catch(n){We(n)}var t=Ge;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ye=!1}function $e(e,t){Ve.call(this),this.h=e||1,this.g=t||x,this.j=R(this.kb,this),this.l=Date.now()}function et(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function tt(e,t,n){if("function"===typeof e)n&&(e=R(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=R(e.handleEvent,e)}return 2147483647<Number(t)?-1:x.setTimeout(e,t||0)}function nt(e){e.g=tt((function(){e.g=null,e.i&&(e.i=!1,nt(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}L($e,Ve),(r=$e.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ue(this,"tick"),this.da&&(et(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){$e.Z.M.call(this),et(this),delete this.g};var rt=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return(0,p.Z)(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:nt(this)}},{key:"M",value:function(){(0,a.Z)((0,o.Z)(n.prototype),"M",this).call(this),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(M);function it(e){M.call(this),this.h=e,this.g={}}L(it,M);var at=[];function ot(e,t,n,r){Array.isArray(n)||(n&&(at[0]=n.toString()),n=at);for(var i=0;i<n.length;i++){var a=_e(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function st(e){Q(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Re(e)}),e),e.g={}}function ut(){this.g=!0}function ct(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return Be(n)}catch(s){return t}}(e,n)+(r?" "+r:"")}))}it.prototype.M=function(){it.Z.M.call(this),st(this)},it.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ut.prototype.Aa=function(){this.g=!1},ut.prototype.info=function(){};var lt={},ht=null;function ft(){return ht=ht||new Ve}function dt(e){me.call(this,lt.Ma,e)}function vt(e){var t=ft();Ue(t,new dt(t,e))}function pt(e,t){me.call(this,lt.STAT_EVENT,e),this.stat=t}function yt(e){var t=ft();Ue(t,new pt(t,e))}function mt(e,t){me.call(this,lt.Na,e),this.size=t}function gt(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return x.setTimeout((function(){e()}),t)}lt.Ma="serverreachability",L(dt,me),lt.STAT_EVENT="statevent",L(pt,me),lt.Na="timingevent",L(mt,me);var kt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},wt={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function bt(){}function It(e){return e.h||(e.h=e.i())}function Et(){}bt.prototype.h=null;var Tt,xt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function St(){me.call(this,"d")}function At(){me.call(this,"c")}function Zt(){}function _t(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new it(this),this.P=Ct,e=ie?125:void 0,this.W=new $e(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Dt}function Dt(){this.i=null,this.g="",this.h=!1}L(St,me),L(At,me),L(Zt,bt),Zt.prototype.g=function(){return new XMLHttpRequest},Zt.prototype.i=function(){return{}},Tt=new Zt;var Ct=45e3,Nt={},Rt={};function Ot(e,t,n){e.K=1,e.v=rn(Xt(t)),e.s=n,e.U=!0,Lt(e,null)}function Lt(e,t){e.F=Date.now(),Vt(e),e.A=Xt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),mn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Dt,e.g=kr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new rt(R(e.Ia,e,e.g),e.O)),ot(e.V,e.g,"readystatechange",e.gb),t=e.H?Y(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),vt(1),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var o="",s=a.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Mt(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Pt(e,t,n){for(var r,i=!0;!e.I&&e.C<n.length;){if((r=Ft(e,n))==Rt){4==t&&(e.o=4,yt(14),i=!1),ct(e.j,e.m,null,"[Incomplete Response]");break}if(r==Nt){e.o=4,yt(15),ct(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}ct(e.j,e.m,r,null),Kt(e,r)}Mt(e)&&r!=Rt&&r!=Nt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,yt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),hr(t),t.L=!0,yt(11))):(ct(e.j,e.m,n,"[Invalid Chunked Response]"),jt(e),Bt(e))}function Ft(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Rt:(n=Number(t.substring(n,r)),isNaN(n)?Nt:(r+=1)+n>t.length?Rt:(t=t.substr(r,n),e.C=r+n,t))}function Vt(e){e.Y=Date.now()+e.P,Ut(e,e.P)}function Ut(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=gt(R(e.eb,e),t)}function qt(e){e.B&&(x.clearTimeout(e.B),e.B=null)}function Bt(e){0==e.l.G||e.I||vr(e.l,e)}function jt(e){qt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,et(e.W),st(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Kt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||xn(n.i,e)))if(n.I=e.N,!e.J&&xn(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;dr(n),nr(n)}lr(n),yt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=gt(R(n.ab,n),6e3));if(1>=Tn(n.i)&&n.ka){try{n.ka()}catch(a){}n.ka=void 0}}else yr(n,11)}else if((e.J||n.g==e)&&dr(n),!B(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.U=a[0],a=a[1],2==n.G)if("c"==a[0]){n.J=a[1],n.la=a[2];var o=a[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var s=a[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));var u=a[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.i;!h.g&&(z(l,"spdy")||z(l,"quic")||z(l,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(Sn(h,h.h),h.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,nn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=e;if((r=n).oa=gr(r,r.H?r.la:null,r.W),d.J){An(r.i,d);var v=d,p=r.K;p&&v.setTimeout(p),v.B&&(qt(v),Vt(v)),r.g=d}else cr(r);0<n.l.length&&ar(n)}else"stop"!=a[0]&&"close"!=a[0]||yr(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?yr(n,7):tr(n):"noop"!=a[0]&&n.j&&n.j.wa(a),n.A=0)}vt(4)}catch(a){}}function zt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(A(e)||"string"===typeof e)V(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(A(e)||"string"===typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"===typeof e)return e.split("");if(A(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length;for(var a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}}function Gt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Gt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ht(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Wt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Wt(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Wt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(r=_t.prototype).setTimeout=function(e){this.P=e},r.gb=function(e){e=e.target;var t=this.L;t&&3==Yn(e)?t.l():this.Ia(e)},r.Ia=function(e){try{if(e==this.g)e:{var t=Yn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(3!=t||ie||this.g&&(this.h.h||this.g.ga()||Xn(this.g)))){this.I||4!=t||7==n||vt(8==n||0>=r?3:2),qt(this);var i=this.g.ba();this.N=i;t:if(Mt(this)){var a=Xn(this.g);e="";var o=a.length,s=4==Yn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){jt(this),Bt(this);var u="";break t}this.h.i=new x.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,e+=this.h.i.decode(a[n],{stream:s&&n==o-1});a.splice(0,o),this.h.g+=e,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(e,t,n,r,i,a,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o}))}(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(c)){var h=c;break t}}h=null}if(!(i=h)){this.i=!1,this.o=3,yt(12),jt(this),Bt(this);break e}ct(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Kt(this,i)}this.U?(Pt(this,t,u),ie&&this.i&&3==t&&(ot(this.V,this.W,"tick",this.fb),this.W.start())):(ct(this.j,this.m,u,null),Kt(this,u)),4==t&&jt(this),this.i&&!this.I&&(4==t?vr(this.l,this):(this.i=!1,Vt(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,yt(12)):(this.o=0,yt(13)),jt(this),Bt(this)}}}catch(t){}},r.fb=function(){if(this.g){var e=Yn(this.g),t=this.g.ga();this.C<t.length&&(qt(this),Pt(this,e,t),this.i&&4!=e&&Vt(this))}},r.cancel=function(){this.I=!0,jt(this)},r.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(vt(3),yt(17)),jt(this),this.o=2,Bt(this)):Ut(this,this.Y-e)},(r=Gt.prototype).R=function(){Ht(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},r.T=function(){return Ht(this),this.g.concat()},r.get=function(e,t){return Wt(this.h,e)?this.h[e]:t},r.set=function(e,t){Wt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},r.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var Qt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Yt){this.g=void 0!==t?t:e.g,Jt(this,e.j),this.s=e.s,$t(this,e.i),en(this,e.m),this.l=e.l,t=e.h;var n=new dn;n.i=t.i,t.g&&(n.g=new Gt(t.g),n.h=t.h),tn(this,n),this.o=e.o}else e&&(n=String(e).match(Qt))?(this.g=!!t,Jt(this,n[1]||"",!0),this.s=an(n[2]||""),$t(this,n[3]||"",!0),en(this,n[4]),this.l=an(n[5]||"",!0),tn(this,n[6]||"",!0),this.o=an(n[7]||"")):(this.g=!!t,this.h=new dn(null,this.g))}function Xt(e){return new Yt(e)}function Jt(e,t,n){e.j=n?an(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function $t(e,t,n){e.i=n?an(t,!0):t}function en(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tn(e,t,n){t instanceof dn?(e.h=t,function(e,t){t&&!e.j&&(vn(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(pn(this,t),mn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=on(t,hn)),e.h=new dn(t,e.g))}function nn(e,t,n){e.h.set(t,n)}function rn(e){return nn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function an(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function on(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,sn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function sn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Yt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(on(t,un,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(on(t,un,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(on(n,"/"==n.charAt(0)?ln:cn,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",on(n,fn)),e.join("")};var un=/[#\/\?@]/g,cn=/[#\?:]/g,ln=/[#\?]/g,hn=/[#\?@]/g,fn=/#/g;function dn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function vn(e){e.g||(e.g=new Gt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function pn(e,t){vn(e),t=gn(e,t),Wt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Wt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Ht(e)))}function yn(e,t){return vn(e),t=gn(e,t),Wt(e.g.h,t)}function mn(e,t,n){pn(e,t),0<n.length&&(e.i=null,e.g.set(gn(e,t),q(n)),e.h+=n.length)}function gn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=dn.prototype).add=function(e,t){vn(this),this.i=null,e=gn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){vn(this),this.g.forEach((function(n,r){V(n,(function(n){e.call(t,n,r,this)}),this)}),this)},r.T=function(){vn(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},r.R=function(e){vn(this);var t=[];if("string"===typeof e)yn(this,e)&&(t=U(t,this.g.get(gn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=U(t,e[n])}return t},r.set=function(e,t){return vn(this),this.i=null,yn(this,e=gn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var a=0;a<r.length;a++){var o=i;""!==r[a]&&(o+="="+encodeURIComponent(String(r[a]))),e.push(o)}}return this.i=e.join("&")};var kn=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.h=t,this.g=n}));function wn(e){this.l=e||In,x.PerformanceNavigationTiming?e=0<(e=x.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(x.g&&x.g.Ea&&x.g.Ea()&&x.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var bn,In=10;function En(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Tn(e){return e.h?1:e.g?e.g.size:0}function xn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Sn(e,t){e.g?e.g.add(t):e.h=t}function An(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Zn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=(0,u.Z)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(a){r.e(a)}finally{r.f()}return n}return q(e.i)}function _n(){}function Dn(){this.g=new _n}function Cn(e,t,n){var r=n||"";try{zt(e,(function(e,n){var i=e;Z(e)&&(i=Be(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Nn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function Rn(e){this.l=e.$b||null,this.j=e.ib||!1}function On(e,t){Ve.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ln,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}wn.prototype.cancel=function(){if(this.i=Zn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=(0,u.Z)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}},_n.prototype.stringify=function(e){return x.JSON.stringify(e,void 0)},_n.prototype.parse=function(e){return x.JSON.parse(e,void 0)},L(Rn,bt),Rn.prototype.g=function(){return new On(this.l,this.j)},Rn.prototype.i=(bn={},function(){return bn}),L(On,Ve);var Ln=0;function Mn(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Pn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Fn(e)}function Fn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=On.prototype).open=function(e,t){if(this.readyState!=Ln)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Fn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||x).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pn(this)),this.readyState=Ln},r.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof x.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Mn(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Pn(this):Fn(this),3==this.readyState&&Mn(this)}},r.Ua=function(e){this.g&&(this.response=this.responseText=e,Pn(this))},r.Ta=function(e){this.g&&(this.response=e,Pn(this))},r.ha=function(){this.g&&Pn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(On.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Vn=x.JSON.parse;function Un(e){Ve.call(this),this.headers=new Gt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=qn,this.K=this.L=!1}L(Un,Ve);var qn="",Bn=/^https?$/i,jn=["POST","PUT"];function Kn(e){return"content-type"==e.toLowerCase()}function zn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Gn(e),Wn(e)}function Gn(e){e.D||(e.D=!0,Ue(e,"complete"),Ue(e,"error"))}function Hn(e){if(e.h&&"undefined"!=typeof T&&(!e.C[1]||4!=Yn(e)||2!=e.ba()))if(e.v&&4==Yn(e))tt(e.Fa,0,e);else if(Ue(e,"readystatechange"),4==Yn(e)){e.h=!1;try{var t,n=e.ba();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.H).match(Qt)[1]||null;if(!a&&x.self&&x.self.location){var o=x.self.location.protocol;a=o.substr(0,o.length-1)}i=!Bn.test(a?a.toLowerCase():"")}t=i}if(t)Ue(e,"complete"),Ue(e,"success");else{e.m=6;try{var s=2<Yn(e)?e.g.statusText:""}catch(u){s=""}e.j=s+" ["+e.ba()+"]",Gn(e)}}finally{Wn(e)}}}function Wn(e,t){if(e.g){Qn(e);var n=e.g,r=e.C[0]?S:null;e.g=null,e.C=null,t||Ue(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Qn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(x.clearTimeout(e.A),e.A=null)}function Yn(e){return e.g?e.g.readyState:0}function Xn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case qn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Jn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){var t="";return Q(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):nn(e,t,n))}function $n(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function er(e){this.za=0,this.l=[],this.h=new ut,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=$n("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=$n("baseRetryDelayMs",5e3,e),this.$a=$n("retryDelaySeedMs",1e4,e),this.Ya=$n("forwardChannelMaxRetries",2,e),this.ra=$n("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new wn(e&&e.concurrentRequestLimit),this.Ca=new Dn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function tr(e){if(rr(e),3==e.G){var t=e.V++,n=Xt(e.F);nn(n,"SID",e.J),nn(n,"RID",t),nn(n,"TYPE","terminate"),sr(e,n),(t=new _t(e,e.h,t,void 0)).K=2,t.v=rn(Xt(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(t.v.toString(),"")),!n&&x.Image&&((new Image).src=t.v,n=!0),n||(t.g=kr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Vt(t)}mr(e)}function nr(e){e.g&&(hr(e),e.g.cancel(),e.g=null)}function rr(e){nr(e),e.u&&(x.clearTimeout(e.u),e.u=null),dr(e),e.i.cancel(),e.m&&("number"===typeof e.m&&x.clearTimeout(e.m),e.m=null)}function ir(e,t){e.l.push(new kn(e.Za++,t)),3==e.G&&ar(e)}function ar(e){En(e.i)||e.m||(e.m=!0,Qe(e.Ha,e),e.C=0)}function or(e,t){var n;n=t?t.m:e.V++;var r=Xt(e.F);nn(r,"SID",e.J),nn(r,"RID",n),nn(r,"AID",e.U),sr(e,r),e.o&&e.s&&Jn(r,e.o,e.s),n=new _t(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=ur(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Sn(e.i,n),Ot(n,r,t)}function sr(e,t){e.j&&zt({},(function(e,n){nn(t,n,e)}))}function ur(e,t,n){n=Math.min(e.l.length,n);var r=e.j?R(e.j.Oa,e.j,e):null;e:for(var i=e.l,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].h,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,u=0;u<n;u++){var c=i[u].h,l=i[u].g;if(0>(c-=a))a=Math.max(0,i[u].h-100),s=!1;else try{Cn(l,o,"req"+c+"_")}catch($r){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function cr(e){e.g||e.u||(e.Y=1,Qe(e.Ga,e),e.A=0)}function lr(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=gt(R(e.Ga,e),pr(e,e.A)),e.A++,!0)}function hr(e){null!=e.B&&(x.clearTimeout(e.B),e.B=null)}function fr(e){e.g=new _t(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Xt(e.oa);nn(t,"RID","rpc"),nn(t,"SID",e.J),nn(t,"CI",e.N?"0":"1"),nn(t,"AID",e.U),sr(e,t),nn(t,"TYPE","xmlhttp"),e.o&&e.s&&Jn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=rn(Xt(t)),n.s=null,n.U=!0,Lt(n,e)}function dr(e){null!=e.v&&(x.clearTimeout(e.v),e.v=null)}function vr(e,t){var n=null;if(e.g==t){dr(e),hr(e),e.g=null;var r=2}else{if(!xn(e.i,t))return;n=t.D,An(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Ue(r=ft(),new mt(r,n,t,i)),ar(e)}else cr(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(Tn(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.l=t.D.concat(e.l),!0):!(1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya))&&(e.m=gt(R(e.Ha,e,t),pr(e,e.C)),e.C++,!0))}(e,t)||2==r&&lr(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:yr(e,5);break;case 4:yr(e,10);break;case 3:yr(e,6);break;default:yr(e,2)}}function pr(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function yr(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=R(e.jb,e);n||(n=new Yt("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||Jt(n,"https"),rn(n)),function(e,t){var n=new ut;if(x.Image){var r=new Image;r.onload=O(Nn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=O(Nn,n,r,"TestLoadImage: error",!1,t),r.onabort=O(Nn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=O(Nn,n,r,"TestLoadImage: timeout",!1,t),x.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else yt(2);e.G=0,e.j&&e.j.va(t),mr(e),rr(e)}function mr(e){e.G=0,e.I=-1,e.j&&(0==Zn(e.i).length&&0==e.l.length||(e.i.i.length=0,q(e.l),e.l.length=0),e.j.ua())}function gr(e,t,n){var r=function(e){return e instanceof Yt?Xt(e):new Yt(e,void 0)}(n);if(""!=r.i)t&&$t(r,t+"."+r.i),en(r,r.m);else{var i=x.location;r=function(e,t,n,r){var i=new Yt(null,void 0);return e&&Jt(i,e),t&&$t(i,t),n&&en(i,n),r&&(i.l=r),i}(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&Q(e.aa,(function(e,t){nn(r,t,e)})),t=e.D,n=e.sa,t&&n&&nn(r,t,n),nn(r,"VER",e.ma),sr(e,r),r}function kr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Un(new Rn({ib:!0})):new Un(e.qa)).L=e.H,t}function wr(){}function br(){if(ne&&!(10<=Number(pe)))throw Error("Environmental error: no available transport.")}function Ir(e,t){Ve.call(this),this.g=new er(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!B(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!B(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new xr(this)}function Er(e){St.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Tr(){At.call(this),this.status=1}function xr(e){this.g=e}(r=Un.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Tt.g(),this.C=this.u?It(this.u):It(Tt),this.g.onreadystatechange=R(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(a){return void zn(this,a)}e=n||"";var i=new Gt(this.headers);r&&zt(r,(function(e,t){i.set(t,e)})),r=function(e){e:{for(var t=Kn,n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(i.T()),n=x.FormData&&e instanceof x.FormData,!(0<=F(jn,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Qn(this),0<this.B&&((this.K=function(e){return ne&&de()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=R(this.pa,this)):this.A=tt(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(a){zn(this,a)}},r.pa=function(){"undefined"!=typeof T&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ue(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ue(this,"complete"),Ue(this,"abort"),Wn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Wn(this,!0)),Un.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?Hn(this):this.cb())},r.cb=function(){Hn(this)},r.ba=function(){try{return 2<Yn(this)?this.g.status:-1}catch(bn){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(bn){return""}},r.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Vn(t)}},r.Da=function(){return this.m},r.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=er.prototype).ma=8,r.G=1,r.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},r.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new _t(this,this.h,e,void 0),n=this.s;if(this.P&&(n?J(n=Y(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var a=this.l[i];if(void 0===(a="__data__"in a.g&&"string"===typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=ur(this,t,r),nn(i=Xt(this.F),"RID",e),nn(i,"CVER",22),this.D&&nn(i,"X-HTTP-Session-Id",this.D),sr(this,i),this.o&&n&&Jn(i,this.o,n),Sn(this.i,t),this.Ra&&nn(i,"TYPE","init"),this.ja?(nn(i,"$req",r),nn(i,"SID","null"),t.$=!0,Ot(t,i,null)):Ot(t,i,r),this.G=2}}else 3==this.G&&(e?or(this,e):0==this.l.length||En(this.i)||or(this))},r.Ga=function(){if(this.u=null,fr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=gt(R(this.bb,this),e)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,yt(10),nr(this),fr(this))},r.ab=function(){null!=this.v&&(this.v=null,nr(this),lr(this),yt(19))},r.jb=function(e){e?(this.h.info("Successfully pinged google.com"),yt(2)):(this.h.info("Failed to ping google.com"),yt(1))},(r=wr.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},br.prototype.g=function(e,t){return new Ir(e,t)},L(Ir,Ve),Ir.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Qe(R(e.hb,e,t))),yt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=gr(e,null,e.W),ar(e)},Ir.prototype.close=function(){tr(this.g)},Ir.prototype.u=function(e){if("string"===typeof e){var t={};t.__data__=e,ir(this.g,t)}else this.v?((t={}).__data__=Be(e),ir(this.g,t)):ir(this.g,e)},Ir.prototype.M=function(){this.g.j=null,delete this.j,tr(this.g),delete this.g,Ir.Z.M.call(this)},L(Er,St),L(Tr,At),L(xr,wr),xr.prototype.xa=function(){Ue(this.g,"a")},xr.prototype.wa=function(e){Ue(this.g,new Er(e))},xr.prototype.va=function(e){Ue(this.g,new Tr(e))},xr.prototype.ua=function(){Ue(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,Ir.prototype.send=Ir.prototype.u,Ir.prototype.open=Ir.prototype.m,Ir.prototype.close=Ir.prototype.close,kt.NO_ERROR=0,kt.TIMEOUT=8,kt.HTTP_ERROR=6,wt.COMPLETE="complete",Et.EventType=xt,xt.OPEN="a",xt.CLOSE="b",xt.ERROR="c",xt.MESSAGE="d",Ve.prototype.listen=Ve.prototype.N,Un.prototype.listenOnce=Un.prototype.O,Un.prototype.getLastError=Un.prototype.La,Un.prototype.getLastErrorCode=Un.prototype.Da,Un.prototype.getStatus=Un.prototype.ba,Un.prototype.getResponseJson=Un.prototype.Qa,Un.prototype.getResponseText=Un.prototype.ga,Un.prototype.send=Un.prototype.ea;var Sr=E.createWebChannelTransport=function(){return new br},Ar=E.getStatEventTarget=function(){return ft()},Zr=E.ErrorCode=kt,_r=E.EventType=wt,Dr=E.Event=lt,Cr=E.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Nr=E.FetchXmlHttpFactory=Rn,Rr=E.WebChannel=Et,Or=E.XhrIo=Un,Lr="@firebase/firestore",Mr=function(){function e(t){(0,v.Z)(this,e),this.uid=t}return(0,p.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();Mr.UNAUTHENTICATED=new Mr(null),Mr.GOOGLE_CREDENTIALS=new Mr("google-credentials-uid"),Mr.FIRST_PARTY=new Mr("first-party-uid"),Mr.MOCK_USER=new Mr("mock-user");var Pr="9.6.1",Fr=new w.Yd("@firebase/firestore");function Vr(){return Fr.logLevel}function Ur(e){Fr.setLogLevel(e)}function qr(e){if(Fr.logLevel<=w.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Kr);Fr.debug.apply(Fr,["Firestore (".concat(Pr,"): ").concat(e)].concat((0,d.Z)(i)))}}function Br(e){if(Fr.logLevel<=w.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Kr);Fr.error.apply(Fr,["Firestore (".concat(Pr,"): ").concat(e)].concat((0,d.Z)(i)))}}function jr(e){if(Fr.logLevel<=w.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Kr);Fr.warn.apply(Fr,["Firestore (".concat(Pr,"): ").concat(e)].concat((0,d.Z)(i)))}}function Kr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function zr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(Pr,") INTERNAL ASSERTION FAILED: ")+e;throw Br(t),new Error(t)}function Gr(e,t){e||zr()}function Hr(e,t){e||zr()}function Wr(e,t){return e}var Qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Yr=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,r)).code=e,i.message=r,i.name="FirebaseError",i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,p.Z)(n)}((0,f.Z)(Error)),Xr=(0,p.Z)((function e(){var t=this;(0,v.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),Jr=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),$r=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Mr.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),ei=function(){function e(t){(0,v.Z)(this,e),this.token=t,this.changeListener=null}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),ti=function(){function e(t){(0,v.Z)(this,e),this.t=t,this.currentUser=Mr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,p.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new Xr;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new Xr,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){qr("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(qr("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Xr)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(qr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Gr("string"==typeof n.accessToken),new Jr(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Gr(null===e||"string"==typeof e),new Mr(e)}}]),e}(),ni=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.type="FirstParty",this.user=Mr.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)})),ri=function(){function e(t,n,r){(0,v.Z)(this,e),this.h=t,this.l=n,this.m=r}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new ni(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Mr.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),ii=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),ai=function(){function e(t){(0,v.Z)(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null}return(0,p.Z)(e,[{key:"start",value:function(e,t){var n=this;this.o=function(n){e.enqueueRetryable((function(){return function(e){return null!=e.error&&qr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message)),t(e.token)}(n)}))};var r=function(e){qr("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit((function(e){return r(e)})),setTimeout((function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?r(e):qr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((function(e){return e?(Gr("string"==typeof e.token),new ii(e.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),oi=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new ii(""))}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){}},{key:"shutdown",value:function(){}}]),e}(),si=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.p(e)},this.T=function(e){return n.writeSequenceNumber(e)})}return(0,p.Z)(e,[{key:"p",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.T&&this.T(e),e}}]),e}();function ui(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}si.I=-1;var ci=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,null,[{key:"A",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=ui(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function li(e,t){return e<t?-1:e>t?1:0}function hi(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function fi(e){return e+"\0"}var di=function(){function e(t,n){if((0,v.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new Yr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Yr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new Yr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Yr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,p.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?li(this.nanoseconds,e.nanoseconds):li(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),vi=function(){function e(t){(0,v.Z)(this,e),this.timestamp=t}return(0,p.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new di(0,0))}}]),e}();function pi(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function yi(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function mi(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var gi=function(){function e(t,n,r){(0,v.Z)(this,e),void 0===n?n=0:n>t.length&&zr(),void 0===r?r=t.length-n:r>t.length-n&&zr(),this.segments=t,this.offset=n,this.len=r}return(0,p.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ki=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var s=o[a];if(s.indexOf("//")>=0)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,(0,d.Z)(s.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(gi),wi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,bi=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return wi.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var s=e[i];if("\\"===s){if(i+1===e.length)throw new Yr(Qr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Yr(Qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===s?(o=!o,i++):"."!==s||o?(r+=s,i++):(a(),i++)}if(a(),o)throw new Yr(Qr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(gi),Ii=function(){function e(t){(0,v.Z)(this,e),this.fields=t,t.sort(bi.comparator)}return(0,p.Z)(e,[{key:"covers",value:function(e){var t,n=(0,u.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return hi(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}]),e}();function Ei(){return"undefined"!=typeof atob}var Ti=function(){function e(t){(0,v.Z)(this,e),this.binaryString=t}return(0,p.Z)(e,[{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return li(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(t){return new e(atob(t))}},{key:"fromUint8Array",value:function(t){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t);return new e(n)}}]),e}();Ti.EMPTY_BYTE_STRING=new Ti("");var xi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Si(e){if(Gr(!!e),"string"==typeof e){var t=0,n=xi.exec(e);if(Gr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Ai(e.seconds),nanos:Ai(e.nanos)}}function Ai(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Zi(e){return"string"==typeof e?Ti.fromBase64String(e):Ti.fromUint8Array(e)}function _i(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Di(e){var t=e.mapValue.fields.__previous_value__;return _i(t)?Di(t):t}function Ci(e){var t=Si(e.mapValue.fields.__local_write_time__.timestampValue);return new di(t.seconds,t.nanos)}function Ni(e){return null==e}function Ri(e){return 0===e&&1/e==-1/0}function Oi(e){return"number"==typeof e&&Number.isInteger(e)&&!Ri(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var Li=function(){function e(t){(0,v.Z)(this,e),this.path=t}return(0,p.Z)(e,[{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"isEqual",value:function(e){return null!==e&&0===ki.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ki.fromString(t))}},{key:"fromName",value:function(t){return new e(ki.fromString(t).popFirst(5))}},{key:"comparator",value:function(e,t){return ki.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ki(t.slice()))}}]),e}();function Mi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?_i(e)?4:10:zr()}function Pi(e,t){var n=Mi(e);if(n!==Mi(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ci(e).isEqual(Ci(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Si(e.timestampValue),r=Si(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Zi(e.bytesValue).isEqual(Zi(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ai(e.geoPointValue.latitude)===Ai(t.geoPointValue.latitude)&&Ai(e.geoPointValue.longitude)===Ai(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ai(e.integerValue)===Ai(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Ai(e.doubleValue),r=Ai(t.doubleValue);return n===r?Ri(n)===Ri(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return hi(e.arrayValue.values||[],t.arrayValue.values||[],Pi);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(pi(n)!==pi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Pi(n[i],r[i])))return!1;return!0}(e,t);default:return zr()}}function Fi(e,t){return void 0!==(e.values||[]).find((function(e){return Pi(e,t)}))}function Vi(e,t){var n=Mi(e),r=Mi(t);if(n!==r)return li(n,r);switch(n){case 0:return 0;case 1:return li(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=Ai(e.integerValue||e.doubleValue),r=Ai(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ui(e.timestampValue,t.timestampValue);case 4:return Ui(Ci(e),Ci(t));case 5:return li(e.stringValue,t.stringValue);case 6:return function(e,t){var n=Zi(e),r=Zi(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=li(n[i],r[i]);if(0!==a)return a}return li(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=li(Ai(e.latitude),Ai(t.latitude));return 0!==n?n:li(Ai(e.longitude),Ai(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=Vi(n[i],r[i]);if(a)return a}return li(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var s=li(r[o],a[o]);if(0!==s)return s;var u=Vi(n[r[o]],i[a[o]]);if(0!==u)return u}return li(r.length,a.length)}(e.mapValue,t.mapValue);default:throw zr()}}function Ui(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return li(e,t);var n=Si(e),r=Si(t),i=li(n.seconds,r.seconds);return 0!==i?i:li(n.nanos,r.nanos)}function qi(e){return Bi(e)}function Bi(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=Si(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Zi(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Li.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=(0,u.Z)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=Bi(a)}}catch(o){i.e(o)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=(0,u.Z)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i?i=!1:r+=",",r+="".concat(o,":").concat(Bi(e.fields[o]))}}catch(s){a.e(s)}finally{a.f()}return r+"}"}(e.mapValue):zr();var t,n}function ji(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Ki(e){return!!e&&"integerValue"in e}function zi(e){return!!e&&"arrayValue"in e}function Gi(e){return!!e&&"nullValue"in e}function Hi(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Wi(e){return!!e&&"mapValue"in e}function Qi(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return yi(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Qi(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Qi(e.arrayValue.values[r]);return n}return Object.assign({},e)}var Yi=function(){function e(t){(0,v.Z)(this,e),this.value=t}return(0,p.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Wi(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qi(t)}},{key:"setAll",value:function(e){var t=this,n=bi.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Qi(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Wi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Pi(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Wi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){yi(t,(function(t,n){return e[t]=n}));var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(o){i.e(o)}finally{i.f()}}},{key:"clone",value:function(){return new e(Qi(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Xi(e){var t=[];return yi(e.fields,(function(e,n){var r=new bi([e]);if(Wi(n)){var i=Xi(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=(0,u.Z)(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.push(r.child(s))}}catch(c){o.e(c)}finally{o.f()}}}else t.push(r)})),new Ii(t)}var Ji=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=a}return(0,p.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Yi.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Yi.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"clone",value:function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,vi.min(),Yi.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,Yi.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,Yi.empty(),2)}}]),e}(),$i=(0,p.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,v.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=s,this.R=null}));function ea(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new $i(e,t,n,r,i,a,o)}function ta(e){var t=Wr(e);if(null===t.R){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return function(e){return e.field.canonicalString()+e.op.toString()+qi(e.value)}(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),Ni(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=va(t.startAt)),t.endAt&&(n+="|ub:",n+=va(t.endAt)),t.R=n}return t.R}function na(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!ya(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!Pi(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ga(e.startAt,t.startAt)&&ga(e.endAt,t.endAt)}function ra(e){return Li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ia=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Vi(t,this.value)):null!==t&&Mi(this.value)===Mi(t)&&this.v(Vi(t,this.value))}},{key:"v",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return zr()}}},{key:"V",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,r):new aa(e,t,r):"array-contains"===t?new ca(e,r):"in"===t?new la(e,r):"not-in"===t?new ha(e,r):"array-contains-any"===t?new fa(e,r):new n(e,t,r)}},{key:"P",value:function(e,t,n){return"in"===t?new oa(e,n):new sa(e,n)}}]),n}(function(){return(0,p.Z)((function e(){(0,v.Z)(this,e)}))}());var aa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,i)).key=Li.fromName(i.referenceValue),a}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=Li.comparator(e.key,this.key);return this.v(t)}}]),n}(ia),oa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,"in",r)).keys=ua("in",r),i}return(0,p.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(ia),sa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=ua("not-in",r),i}return(0,p.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(ia);function ua(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return Li.fromName(e.referenceValue)}))}var ca=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return zi(t)&&Fi(t.arrayValue,this.value)}}]),n}(ia),la=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"in",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Fi(this.value.arrayValue,t)}}]),n}(ia),ha=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"not-in",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){if(Fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Fi(this.value.arrayValue,t)}}]),n}(ia),fa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!zi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Fi(t.value.arrayValue,e)}))}}]),n}(ia),da=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.position=t,this.before=n}));function va(e){return"".concat(e.before?"b":"a",":").concat(e.position.map((function(e){return qi(e)})).join(","))}var pa=(0,p.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,v.Z)(this,e),this.field=t,this.dir=n}));function ya(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ma(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?Li.comparator(Li.fromName(o.referenceValue),n.key):Vi(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function ga(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Pi(e.position[n],t.position[n]))return!1;return!0}var ka=(0,p.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,v.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=s,this.endAt=u,this.S=null,this.D=null,this.startAt,this.endAt}));function wa(e,t,n,r,i,a,o,s){return new ka(e,t,n,r,i,a,o,s)}function ba(e){return new ka(e)}function Ia(e){return!Ni(e.limit)&&"F"===e.limitType}function Ea(e){return!Ni(e.limit)&&"L"===e.limitType}function Ta(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function xa(e){var t,n=(0,u.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.V())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function Sa(e){return null!==e.collectionGroup}function Aa(e){var t=Wr(e);if(null===t.S){t.S=[];var n=xa(t),r=Ta(t);if(null!==n&&null===r)n.isKeyField()||t.S.push(new pa(n)),t.S.push(new pa(bi.keyField(),"asc"));else{var i,a=!1,o=(0,u.Z)(t.explicitOrderBy);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.S.push(s),s.field.isKeyField()&&(a=!0)}}catch(l){o.e(l)}finally{o.f()}if(!a){var c=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new pa(bi.keyField(),c))}}}return t.S}function Za(e){var t=Wr(e);if(!t.D)if("F"===t.limitType)t.D=ea(t.path,t.collectionGroup,Aa(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=(0,u.Z)(Aa(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o="desc"===a.dir?"asc":"desc";r.push(new pa(a.field,o))}}catch(l){i.e(l)}finally{i.f()}var s=t.endAt?new da(t.endAt.position,!t.endAt.before):null,c=t.startAt?new da(t.startAt.position,!t.startAt.before):null;t.D=ea(t.path,t.collectionGroup,r,t.filters,t.limit,s,c)}return t.D}function _a(e,t,n){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Da(e,t){return na(Za(e),Za(t))&&e.limitType===t.limitType}function Ca(e){return"".concat(ta(Za(e)),"|lt:").concat(e.limitType)}function Na(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(qi(t.value));var t})).join(", "),"]")),Ni(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: "+va(e.startAt)),e.endAt&&(t+=", endAt: "+va(e.endAt)),"Target(".concat(t,")")}(Za(e)),"; limitType=").concat(e.limitType,")")}function Ra(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Li.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=(0,u.Z)(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=(0,u.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!ma(e.startAt,Aa(e),t))&&(!e.endAt||!ma(e.endAt,Aa(e),t))}(e,t)}function Oa(e){return function(t,n){var r,i=!1,a=(0,u.Z)(Aa(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=La(o,t,n);if(0!==s)return s;i=i||o.field.isKeyField()}}catch(c){a.e(c)}finally{a.f()}return 0}}function La(e,t,n){var r=e.field.isKeyField()?Li.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Vi(r,i):zr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return zr()}}function Ma(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ri(t)?"-0":t}}function Pa(e){return{integerValue:""+e}}function Fa(e,t){return Oi(t)?Pa(t):Ma(e,t)}var Va=(0,p.Z)((function e(){(0,v.Z)(this,e),this._=void 0}));function Ua(e,t,n){return e instanceof ja?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Ka?za(e,t):e instanceof Ga?Ha(e,t):function(e,t){var n=Ba(e,t),r=Qa(n)+Qa(e.N);return Ki(n)&&Ki(e.N)?Pa(r):Ma(e.k,r)}(e,t)}function qa(e,t,n){return e instanceof Ka?za(e,t):e instanceof Ga?Ha(e,t):n}function Ba(e,t){return e instanceof Wa?Ki(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var ja=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n)}(Va),Ka=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,p.Z)(n)}(Va);function za(e,t){var n,r=Ya(t),i=(0,u.Z)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Pi(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Ga=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,p.Z)(n)}(Va);function Ha(e,t){var n,r=Ya(t),i=(0,u.Z)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Pi(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Wa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).k=e,i.N=r,i}return(0,p.Z)(n)}(Va);function Qa(e){return Ai(e.integerValue||e.doubleValue)}function Ya(e){return zi(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Xa=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.field=t,this.transform=n}));var Ja=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.version=t,this.transformResults=n})),$a=function(){function e(t,n){(0,v.Z)(this,e),this.updateTime=t,this.exists=n}return(0,p.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function eo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var to=(0,p.Z)((function e(){(0,v.Z)(this,e)}));function no(e,t,n){e instanceof so?function(e,t,n){var r=e.value.clone(),i=lo(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof uo?function(e,t,n){if(eo(e.precondition,t)){var r=lo(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(co(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ro(e,t,n){e instanceof so?function(e,t,n){if(eo(e.precondition,t)){var r=e.value.clone(),i=ho(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(oo(t),r).setHasLocalMutations()}}(e,t,n):e instanceof uo?function(e,t,n){if(eo(e.precondition,t)){var r=ho(e.fieldTransforms,n,t),i=t.data;i.setAll(co(e)),i.setAll(r),t.convertToFoundDocument(oo(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){eo(e.precondition,t)&&t.convertToNoDocument(vi.min())}(e,t)}function io(e,t){var n,r=null,i=(0,u.Z)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),s=Ba(a.transform,o||null);null!=s&&(null==r&&(r=Yi.empty()),r.set(a.field,s))}}catch(c){i.e(c)}finally{i.f()}return r||null}function ao(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&hi(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ka&&t instanceof Ka||e instanceof Ga&&t instanceof Ga?hi(e.elements,t.elements,Pi):e instanceof Wa&&t instanceof Wa?Pi(e.N,t.N):e instanceof ja&&t instanceof ja}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function oo(e){return e.isFoundDocument()?e.version:vi.min()}var so=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,v.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return(0,p.Z)(n)}(to),uo=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,v.Z)(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=s,o.type=1,o}return(0,p.Z)(n)}(to);function co(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function lo(e,t,n){var r=new Map;Gr(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,qa(o,s,n[i]))}return r}function ho(e,t,n){var r,i=new Map,a=(0,u.Z)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.transform,c=n.data.field(o.field);i.set(o.field,Ua(s,c,t))}}catch(l){a.e(l)}finally{a.f()}return i}var fo,vo,po=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,p.Z)(n)}(to),yo=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,p.Z)(n)}(to),mo=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.count=t}));function go(e){switch(e){default:return zr();case Qr.CANCELLED:case Qr.UNKNOWN:case Qr.DEADLINE_EXCEEDED:case Qr.RESOURCE_EXHAUSTED:case Qr.INTERNAL:case Qr.UNAVAILABLE:case Qr.UNAUTHENTICATED:return!1;case Qr.INVALID_ARGUMENT:case Qr.NOT_FOUND:case Qr.ALREADY_EXISTS:case Qr.PERMISSION_DENIED:case Qr.FAILED_PRECONDITION:case Qr.ABORTED:case Qr.OUT_OF_RANGE:case Qr.UNIMPLEMENTED:case Qr.DATA_LOSS:return!0}}function ko(e){if(void 0===e)return Br("GRPC error has no .code"),Qr.UNKNOWN;switch(e){case fo.OK:return Qr.OK;case fo.CANCELLED:return Qr.CANCELLED;case fo.UNKNOWN:return Qr.UNKNOWN;case fo.DEADLINE_EXCEEDED:return Qr.DEADLINE_EXCEEDED;case fo.RESOURCE_EXHAUSTED:return Qr.RESOURCE_EXHAUSTED;case fo.INTERNAL:return Qr.INTERNAL;case fo.UNAVAILABLE:return Qr.UNAVAILABLE;case fo.UNAUTHENTICATED:return Qr.UNAUTHENTICATED;case fo.INVALID_ARGUMENT:return Qr.INVALID_ARGUMENT;case fo.NOT_FOUND:return Qr.NOT_FOUND;case fo.ALREADY_EXISTS:return Qr.ALREADY_EXISTS;case fo.PERMISSION_DENIED:return Qr.PERMISSION_DENIED;case fo.FAILED_PRECONDITION:return Qr.FAILED_PRECONDITION;case fo.ABORTED:return Qr.ABORTED;case fo.OUT_OF_RANGE:return Qr.OUT_OF_RANGE;case fo.UNIMPLEMENTED:return Qr.UNIMPLEMENTED;case fo.DATA_LOSS:return Qr.DATA_LOSS;default:return zr()}}(vo=fo||(fo={}))[vo.OK=0]="OK",vo[vo.CANCELLED=1]="CANCELLED",vo[vo.UNKNOWN=2]="UNKNOWN",vo[vo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vo[vo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vo[vo.NOT_FOUND=5]="NOT_FOUND",vo[vo.ALREADY_EXISTS=6]="ALREADY_EXISTS",vo[vo.PERMISSION_DENIED=7]="PERMISSION_DENIED",vo[vo.UNAUTHENTICATED=16]="UNAUTHENTICATED",vo[vo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vo[vo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vo[vo.ABORTED=10]="ABORTED",vo[vo.OUT_OF_RANGE=11]="OUT_OF_RANGE",vo[vo.UNIMPLEMENTED=12]="UNIMPLEMENTED",vo[vo.INTERNAL=13]="INTERNAL",vo[vo.UNAVAILABLE=14]="UNAVAILABLE",vo[vo.DATA_LOSS=15]="DATA_LOSS";var wo=function(){function e(t,n){(0,v.Z)(this,e),this.comparator=t,this.root=n||Io.EMPTY}return(0,p.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Io.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Io.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new bo(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new bo(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new bo(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new bo(this.root,e,this.comparator,!0)}}]),e}(),bo=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,p.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Io=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,p.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw zr();if(this.right.isRed())throw zr();var e=this.left.check();if(e!==this.right.check())throw zr();return e+(this.isRed()?0:1)}}]),e}();Io.EMPTY=null,Io.RED=!0,Io.BLACK=!1,Io.EMPTY=new(function(){function e(){(0,v.Z)(this,e),this.size=0}return(0,p.Z)(e,[{key:"key",get:function(){throw zr()}},{key:"value",get:function(){throw zr()}},{key:"color",get:function(){throw zr()}},{key:"left",get:function(){throw zr()}},{key:"right",get:function(){throw zr()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Io(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Eo=function(){function e(t){(0,v.Z)(this,e),this.comparator=t,this.data=new wo(this.comparator)}return(0,p.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new To(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new To(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),To=function(){function e(t){(0,v.Z)(this,e),this.iter=t}return(0,p.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),xo=new wo(Li.comparator);function So(){return xo}var Ao=new wo(Li.comparator);function Zo(){return Ao}var _o=new wo(Li.comparator);function Do(){return _o}var Co=new Eo(Li.comparator);function No(){for(var e=Co,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var Ro=new Eo(li);function Oo(){return Ro}var Lo=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,p.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,Mo.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(vi.min(),r,Oo(),So(),No())}}]),e}(),Mo=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,p.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(Ti.EMPTY_BYTE_STRING,n,No(),No(),No())}}]),e}(),Po=(0,p.Z)((function e(t,n,r,i){(0,v.Z)(this,e),this.$=t,this.removedTargetIds=n,this.key=r,this.F=i})),Fo=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.targetId=t,this.O=n})),Vo=(0,p.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ti.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,v.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),Uo=function(){function e(){(0,v.Z)(this,e),this.M=0,this.L=jo(),this.B=Ti.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}return(0,p.Z)(e,[{key:"current",get:function(){return this.U}},{key:"resumeToken",get:function(){return this.B}},{key:"K",get:function(){return 0!==this.M}},{key:"j",get:function(){return this.q}},{key:"W",value:function(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}},{key:"G",value:function(){var e=No(),t=No(),n=No();return this.L.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:zr()}})),new Mo(this.B,this.U,e,t,n)}},{key:"H",value:function(){this.q=!1,this.L=jo()}},{key:"J",value:function(e,t){this.q=!0,this.L=this.L.insert(e,t)}},{key:"Y",value:function(e){this.q=!0,this.L=this.L.remove(e)}},{key:"X",value:function(){this.M+=1}},{key:"Z",value:function(){this.M-=1}},{key:"tt",value:function(){this.q=!0,this.U=!0}}]),e}(),qo=function(){function e(t){(0,v.Z)(this,e),this.et=t,this.nt=new Map,this.st=So(),this.it=Bo(),this.rt=new Eo(li)}return(0,p.Z)(e,[{key:"ot",value:function(e){var t,n=(0,u.Z)(e.$);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.F&&e.F.isFoundDocument()?this.at(r,e.F):this.ct(r,e.key,e.F)}}catch(s){n.e(s)}finally{n.f()}var i,a=(0,u.Z)(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.ct(o,e.key,e.F)}}catch(s){a.e(s)}finally{a.f()}}},{key:"ut",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.ht(n);switch(e.state){case 0:t.lt(n)&&r.W(e.resumeToken);break;case 1:r.Z(),r.K||r.H(),r.W(e.resumeToken);break;case 2:r.Z(),r.K||t.removeTarget(n);break;case 3:t.lt(n)&&(r.tt(),r.W(e.resumeToken));break;case 4:t.lt(n)&&(t.ft(n),r.W(e.resumeToken));break;default:zr()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((function(e,r){n.lt(r)&&t(r)}))}},{key:"dt",value:function(e){var t=e.targetId,n=e.O.count,r=this.wt(t);if(r){var i=r.target;if(ra(i))if(0===n){var a=new Li(i.path);this.ct(t,a,Ji.newNoDocument(a,vi.min()))}else Gr(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}},{key:"gt",value:function(e){var t=this,n=new Map;this.nt.forEach((function(r,i){var a=t.wt(i);if(a){if(r.current&&ra(a.target)){var o=new Li(a.target.path);null!==t.st.get(o)||t.yt(i,o)||t.ct(i,o,Ji.newNoDocument(o,e))}r.j&&(n.set(i,r.G()),r.H())}}));var r=No();this.it.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.wt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))}));var i=new Lo(e,n,this.rt,this.st,r);return this.st=So(),this.it=Bo(),this.rt=new Eo(li),i}},{key:"at",value:function(e,t){if(this.lt(e)){var n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}}},{key:"ct",value:function(e,t,n){if(this.lt(e)){var r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}}},{key:"removeTarget",value:function(e){this.nt.delete(e)}},{key:"_t",value:function(e){var t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"X",value:function(e){this.ht(e).X()}},{key:"ht",value:function(e){var t=this.nt.get(e);return t||(t=new Uo,this.nt.set(e,t)),t}},{key:"Tt",value:function(e){var t=this.it.get(e);return t||(t=new Eo(li),this.it=this.it.insert(e,t)),t}},{key:"lt",value:function(e){var t=null!==this.wt(e);return t||qr("WatchChangeAggregator","Detected inactive target",e),t}},{key:"wt",value:function(e){var t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}},{key:"ft",value:function(e){var t=this;this.nt.set(e,new Uo),this.et.getRemoteKeysForTarget(e).forEach((function(n){t.ct(e,n,null)}))}},{key:"yt",value:function(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}]),e}();function Bo(){return new wo(Li.comparator)}function jo(){return new wo(Li.comparator)}var Ko={asc:"ASCENDING",desc:"DESCENDING"},zo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Go=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.databaseId=t,this.C=n}));function Ho(e,t){return e.C?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Wo(e,t){return e.C?t.toBase64():t.toUint8Array()}function Qo(e,t){return Ho(e,t.toTimestamp())}function Yo(e){return Gr(!!e),vi.fromTimestamp(function(e){var t=Si(e);return new di(t.seconds,t.nanos)}(e))}function Xo(e,t){return function(e){return new ki(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Jo(e){var t=ki.fromString(e);return Gr(Es(t)),t}function $o(e,t){return Xo(e.databaseId,t.path)}function es(e,t){var n=Jo(t);if(n.get(1)!==e.databaseId.projectId)throw new Yr(Qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Yr(Qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Li(is(n))}function ts(e,t){return Xo(e.databaseId,t)}function ns(e){var t=Jo(e);return 4===t.length?ki.emptyPath():is(t)}function rs(e){return new ki(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function is(e){return Gr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function as(e,t,n){return{name:$o(e,t),fields:n.value.mapValue.fields}}function os(e,t,n){var r=es(e,t.name),i=Yo(t.updateTime),a=new Yi({mapValue:{fields:t.fields}}),o=Ji.newFoundDocument(r,i,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ss(e,t){return"found"in t?function(e,t){Gr(!!t.found),t.found.name,t.found.updateTime;var n=es(e,t.found.name),r=Yo(t.found.updateTime),i=new Yi({mapValue:{fields:t.found.fields}});return Ji.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Gr(!!t.missing),Gr(!!t.readTime);var n=es(e,t.missing),r=Yo(t.readTime);return Ji.newNoDocument(n,r)}(e,t):zr()}function us(e,t){var n;if(t instanceof so)n={update:as(e,t.key,t.value)};else if(t instanceof po)n={delete:$o(e,t.key)};else if(t instanceof uo)n={update:as(e,t.key,t.data),updateMask:Is(t.fieldMask)};else{if(!(t instanceof yo))return zr();n={verify:$o(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof ja)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ka)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ga)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Wa)return{fieldPath:t.field.canonicalString(),increment:n.N};throw zr()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Qo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zr()}(e,t.precondition)),n}function cs(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?$a.updateTime(Yo(e.updateTime)):void 0!==e.exists?$a.exists(e.exists):$a.none()}(t.currentDocument):$a.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)Gr("REQUEST_TIME"===t.setToServerValue),n=new ja;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Ka(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Ga(i)}else"increment"in t?n=new Wa(e,t.increment):zr();var a=bi.fromServerFormat(t.fieldPath);return new Xa(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=es(e,t.update.name),a=new Yi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=function(e){var t=e.fieldPaths||[];return new Ii(t.map((function(e){return bi.fromServerFormat(e)})))}(t.updateMask);return new uo(i,a,o,n,r)}return new so(i,a,n,r)}if(t.delete){var s=es(e,t.delete);return new po(s,n)}if(t.verify){var u=es(e,t.verify);return new yo(u,n)}return zr()}function ls(e,t){return{documents:[ts(e,t.path)]}}function hs(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=ts(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=ts(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(Hi(e.value))return{unaryFilter:{field:gs(e.field),op:"IS_NAN"}};if(Gi(e.value))return{unaryFilter:{field:gs(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Hi(e.value))return{unaryFilter:{field:gs(e.field),op:"IS_NOT_NAN"}};if(Gi(e.value))return{unaryFilter:{field:gs(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gs(e.field),op:ms(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:gs(e.field),direction:ys(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var o=function(e,t){return e.C||Ni(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=vs(t.startAt)),t.endAt&&(n.structuredQuery.endAt=vs(t.endAt)),n}function fs(e){var t=ns(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Gr(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var o=[];n.where&&(o=ds(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(e){return function(e){return new pa(ks(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var u=null;n.limit&&(u=function(e){var t;return Ni(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=ps(n.startAt));var l=null;return n.endAt&&(l=ps(n.endAt)),wa(t,i,s,o,u,"F",c,l)}function ds(e){return e?void 0!==e.unaryFilter?[bs(e)]:void 0!==e.fieldFilter?[ws(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return ds(e)})).reduce((function(e,t){return e.concat(t)})):zr():[]}function vs(e){return{before:e.before,values:e.position}}function ps(e){var t=!!e.before,n=e.values||[];return new da(n,t)}function ys(e){return Ko[e]}function ms(e){return zo[e]}function gs(e){return{fieldPath:e.canonicalString()}}function ks(e){return bi.fromServerFormat(e.fieldPath)}function ws(e){return ia.create(ks(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return zr()}}(e.fieldFilter.op),e.fieldFilter.value)}function bs(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ks(e.unaryFilter.field);return ia.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ks(e.unaryFilter.field);return ia.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ks(e.unaryFilter.field);return ia.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ks(e.unaryFilter.field);return ia.create(i,"!=",{nullValue:"NULL_VALUE"});default:return zr()}}function Is(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function Es(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Ts(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=Ss(t)),t=xs(e.get(n),t);return Ss(t)}function xs(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=a}}return n}function Ss(e){return e+"\x01\x01"}function As(e){var t=e.length;if(Gr(t>=2),2===t)return Gr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),ki.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var o=e.indexOf("\x01",a);switch((o<0||o>n)&&zr(),e.charAt(o+1)){case"\x01":var s=e.substring(a,o),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case"\x10":i+=e.substring(a,o),i+="\0";break;case"\x11":i+=e.substring(a,o+1);break;default:zr()}a=o+2}return new ki(r)}var Zs=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.seconds=t,this.nanoseconds=n})),_s=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.ownerId=t,this.allowTabSynchronization=n,this.leaseTimestampMs=r}));_s.store="owner",_s.key="owner";var Ds=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.userId=t,this.lastAcknowledgedBatchId=n,this.lastStreamToken=r}));Ds.store="mutationQueues",Ds.keyPath="userId";var Cs=(0,p.Z)((function e(t,n,r,i,a){(0,v.Z)(this,e),this.userId=t,this.batchId=n,this.localWriteTimeMs=r,this.baseMutations=i,this.mutations=a}));Cs.store="mutations",Cs.keyPath="batchId",Cs.userMutationsIndex="userMutationsIndex",Cs.userMutationsKeyPath=["userId","batchId"];var Ns=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,null,[{key:"prefixForUser",value:function(e){return[e]}},{key:"prefixForPath",value:function(e,t){return[e,Ts(t)]}},{key:"key",value:function(e,t,n){return[e,Ts(t),n]}}]),e}();Ns.store="documentMutations",Ns.PLACEHOLDER=new Ns;var Rs=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.path=t,this.readTime=n})),Os=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.path=t,this.version=n})),Ls=(0,p.Z)((function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.unknownDocument=t,this.noDocument=n,this.document=r,this.hasCommittedMutations=i,this.readTime=a,this.parentPath=o}));Ls.store="remoteDocuments",Ls.readTimeIndex="readTimeIndex",Ls.readTimeIndexPath="readTime",Ls.collectionReadTimeIndex="collectionReadTimeIndex",Ls.collectionReadTimeIndexPath=["parentPath","readTime"];var Ms=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.byteSize=t}));Ms.store="remoteDocumentGlobal",Ms.key="remoteDocumentGlobalKey";var Ps=(0,p.Z)((function e(t,n,r,i,a,o,s){(0,v.Z)(this,e),this.targetId=t,this.canonicalId=n,this.readTime=r,this.resumeToken=i,this.lastListenSequenceNumber=a,this.lastLimboFreeSnapshotVersion=o,this.query=s}));Ps.store="targets",Ps.keyPath="targetId",Ps.queryTargetsIndexName="queryTargetsIndex",Ps.queryTargetsKeyPath=["canonicalId","targetId"];var Fs=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.targetId=t,this.path=n,this.sequenceNumber=r}));Fs.store="targetDocuments",Fs.keyPath=["targetId","path"],Fs.documentTargetsIndex="documentTargetsIndex",Fs.documentTargetsKeyPath=["path","targetId"];var Vs=(0,p.Z)((function e(t,n,r,i){(0,v.Z)(this,e),this.highestTargetId=t,this.highestListenSequenceNumber=n,this.lastRemoteSnapshotVersion=r,this.targetCount=i}));Vs.key="targetGlobalKey",Vs.store="targetGlobal";var Us=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.collectionId=t,this.parent=n}));Us.store="collectionParents",Us.keyPath=["collectionId","parent"];var qs=(0,p.Z)((function e(t,n,r,i){(0,v.Z)(this,e),this.clientId=t,this.updateTimeMs=n,this.networkEnabled=r,this.inForeground=i}));qs.store="clientMetadata",qs.keyPath="clientId";var Bs=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.bundleId=t,this.createTime=n,this.version=r}));Bs.store="bundles",Bs.keyPath="bundleId";var js=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.name=t,this.readTime=n,this.bundledQuery=r}));js.store="namedQueries",js.keyPath="name";var Ks=[Ds.store,Cs.store,Ns.store,Ls.store,Ps.store,_s.store,Vs.store,Fs.store].concat([qs.store]).concat([Ms.store]).concat([Us.store]).concat([Bs.store,js.store]),zs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Gs=function(){function e(){(0,v.Z)(this,e),this.onCommittedListeners=[]}return(0,p.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}(),Hs=function(){function e(t){var n=this;(0,v.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,p.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&zr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=(0,u.Z)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}}]),e}(),Ws=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.It=new Xr,this.transaction.oncomplete=function(){r.It.resolve()},this.transaction.onabort=function(){n.error?r.It.reject(new Xs(t,n.error)):r.It.resolve()},this.transaction.onerror=function(e){var n=nu(e.target.error);r.It.reject(new Xs(t,n))}}return(0,p.Z)(e,[{key:"At",get:function(){return this.It.promise}},{key:"abort",value:function(e){e&&this.It.reject(e),this.aborted||(qr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new $s(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Xs(n,t)}}}]),e}(),Qs=function(){function e(t,n,r){(0,v.Z)(this,e),this.name=t,this.version=n,this.Rt=r,12.2===e.Pt((0,b.z$)())&&Br("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return(0,p.Z)(e,[{key:"Ct",value:function(){var e=(0,c.Z)(m().mark((function e(t){var n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return qr("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Xs(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Yr(Qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new Yr(Qr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Xs(t,n))},i.onupgradeneeded=function(e){qr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.Rt.Nt(t,i.transaction,e.oldVersion,n.version).next((function(){qr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.kt&&(this.db.onversionchange=function(e){return n.kt(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"xt",value:function(e){this.kt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=(0,c.Z)(m().mark((function e(t,n,r,i){var a,o,s,u,c=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,o=0;case 2:return++o,e.prev=3,e.delegateYield(m().mark((function e(){var n,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Ct(t);case 2:return c.db=e.sent,n=Ws.open(c.db,t,a?"readonly":"readwrite",r),o=i(n).catch((function(e){return n.abort(e),Hs.reject(e)})).toPromise(),o.catch((function(){})),e.next=7,n.At;case 7:return e.t0=o,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!==typeof(s=e.t0)){e.next=8;break}return e.abrupt("return",s.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),u="FirebaseError"!==e.t1.name&&o<3,qr("SimpleDb","Transaction failed with error:",e.t1.message,"Retrying:",u),this.close(),u){e.next=15;break}return e.abrupt("return",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return qr("SimpleDb","Removing database:",e),eu(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"bt",value:function(){if(!(0,b.hl)())return!1;if(e.vt())return!0;var t=(0,b.z$)(),n=e.Pt(t),r=0<n&&n<10,i=e.Vt(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"vt",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={NODE_ENV:"production",PUBLIC_URL:"https://discuzz.mph.am",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===e?void 0:e.St)}},{key:"Dt",value:function(e,t){return e.store(t)}},{key:"Pt",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"Vt",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Ys=function(){function e(t){(0,v.Z)(this,e),this.$t=t,this.Ft=!1,this.Ot=null}return(0,p.Z)(e,[{key:"isDone",get:function(){return this.Ft}},{key:"Mt",get:function(){return this.Ot}},{key:"cursor",set:function(e){this.$t=e}},{key:"done",value:function(){this.Ft=!0}},{key:"Lt",value:function(e){this.Ot=e}},{key:"delete",value:function(){return eu(this.$t.delete())}}]),e}(),Xs=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,Qr.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,p.Z)(n)}(Yr);function Js(e){return"IndexedDbTransactionError"===e.name}var $s=function(){function e(t){(0,v.Z)(this,e),this.store=t}return(0,p.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(qr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(qr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),eu(n)}},{key:"add",value:function(e){return qr("SimpleDb","ADD",this.store.name,e,e),eu(this.store.add(e))}},{key:"get",value:function(e){var t=this;return eu(this.store.get(e)).next((function(n){return void 0===n&&(n=null),qr("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return qr("SimpleDb","DELETE",this.store.name,e),eu(this.store.delete(e))}},{key:"count",value:function(){return qr("SimpleDb","COUNT",this.store.name),eu(this.store.count())}},{key:"Bt",value:function(e,t){var n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,(function(e,t){r.push(t)})).next((function(){return r}))}},{key:"qt",value:function(e,t){qr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.Kt=!1;var r=this.cursor(n);return this.Ut(r,(function(e,t,n){return n.delete()}))}},{key:"jt",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Ut(r,t)}},{key:"Qt",value:function(e){var t=this.cursor({});return new Hs((function(n,r){t.onerror=function(e){var t=nu(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"Ut",value:function(e,t){var n=[];return new Hs((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Ys(i),o=t(i.primaryKey,i.value,a);if(o instanceof Hs){var s=o.catch((function(e){return a.done(),Hs.reject(e)}));n.push(s)}a.isDone?r():null===a.Mt?i.continue():i.continue(a.Mt)}else r()}})).next((function(){return Hs.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function eu(e){return new Hs((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=nu(e.target.error);n(t)}}))}var tu=!1;function nu(e){var t=Qs.Pt((0,b.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new Yr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return tu||(tu=!0,setTimeout((function(){throw r}),0)),r}}return e}var ru=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).Wt=e,i.currentSequenceNumber=r,i}return(0,p.Z)(n)}(Gs);function iu(e,t){var n=Wr(e);return Qs.Dt(n.Wt,t)}var au=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,p.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&no(i,e,n[r])}}},{key:"applyToLocalView",value:function(e){var t,n=(0,u.Z)(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&ro(r,e,this.localWriteTime)}}catch(s){n.e(s)}finally{n.f()}var i,a=(0,u.Z)(this.mutations);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.key.isEqual(e.key)&&ro(o,e,this.localWriteTime)}}catch(s){a.e(s)}finally{a.f()}}},{key:"applyToLocalDocumentSet",value:function(e){var t=this;this.mutations.forEach((function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(vi.min())}))}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),No())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&hi(this.mutations,e.mutations,(function(e,t){return ao(e,t)}))&&hi(this.baseMutations,e.baseMutations,(function(e,t){return ao(e,t)}))}}]),e}(),ou=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,p.Z)(e,null,[{key:"from",value:function(t,n,r){Gr(t.mutations.length===r.length);for(var i=Do(),a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),su=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vi.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:vi.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ti.EMPTY_BYTE_STRING;(0,v.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return(0,p.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),uu=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.Gt=t}));function cu(e,t){if(t.document)return os(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=Li.fromSegments(t.noDocument.path),r=vu(t.noDocument.readTime),i=Ji.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var a=Li.fromSegments(t.unknownDocument.path),o=vu(t.unknownDocument.version);return Ji.newUnknownDocument(a,o)}return zr()}function lu(e,t,n){var r=hu(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var a=function(e,t){return{name:$o(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Ho(e,t.version.toTimestamp())}}(e.Gt,t),o=t.hasCommittedMutations;return new Ls(null,null,a,o,r,i)}if(t.isNoDocument()){var s=t.key.path.toArray(),u=du(t.version),c=t.hasCommittedMutations;return new Ls(null,new Rs(s,u),null,c,r,i)}if(t.isUnknownDocument()){var l=t.key.path.toArray(),h=du(t.version);return new Ls(new Os(l,h),null,null,!0,r,i)}return zr()}function hu(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function fu(e){var t=new di(e[0],e[1]);return vi.fromTimestamp(t)}function du(e){var t=e.toTimestamp();return new Zs(t.seconds,t.nanoseconds)}function vu(e){var t=new di(e.seconds,e.nanoseconds);return vi.fromTimestamp(t)}function pu(e,t){for(var n=(t.baseMutations||[]).map((function(t){return cs(e.Gt,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var o=t.mutations.map((function(t){return cs(e.Gt,t)})),s=di.fromMillis(t.localWriteTimeMs);return new au(t.batchId,s,n,o)}function yu(e){var t,n,r=vu(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?vu(e.lastLimboFreeSnapshotVersion):vi.min();return void 0!==e.query.documents?(Gr(1===(n=e.query).documents.length),t=Za(ba(ns(n.documents[0])))):t=function(e){return Za(fs(e))}(e.query),new su(t,e.targetId,0,e.lastListenSequenceNumber,r,i,Ti.fromBase64String(e.resumeToken))}function mu(e,t){var n,r=du(t.snapshotVersion),i=du(t.lastLimboFreeSnapshotVersion);n=ra(t.target)?ls(e.Gt,t.target):hs(e.Gt,t.target);var a=t.resumeToken.toBase64();return new Ps(t.targetId,ta(t.target),r,a,t.sequenceNumber,i,n)}function gu(e){var t=fs({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?_a(t,t.limit,"L"):t}var ku=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return wu(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:vu(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return wu(e).put({bundleId:(n=t).id,createTime:du(Yo(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return bu(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:gu(t.bundledQuery),readTime:vu(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return bu(e).put(function(e){return{name:e.name,readTime:du(Yo(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function wu(e){return iu(e,Bs.store)}function bu(e){return iu(e,js.store)}var Iu=function(){function e(){(0,v.Z)(this,e),this.zt=new Eu}return(0,p.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.zt.add(t),Hs.resolve()}},{key:"getCollectionParents",value:function(e,t){return Hs.resolve(this.zt.getEntries(t))}}]),e}(),Eu=function(){function e(){(0,v.Z)(this,e),this.index={}}return(0,p.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Eo(ki.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Eo(ki.comparator)).toArray()}}]),e}(),Tu=function(){function e(){(0,v.Z)(this,e),this.Ht=new Eu}return(0,p.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.Ht.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.Ht.add(t)}));var a={collectionId:r,parent:Ts(i)};return xu(e).put(a)}return Hs.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[fi(t),""],!1,!0);return xu(e).Bt(r).next((function(e){var r,i=(0,u.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(As(a.parent))}}catch(o){i.e(o)}finally{i.f()}return n}))}}]),e}();function xu(e){return iu(e,Us.store)}var Su={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Au=function(){function e(t,n,r){(0,v.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,p.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function Zu(e,t,n){var r=e.store(Cs.store),i=e.store(Ns.store),a=[],o=IDBKeyRange.only(n.batchId),s=0,c=r.jt({range:o},(function(e,t,n){return s++,n.delete()}));a.push(c.next((function(){Gr(1===s)})));var l,h=[],f=(0,u.Z)(n.mutations);try{for(f.s();!(l=f.n()).done;){var d=l.value,v=Ns.key(t,d.key.path,n.batchId);a.push(i.delete(v)),h.push(d.key)}}catch(p){f.e(p)}finally{f.f()}return Hs.waitFor(a).next((function(){return h}))}function _u(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw zr();t=e.noDocument}return JSON.stringify(t).length}Au.DEFAULT_COLLECTION_PERCENTILE=10,Au.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Au.DEFAULT=new Au(41943040,Au.DEFAULT_COLLECTION_PERCENTILE,Au.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Au.DISABLED=new Au(-1,0,0);var Du=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.userId=t,this.k=n,this.Jt=r,this.referenceDelegate=i,this.Yt={}}return(0,p.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Nu(e).jt({index:Cs.userMutationsIndex,range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=Ru(e),o=Nu(e);return o.add({}).next((function(s){Gr("number"==typeof s);var c,l=new au(s,t,n,r),h=function(e,t,n){var r=n.baseMutations.map((function(t){return us(e.Gt,t)})),i=n.mutations.map((function(t){return us(e.Gt,t)}));return new Cs(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.k,i.userId,l),f=[],d=new Eo((function(e,t){return li(e.canonicalString(),t.canonicalString())})),v=(0,u.Z)(r);try{for(v.s();!(c=v.n()).done;){var p=c.value,y=Ns.key(i.userId,p.key.path,s);d=d.add(p.key.path.popLast()),f.push(o.put(h)),f.push(a.put(y,Ns.PLACEHOLDER))}}catch(m){v.e(m)}finally{v.f()}return d.forEach((function(t){f.push(i.Jt.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.Yt[s]=l.keys()})),Hs.waitFor(f).next((function(){return l}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return Nu(e).get(t).next((function(e){return e?(Gr(e.userId===n.userId),pu(n.k,e)):null}))}},{key:"Zt",value:function(e,t){var n=this;return this.Yt[t]?Hs.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.Yt[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return Nu(e).jt({index:Cs.userMutationsIndex,range:i},(function(e,t,i){t.userId===n.userId&&(Gr(t.batchId>=r),a=pu(n.k,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Nu(e).jt({index:Cs.userMutationsIndex,range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Nu(e).Bt(Cs.userMutationsIndex,n).next((function(e){return e.map((function(e){return pu(t.k,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=Ns.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return Ru(e).jt({range:i},(function(r,i,o){var u=(0,s.Z)(r,3),c=u[0],l=u[1],h=u[2],f=As(l);if(c===n.userId&&t.path.isEqual(f))return Nu(e).get(h).next((function(e){if(!e)throw zr();Gr(e.userId===n.userId),a.push(pu(n.k,e))}));o.done()})).next((function(){return a}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Eo(li),i=[];return t.forEach((function(t){var a=Ns.prefixForPath(n.userId,t.path),o=IDBKeyRange.lowerBound(a),u=Ru(e).jt({range:o},(function(e,i,a){var o=(0,s.Z)(e,3),u=o[0],c=o[1],l=o[2],h=As(c);u===n.userId&&t.path.isEqual(h)?r=r.add(l):a.done()}));i.push(u)})),Hs.waitFor(i).next((function(){return n.te(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=Ns.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(a),u=new Eo(li);return Ru(e).jt({range:o},(function(e,t,a){var o=(0,s.Z)(e,3),c=o[0],l=o[1],h=o[2],f=As(l);c===n.userId&&r.isPrefixOf(f)?f.length===i&&(u=u.add(h)):a.done()})).next((function(){return n.te(e,u)}))}},{key:"te",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(Nu(e).get(t).next((function(e){if(null===e)throw zr();Gr(e.userId===n.userId),r.push(pu(n.k,e))})))})),Hs.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return Zu(e.Wt,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.ee(t.batchId)})),Hs.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"ee",value:function(e){delete this.Yt[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return Hs.resolve();var r=IDBKeyRange.lowerBound(Ns.prefixForUser(t.userId)),i=[];return Ru(e).jt({range:r},(function(e,n,r){if(e[0]===t.userId){var a=As(e[1]);i.push(a)}else r.done()})).next((function(){Gr(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return Cu(e,this.userId,t)}},{key:"ne",value:function(e){var t=this;return Ou(e).get(this.userId).next((function(e){return e||new Ds(t.userId,-1,"")}))}}],[{key:"Xt",value:function(t,n,r,i){return Gr(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function Cu(e,t,n){var r=Ns.prefixForPath(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),o=!1;return Ru(e).jt({range:a,Kt:!0},(function(e,n,r){var a=(0,s.Z)(e,3),u=a[0],c=a[1];a[2];u===t&&c===i&&(o=!0),r.done()})).next((function(){return o}))}function Nu(e){return iu(e,Cs.store)}function Ru(e){return iu(e,Ns.store)}function Ou(e){return iu(e,Ds.store)}var Lu=function(){function e(t){(0,v.Z)(this,e),this.se=t}return(0,p.Z)(e,[{key:"next",value:function(){return this.se+=2,this.se}}],[{key:"ie",value:function(){return new e(0)}},{key:"re",value:function(){return new e(-1)}}]),e}(),Mu=function(){function e(t,n){(0,v.Z)(this,e),this.referenceDelegate=t,this.k=n}return(0,p.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.oe(e).next((function(n){var r=new Lu(n.highestTargetId);return n.highestTargetId=r.next(),t.ae(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.oe(e).next((function(e){return vi.fromTimestamp(new di(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.oe(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.oe(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.ae(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.ce(e,t).next((function(){return n.oe(e).next((function(r){return r.targetCount+=1,n.ue(t,r),n.ae(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.ce(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Pu(e).delete(t.targetId)})).next((function(){return n.oe(e)})).next((function(t){return Gr(t.targetCount>0),t.targetCount-=1,n.ae(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Pu(e).jt((function(o,s){var u=yu(s);u.sequenceNumber<=t&&null===n.get(u.targetId)&&(i++,a.push(r.removeTargetData(e,u)))})).next((function(){return Hs.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Pu(e).jt((function(e,n){var r=yu(n);t(r)}))}},{key:"oe",value:function(e){return Fu(e).get(Vs.key).next((function(e){return Gr(null!==e),e}))}},{key:"ae",value:function(e,t){return Fu(e).put(Vs.key,t)}},{key:"ce",value:function(e,t){return Pu(e).put(mu(this.k,t))}},{key:"ue",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.oe(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=ta(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Pu(e).jt({range:r,index:Ps.queryTargetsIndexName},(function(e,n,r){var a=yu(n);na(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Vu(e);return t.forEach((function(t){var o=Ts(t.path);i.push(a.put(new Fs(n,o))),i.push(r.referenceDelegate.addReference(e,n,t))})),Hs.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Vu(e);return Hs.forEach(t,(function(t){var a=Ts(t.path);return Hs.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Vu(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Vu(e),i=No();return r.jt({range:n,Kt:!0},(function(e,t,n){var r=As(e[1]),a=new Li(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=Ts(t.path),r=IDBKeyRange.bound([n],[fi(n)],!1,!0),i=0;return Vu(e).jt({index:Fs.documentTargetsIndex,Kt:!0,range:r},(function(e,t,n){var r=(0,s.Z)(e,2),a=r[0];r[1];0!==a&&(i++,n.done())})).next((function(){return i>0}))}},{key:"Et",value:function(e,t){return Pu(e).get(t).next((function(e){return e?yu(e):null}))}}]),e}();function Pu(e){return iu(e,Ps.store)}function Fu(e){return iu(e,Vs.store)}function Vu(e){return iu(e,Fs.store)}function Uu(e){return qu.apply(this,arguments)}function qu(){return qu=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===Qr.FAILED_PRECONDITION&&t.message===zs){e.next=2;break}throw t;case 2:qr("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)}))),qu.apply(this,arguments)}function Bu(e,t){var n=(0,s.Z)(e,2),r=n[0],i=n[1],a=(0,s.Z)(t,2),o=a[0],u=a[1],c=li(r,o);return 0===c?li(i,u):c}var ju=function(){function e(t){(0,v.Z)(this,e),this.he=t,this.buffer=new Eo(Bu),this.le=0}return(0,p.Z)(e,[{key:"fe",value:function(){return++this.le}},{key:"de",value:function(e){var t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Bu(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Ku=function(){function e(t,n){(0,v.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.we=!1,this._e=null}return(0,p.Z)(e,[{key:"start",value:function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}},{key:"stop",value:function(){this._e&&(this._e.cancel(),this._e=null)}},{key:"started",get:function(){return null!==this._e}},{key:"me",value:function(e){var t=this,n=this.we?3e5:6e4;qr("LruGarbageCollector","Garbage collection scheduled in ".concat(n,"ms")),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(0,c.Z)(m().mark((function n(){return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t._e=null,t.we=!0,n.prev=1,n.next=4,e.collectGarbage(t.garbageCollector);case 4:n.next=14;break;case 6:if(n.prev=6,n.t0=n.catch(1),!Js(n.t0)){n.next=12;break}qr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n.t0),n.next=14;break;case 12:return n.next=14,Uu(n.t0);case 14:return n.next=16,t.me(e);case 16:case"end":return n.stop()}}),n,null,[[1,6]])}))))}}]),e}(),zu=function(){function e(t,n){(0,v.Z)(this,e),this.ge=t,this.params=n}return(0,p.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.ge.ye(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Hs.resolve(si.I);var r=new ju(t);return this.ge.forEachTarget(e,(function(e){return r.de(e.sequenceNumber)})).next((function(){return n.ge.pe(e,(function(e){return r.de(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.ge.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.ge.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector","Garbage collection skipped; disabled"),Hs.resolve(Su)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),Su):n.Te(e,t)}))}},{key:"getCacheSize",value:function(e){return this.ge.getCacheSize(e)}},{key:"Te",value:function(e,t){var n,r,i,a,o,s,u,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(qr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,o=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,s=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return u=Date.now(),Vr()<=w.in.DEBUG&&qr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(s-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(u-s)+"ms\n"+"Total Duration: ".concat(u-l,"ms")),Hs.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),Gu=function(){function e(t,n){(0,v.Z)(this,e),this.db=t,this.garbageCollector=function(e,t){return new zu(e,t)}(this,n)}return(0,p.Z)(e,[{key:"ye",value:function(e){var t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"Ee",value:function(e){var t=0;return this.pe(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"pe",value:function(e,t){return this.Ie(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return Hu(e,n)}},{key:"removeReference",value:function(e,t,n){return Hu(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Hu(e,t)}},{key:"Ae",value:function(e,t){return function(e,t){var n=!1;return Ou(e).Qt((function(r){return Cu(e,r,t).next((function(e){return e&&(n=!0),Hs.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Ie(e,(function(o,s){if(s<=t){var u=n.Ae(e,o).next((function(t){if(!t)return a++,r.getEntry(e,o).next((function(){return r.removeEntry(o),Vu(e).delete([0,Ts(o.path)])}))}));i.push(u)}})).next((function(){return Hs.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Hu(e,t)}},{key:"Ie",value:function(e,t){var n,r=Vu(e),i=si.I;return r.jt({index:Fs.documentTargetsIndex},(function(e,r){var a=(0,s.Z)(e,2),o=a[0],u=(a[1],r.path),c=r.sequenceNumber;0===o?(i!==si.I&&t(new Li(As(n)),i),i=c,n=u):i=si.I})).next((function(){i!==si.I&&t(new Li(As(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Hu(e,t){return Vu(e).put(function(e,t){return new Fs(0,Ts(e.path),t)}(t,e.currentSequenceNumber))}var Wu=function(){function e(t,n){(0,v.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return(0,p.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),o=a[0],c=a[1];if(this.equalsFn(o,e))return c}}catch(l){i.e(l)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}},{key:"forEach",value:function(e){yi(this.inner,(function(t,n){var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),o=a[0],c=a[1];e(o,c)}}catch(l){i.e(l)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return mi(this.inner)}}]),e}(),Qu=function(){function e(){(0,v.Z)(this,e),this.changes=new Wu((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,p.Z)(e,[{key:"getReadTime",value:function(e){var t=this.changes.get(e);return t?t.readTime:vi.min()}},{key:"addEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}},{key:"removeEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.assertNotApplied(),this.changes.set(e,{document:Ji.newInvalidDocument(e),readTime:t})}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Hs.resolve(n.document):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Yu=function(){function e(t,n){(0,v.Z)(this,e),this.k=t,this.Jt=n}return(0,p.Z)(e,[{key:"addEntry",value:function(e,t,n){return $u(e).put(ec(t),n)}},{key:"removeEntry",value:function(e,t){var n=$u(e),r=ec(t);return n.delete(r)}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.Re(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this;return $u(e).get(ec(t)).next((function(e){return n.Pe(t,e)}))}},{key:"be",value:function(e,t){var n=this;return $u(e).get(ec(t)).next((function(e){return{document:n.Pe(t,e),size:_u(e)}}))}},{key:"getEntries",value:function(e,t){var n=this,r=So();return this.ve(e,t,(function(e,t){var i=n.Pe(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"Ve",value:function(e,t){var n=this,r=So(),i=new wo(Li.comparator);return this.ve(e,t,(function(e,t){var a=n.Pe(e,t);r=r.insert(e,a),i=i.insert(e,_u(t))})).next((function(){return{documents:r,Se:i}}))}},{key:"ve",value:function(e,t,n){if(t.isEmpty())return Hs.resolve();var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator(),a=i.getNext();return $u(e).jt({range:r},(function(e,t,r){for(var o=Li.fromSegments(e);a&&Li.comparator(a,o)<0;)n(a,null),a=i.getNext();a&&a.isEqual(o)&&(n(a,t),a=i.hasNext()?i.getNext():null),a?r.Lt(a.path.toArray()):r.done()})).next((function(){for(;a;)n(a,null),a=i.hasNext()?i.getNext():null}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){var r=this,i=So(),a=t.path.length+1,o={};if(n.isEqual(vi.min())){var s=t.path.toArray();o.range=IDBKeyRange.lowerBound(s)}else{var u=t.path.toArray(),c=hu(n);o.range=IDBKeyRange.lowerBound([u,c],!0),o.index=Ls.collectionReadTimeIndex}return $u(e).jt(o,(function(e,n,o){if(e.length===a){var s=cu(r.k,n);t.path.isPrefixOf(s.key.path)?Ra(t,s)&&(i=i.insert(s.key,s)):o.done()}})).next((function(){return i}))}},{key:"newChangeBuffer",value:function(e){return new Xu(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Ju(e).get(Ms.key).next((function(e){return Gr(!!e),e}))}},{key:"Re",value:function(e,t){return Ju(e).put(Ms.key,t)}},{key:"Pe",value:function(e,t){if(t){var n=cu(this.k,t);if(!n.isNoDocument()||!n.version.isEqual(vi.min()))return n}return Ji.newInvalidDocument(e)}}]),e}(),Xu=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).De=e,i.trackRemovals=r,i.Ce=new Wu((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,p.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Eo((function(e,t){return li(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,o){var s=t.Ce.get(a);if(o.document.isValidDocument()){var u=lu(t.De.k,o.document,t.getReadTime(a));i=i.add(a.path.popLast());var c=_u(u);r+=c-s,n.push(t.De.addEntry(e,a,u))}else if(r-=s,t.trackRemovals){var l=lu(t.De.k,Ji.newNoDocument(a,vi.min()),t.getReadTime(a));n.push(t.De.addEntry(e,a,l))}else n.push(t.De.removeEntry(e,a))})),i.forEach((function(r){n.push(t.De.Jt.addToCollectionParentIndex(e,r))})),n.push(this.De.updateMetadata(e,r)),Hs.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.De.be(e,t).next((function(e){return n.Ce.set(t,e.size),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.De.Ve(e,t).next((function(e){var t=e.documents;return e.Se.forEach((function(e,t){n.Ce.set(e,t)})),t}))}}]),n}(Qu);function Ju(e){return iu(e,Ms.store)}function $u(e){return iu(e,Ls.store)}function ec(e){return e.path.toArray()}var tc=function(){function e(t){(0,v.Z)(this,e),this.k=t}return(0,p.Z)(e,[{key:"Nt",value:function(e,t,n,r){var i=this;Gr(n<r&&n>=0&&r<=11);var a=new Ws("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(_s.store)}(e),function(e){e.createObjectStore(Ds.store,{keyPath:Ds.keyPath}),e.createObjectStore(Cs.store,{keyPath:Cs.keyPath,autoIncrement:!0}).createIndex(Cs.userMutationsIndex,Cs.userMutationsKeyPath,{unique:!0}),e.createObjectStore(Ns.store)}(e),nc(e),function(e){e.createObjectStore(Ls.store)}(e));var o=Hs.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Fs.store),e.deleteObjectStore(Ps.store),e.deleteObjectStore(Vs.store)}(e),nc(e)),o=o.next((function(){return function(e){var t=e.store(Vs.store),n=new Vs(0,0,vi.min().toTimestamp(),0);return t.put(Vs.key,n)}(a)}))),n<4&&r>=4&&(0!==n&&(o=o.next((function(){return function(e,t){return t.store(Cs.store).Bt().next((function(n){e.deleteObjectStore(Cs.store),e.createObjectStore(Cs.store,{keyPath:Cs.keyPath,autoIncrement:!0}).createIndex(Cs.userMutationsIndex,Cs.userMutationsKeyPath,{unique:!0});var r=t.store(Cs.store),i=n.map((function(e){return r.put(e)}));return Hs.waitFor(i)}))}(e,a)}))),o=o.next((function(){!function(e){e.createObjectStore(qs.store,{keyPath:qs.keyPath})}(e)}))),n<5&&r>=5&&(o=o.next((function(){return i.Ne(a)}))),n<6&&r>=6&&(o=o.next((function(){return function(e){e.createObjectStore(Ms.store)}(e),i.ke(a)}))),n<7&&r>=7&&(o=o.next((function(){return i.xe(a)}))),n<8&&r>=8&&(o=o.next((function(){return i.$e(e,a)}))),n<9&&r>=9&&(o=o.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){var t=e.objectStore(Ls.store);t.createIndex(Ls.readTimeIndex,Ls.readTimeIndexPath,{unique:!1}),t.createIndex(Ls.collectionReadTimeIndex,Ls.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(o=o.next((function(){return i.Fe(a)}))),n<11&&r>=11&&(o=o.next((function(){!function(e){e.createObjectStore(Bs.store,{keyPath:Bs.keyPath})}(e),function(e){e.createObjectStore(js.store,{keyPath:js.keyPath})}(e)}))),o}},{key:"ke",value:function(e){var t=0;return e.store(Ls.store).jt((function(e,n){t+=_u(n)})).next((function(){var n=new Ms(t);return e.store(Ms.store).put(Ms.key,n)}))}},{key:"Ne",value:function(e){var t=this,n=e.store(Ds.store),r=e.store(Cs.store);return n.Bt().next((function(n){return Hs.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Bt(Cs.userMutationsIndex,i).next((function(r){return Hs.forEach(r,(function(r){Gr(r.userId===n.userId);var i=pu(t.k,r);return Zu(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"xe",value:function(e){var t=e.store(Fs.store),n=e.store(Ls.store);return e.store(Vs.store).get(Vs.key).next((function(e){var r=[];return n.jt((function(n,i){var a=new ki(n),o=function(e){return[0,Ts(e)]}(a);r.push(t.get(o).next((function(n){return n?Hs.resolve():function(n){return t.put(new Fs(0,Ts(n),e.highestListenSequenceNumber))}(a)})))})).next((function(){return Hs.waitFor(r)}))}))}},{key:"$e",value:function(e,t){e.createObjectStore(Us.store,{keyPath:Us.keyPath});var n=t.store(Us.store),r=new Eu,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:Ts(i)})}};return t.store(Ls.store).jt({Kt:!0},(function(e,t){var n=new ki(e);return i(n.popLast())})).next((function(){return t.store(Ns.store).jt({Kt:!0},(function(e,t){var n=(0,s.Z)(e,3),r=(n[0],n[1]),a=(n[2],As(r));return i(a.popLast())}))}))}},{key:"Fe",value:function(e){var t=this,n=e.store(Ps.store);return n.jt((function(e,r){var i=yu(r),a=mu(t.k,i);return n.put(a)}))}}]),e}();function nc(e){e.createObjectStore(Fs.store,{keyPath:Fs.keyPath}).createIndex(Fs.documentTargetsIndex,Fs.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Ps.store,{keyPath:Ps.keyPath}).createIndex(Ps.queryTargetsIndexName,Ps.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Vs.store)}var rc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ic=function(){function e(t,n,r,i,a,o,s,u,c,l){if((0,v.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Oe=a,this.window=o,this.document=s,this.Me=c,this.Le=l,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=function(e){return Promise.resolve()},!e.bt())throw new Yr(Qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gu(this,i),this.Ge=n+"main",this.k=new uu(u),this.ze=new Qs(this.Ge,11,new tc(this.k)),this.He=new Mu(this.referenceDelegate,this.k),this.Jt=new Tu,this.Je=function(e,t){return new Yu(e,t)}(this.k,this.Jt),this.Ye=new ku,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===l&&Br("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return(0,p.Z)(e,[{key:"start",value:function(){var e=this;return this.Ze().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Yr(Qr.FAILED_PRECONDITION,rc);return e.tn(),e.en(),e.nn(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.He.getHighestSequenceNumber(t)}))})).then((function(t){e.Be=new si(t,e.Me)})).then((function(){e.Ue=!0})).catch((function(t){return e.ze&&e.ze.close(),Promise.reject(t)}))}},{key:"sn",value:function(e){var t=this;return this.We=function(){var n=(0,c.Z)(m().mark((function n(r){return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ze.xt(function(){var t=(0,c.Z)(m().mark((function t(n){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.Ze();case 4:case"end":return e.stop()}}),e)})))))}},{key:"Ze",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return oc(t).put(new qs(e.clientId,Date.now(),e.networkEnabled,e.inForeground)).next((function(){if(e.isPrimary)return e.rn(t).next((function(t){t||(e.isPrimary=!1,e.Oe.enqueueRetryable((function(){return e.We(!1)})))}))})).next((function(){return e.on(t)})).next((function(n){return e.isPrimary&&!n?e.an(t).next((function(){return!1})):!!n&&e.cn(t).next((function(){return!0}))}))})).catch((function(t){if(Js(t))return qr("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return qr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Oe.enqueueRetryable((function(){return e.We(t)})),e.isPrimary=t}))}},{key:"rn",value:function(e){var t=this;return ac(e).get(_s.key).next((function(e){return Hs.resolve(t.un(e))}))}},{key:"hn",value:function(e){return oc(e).delete(this.clientId)}},{key:"ln",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n,r,i,a=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.fn(this.Qe,18e5)){e.next=6;break}return this.Qe=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=iu(e,qs.store);return t.Bt().next((function(e){var n=a.dn(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return Hs.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.Xe){n=(0,u.Z)(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.Xe.removeItem(this.wn(i.clientId))}catch(o){n.e(o)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nn",value:function(){var e=this;this.je=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.Ze().then((function(){return e.ln()})).then((function(){return e.nn()}))}))}},{key:"un",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"on",value:function(e){var t=this;return this.Le?Hs.resolve(!0):ac(e).get(_s.key).next((function(n){if(null!==n&&t.fn(n.leaseTimestampMs,5e3)&&!t._n(n.ownerId)){if(t.un(n)&&t.networkEnabled)return!0;if(!t.un(n)){if(!n.allowTabSynchronization)throw new Yr(Qr.FAILED_PRECONDITION,rc);return!1}}return!(!t.networkEnabled||!t.inForeground)||oc(e).Bt().next((function(e){return void 0===t.dn(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&qr("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:function(){var e=(0,c.Z)(m().mark((function e(){var t=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),e.next=7,this.ze.runTransaction("shutdown","readwrite",[_s.store,qs.store],(function(e){var n=new ru(e,si.I);return t.an(n).next((function(){return t.hn(n)}))}));case 7:this.ze.close(),this.pn();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dn",value:function(e,t){var n=this;return e.filter((function(e){return n.fn(e.updateTimeMs,t)&&!n._n(e.clientId)}))}},{key:"Tn",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return oc(t).Bt().next((function(t){return e.dn(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Ue}},{key:"getMutationQueue",value:function(e){return Du.Xt(e,this.k,this.Jt,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.He}},{key:"getRemoteDocumentCache",value:function(){return this.Je}},{key:"getIndexManager",value:function(){return this.Jt}},{key:"getBundleCache",value:function(){return this.Ye}},{key:"runTransaction",value:function(e,t,n){var r=this;qr("IndexedDbPersistence","Starting transaction:",e);var i,a="readonly"===t?"readonly":"readwrite";return this.ze.runTransaction(e,a,Ks,(function(a){return i=new ru(a,r.Be?r.Be.next():si.I),"readwrite-primary"===t?r.rn(i).next((function(e){return!!e||r.on(i)})).next((function(t){if(!t)throw Br("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Oe.enqueueRetryable((function(){return r.We(!1)})),new Yr(Qr.FAILED_PRECONDITION,zs);return n(i)})).next((function(e){return r.cn(i).next((function(){return e}))})):r.En(i).next((function(){return n(i)}))})).then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"En",value:function(e){var t=this;return ac(e).get(_s.key).next((function(e){if(null!==e&&t.fn(e.leaseTimestampMs,5e3)&&!t._n(e.ownerId)&&!t.un(e)&&!(t.Le||t.allowTabSynchronization&&e.allowTabSynchronization))throw new Yr(Qr.FAILED_PRECONDITION,rc)}))}},{key:"cn",value:function(e){var t=new _s(this.clientId,this.allowTabSynchronization,Date.now());return ac(e).put(_s.key,t)}},{key:"an",value:function(e){var t=this,n=ac(e);return n.get(_s.key).next((function(e){return t.un(e)?(qr("IndexedDbPersistence","Releasing primary lease."),n.delete(_s.key)):Hs.resolve()}))}},{key:"fn",value:function(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(Br("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"tn",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=function(){e.Oe.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.Ze()}))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}},{key:"gn",value:function(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}},{key:"en",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=function(){t.mn(),(0,b.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.Oe.enterRestrictedMode(!0),t.Oe.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.qe))}},{key:"yn",value:function(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}},{key:"_n",value:function(e){var t;try{var n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return qr("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Br("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"mn",value:function(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(L){Br("Failed to set zombie client id.",L)}}},{key:"pn",value:function(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(L){}}},{key:"wn",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"bt",value:function(){return Qs.bt()}}]),e}();function ac(e){return iu(e,_s.store)}function oc(e){return iu(e,qs.store)}function sc(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var uc=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.progress=t,this.In=n})),cc=function(){function e(t,n,r){(0,v.Z)(this,e),this.Je=t,this.An=n,this.Jt=r}return(0,p.Z)(e,[{key:"Rn",value:function(e,t){var n=this;return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(r){return n.Pn(e,t,r)}))}},{key:"Pn",value:function(e,t,n){return this.Je.getEntry(e,t).next((function(e){var t,r=(0,u.Z)(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(i){r.e(i)}finally{r.f()}return e}))}},{key:"bn",value:function(e,t){e.forEach((function(e,n){var r,i=(0,u.Z)(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(a){i.e(a)}finally{i.f()}}))}},{key:"vn",value:function(e,t){var n=this;return this.Je.getEntries(e,t).next((function(t){return n.Vn(e,t).next((function(){return t}))}))}},{key:"Vn",value:function(e,t){var n=this;return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){return n.bn(t,e)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return Li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):Sa(t)?this.Dn(e,t,n):this.Cn(e,t,n)}},{key:"Sn",value:function(e,t){return this.Rn(e,new Li(t)).next((function(e){var t=Zo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"Dn",value:function(e,t,n){var r=this,i=t.collectionGroup,a=Zo();return this.Jt.getCollectionParents(e,i).next((function(o){return Hs.forEach(o,(function(o){var s=function(e,t){return new ka(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return r.Cn(e,s,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"Cn",value:function(e,t,n){var r,i,a=this;return this.Je.getDocumentsMatchingQuery(e,t,n).next((function(n){return r=n,a.An.getAllMutationBatchesAffectingQuery(e,t)})).next((function(t){return i=t,a.Nn(e,i,r).next((function(e){r=e;var t,n=(0,u.Z)(i);try{for(n.s();!(t=n.n()).done;){var a,o=t.value,s=(0,u.Z)(o.mutations);try{for(s.s();!(a=s.n()).done;){var c=a.value,l=c.key,h=r.get(l);null==h&&(h=Ji.newInvalidDocument(l),r=r.insert(l,h)),ro(c,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(l))}}catch(f){s.e(f)}finally{s.f()}}}catch(f){n.e(f)}finally{n.f()}}))})).next((function(){return r.forEach((function(e,n){Ra(t,n)||(r=r.remove(e))})),r}))}},{key:"Nn",value:function(e,t,n){var r,i=No(),a=(0,u.Z)(t);try{for(a.s();!(r=a.n()).done;){var o,s=r.value,c=(0,u.Z)(s.mutations);try{for(c.s();!(o=c.n()).done;){var l=o.value;l instanceof uo&&null===n.get(l.key)&&(i=i.add(l.key))}}catch(f){c.e(f)}finally{c.f()}}}catch(f){a.e(f)}finally{a.f()}var h=n;return this.Je.getEntries(e,i).next((function(e){return e.forEach((function(e,t){t.isFoundDocument()&&(h=h.insert(e,t))})),h}))}}]),e}(),lc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.targetId=t,this.fromCache=n,this.kn=r,this.xn=i}return(0,p.Z)(e,null,[{key:"$n",value:function(t,n){var r,i=No(),a=No(),o=(0,u.Z)(n.docChanges);try{for(o.s();!(r=o.n()).done;){var s=r.value;switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}}}catch(c){o.e(c)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),hc=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"Fn",value:function(e){this.On=e}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(vi.min())?this.Mn(e,t):this.On.vn(e,r).next((function(a){var o=i.Ln(t,a);return(Ia(t)||Ea(t))&&i.Bn(t.limitType,o,r,n)?i.Mn(e,t):(Vr()<=w.in.DEBUG&&qr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Na(t)),i.On.getDocumentsMatchingQuery(e,t,n).next((function(e){return o.forEach((function(t){e=e.insert(t.key,t)})),e})))}))}},{key:"Ln",value:function(e,t){var n=new Eo(Oa(e));return t.forEach((function(t,r){Ra(e,r)&&(n=n.add(r))})),n}},{key:"Bn",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Mn",value:function(e,t){return Vr()<=w.in.DEBUG&&qr("QueryEngine","Using full collection scan to execute query:",Na(t)),this.On.getDocumentsMatchingQuery(e,t,vi.min())}}]),e}(),fc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.persistence=t,this.Un=n,this.k=i,this.qn=new wo(li),this.Kn=new Wu((function(e){return ta(e)}),na),this.jn=vi.min(),this.An=t.getMutationQueue(r),this.Qn=t.getRemoteDocumentCache(),this.He=t.getTargetCache(),this.Wn=new cc(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=t.getBundleCache(),this.Un.Fn(this.Wn)}return(0,p.Z)(e,[{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.qn)}))}}]),e}();function dc(e,t,n,r){return new fc(e,t,n,r)}function vc(e,t){return pc.apply(this,arguments)}function pc(){return pc=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),i=r.An,a=r.Wn,e.next=4,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.An.getAllMutationBatches(e).next((function(o){return t=o,i=r.persistence.getMutationQueue(n),a=new cc(r.Qn,i,r.persistence.getIndexManager()),i.getAllMutationBatches(e)})).next((function(n){var r,i=[],o=[],s=No(),c=(0,u.Z)(t);try{for(c.s();!(r=c.n()).done;){var l=r.value;i.push(l.batchId);var h,f=(0,u.Z)(l.mutations);try{for(f.s();!(h=f.n()).done;){var d=h.value;s=s.add(d.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){c.e(w)}finally{c.f()}var v,p=(0,u.Z)(n);try{for(p.s();!(v=p.n()).done;){var y=v.value;o.push(y.batchId);var m,g=(0,u.Z)(y.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;s=s.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){p.e(w)}finally{p.f()}return a.vn(e,s).next((function(e){return{Gn:e,removedBatchIds:i,addedBatchIds:o}}))}))}));case 4:return o=e.sent,e.abrupt("return",(r.An=i,r.Wn=a,r.Un.Fn(r.Wn),o));case 6:case"end":return e.stop()}}),e)}))),pc.apply(this,arguments)}function yc(e,t){var n=Wr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),o=Hs.resolve();return a.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);Gr(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),o.next((function(){return e.An.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.An.performConsistencyCheck(e)})).next((function(){return n.Wn.vn(e,r)}))}))}function mc(e){var t=Wr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.He.getLastRemoteSnapshotVersion(e)}))}function gc(e,t){var n=Wr(e),r=t.snapshotVersion,i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;var o=[];t.targetChanges.forEach((function(t,a){var s=i.get(a);if(s){o.push(n.He.removeMatchingKeys(e,t.removedDocuments,a).next((function(){return n.He.addMatchingKeys(e,t.addedDocuments,a)})));var u=t.resumeToken;if(u.approximateByteSize()>0){var c=s.withResumeToken(u,r).withSequenceNumber(e.currentSequenceNumber);i=i.insert(a,c),function(e,t,n){return Gr(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,t)&&o.push(n.He.updateTargetData(e,c))}}}));var s=So();if(t.documentUpdates.forEach((function(r,i){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(kc(e,a,t.documentUpdates,r,void 0).next((function(e){s=e}))),!r.isEqual(vi.min())){var u=n.He.getLastRemoteSnapshotVersion(e).next((function(t){return n.He.setTargetsMetadata(e,e.currentSequenceNumber,r)}));o.push(u)}return Hs.waitFor(o).next((function(){return a.apply(e)})).next((function(){return n.Wn.Vn(e,s)})).next((function(){return s}))})).then((function(e){return n.qn=i,e}))}function kc(e,t,n,r,i){var a=No();return n.forEach((function(e){return a=a.add(e)})),t.getEntries(e,a).next((function(e){var a=So();return n.forEach((function(n,o){var s=e.get(n),u=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(vi.min())?(t.removeEntry(n,u),a=a.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(o,u),a=a.insert(n,o)):qr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),a}))}function wc(e,t){var n=Wr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)}))}function bc(e,t){var n=Wr(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.He.getTargetData(e,t).next((function(i){return i?(r=i,Hs.resolve(r)):n.He.allocateTargetId(e).next((function(i){return r=new su(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e}))}function Ic(e,t,n){return Ec.apply(this,arguments)}function Ec(){return Ec=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Wr(t),a=i.qn.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Js(e.t1)){e.next=12;break}throw e.t1;case 12:qr("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.qn=i.qn.remove(n),i.Kn.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])}))),Ec.apply(this,arguments)}function Tc(e,t,n){var r=Wr(e),i=vi.min(),a=No();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=Wr(e),i=r.Kn.get(n);return void 0!==i?Hs.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,Za(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Un.getDocumentsMatchingQuery(e,t,n?i:vi.min(),n?a:No())})).next((function(e){return{documents:e,zn:a}}))}))}function xc(e,t){var n=Wr(e),r=Wr(n.He),i=n.qn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.Et(e,t).next((function(e){return e?e.target:null}))}))}function Sc(e){var t=Wr(e);return t.persistence.runTransaction("Get new document changes","readonly",(function(e){return function(e,t,n){var r=Wr(e),i=So(),a=hu(n),o=$u(t),s=IDBKeyRange.lowerBound(a,!0);return o.jt({index:Ls.readTimeIndex,range:s},(function(e,t){var n=cu(r.k,t);i=i.insert(n.key,n),a=t.readTime})).next((function(){return{In:i,readTime:fu(a)}}))}(t.Qn,e,t.jn)})).then((function(e){var n=e.In,r=e.readTime;return t.jn=r,n}))}function Ac(e){return Zc.apply(this,arguments)}function Zc(){return Zc=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wr(t),e.abrupt("return",n.persistence.runTransaction("Synchronize last document change read time","readonly",(function(e){return function(e){var t=$u(e),n=vi.min();return t.jt({index:Ls.readTimeIndex,reverse:!0},(function(e,t,r){t.readTime&&(n=fu(t.readTime)),r.done()})).next((function(){return n}))}(e)})).then((function(e){n.jn=e})));case 2:case"end":return e.stop()}}),e)}))),Zc.apply(this,arguments)}function _c(e,t,n,r){return Dc.apply(this,arguments)}function Dc(){return Dc=(0,c.Z)(m().mark((function e(t,n,r,i){var a,o,s,c,l,h,f,d,v,p;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Wr(t),o=No(),s=So(),c=Do(),l=(0,u.Z)(r);try{for(l.s();!(h=l.n()).done;)f=h.value,d=n.Hn(f.metadata.name),f.document&&(o=o.add(d)),s=s.insert(d,n.Jn(f)),c=c.insert(d,n.Yn(f.metadata.readTime))}catch(y){l.e(y)}finally{l.f()}return v=a.Qn.newChangeBuffer({trackRemovals:!0}),e.next=7,bc(a,function(e){return Za(ba(ki.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return p=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return kc(e,v,s,vi.min(),c).next((function(t){return v.apply(e),t})).next((function(t){return a.He.removeMatchingKeysForTargetId(e,p.targetId).next((function(){return a.He.addMatchingKeys(e,o,p.targetId)})).next((function(){return a.Wn.Vn(e,t)})).next((function(){return t}))}))})));case 9:case"end":return e.stop()}}),e)}))),Dc.apply(this,arguments)}function Cc(e,t){return Nc.apply(this,arguments)}function Nc(){return Nc=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:No(),e.next=3,bc(t,Za(gu(n.bundledQuery)));case 3:return i=e.sent,a=Wr(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Yo(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Ye.saveNamedQuery(e,n);var o=i.withResumeToken(Ti.EMPTY_BYTE_STRING,t);return a.qn=a.qn.insert(o.targetId,o),a.He.updateTargetData(e,o).next((function(){return a.He.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.He.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Ye.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),Nc.apply(this,arguments)}var Rc=function(){function e(t){(0,v.Z)(this,e),this.k=t,this.Xn=new Map,this.Zn=new Map}return(0,p.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Hs.resolve(this.Xn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:Yo(n.createTime)}),Hs.resolve()}},{key:"getNamedQuery",value:function(e,t){return Hs.resolve(this.Zn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:gu(e.bundledQuery),readTime:Yo(e.readTime)}}(t)),Hs.resolve()}}]),e}(),Oc=function(){function e(){(0,v.Z)(this,e),this.ts=new Eo(Lc.es),this.ns=new Eo(Lc.ss)}return(0,p.Z)(e,[{key:"isEmpty",value:function(){return this.ts.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Lc(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}},{key:"rs",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.os(new Lc(e,t))}},{key:"cs",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"us",value:function(e){var t=this,n=new Li(new ki([])),r=new Lc(n,e),i=new Lc(n,e+1),a=[];return this.ns.forEachInRange([r,i],(function(e){t.os(e),a.push(e.key)})),a}},{key:"hs",value:function(){var e=this;this.ts.forEach((function(t){return e.os(t)}))}},{key:"os",value:function(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}},{key:"ls",value:function(e){var t=new Li(new ki([])),n=new Lc(t,e),r=new Lc(t,e+1),i=No();return this.ns.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Lc(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Lc=function(){function e(t,n){(0,v.Z)(this,e),this.key=t,this.fs=n}return(0,p.Z)(e,null,[{key:"es",value:function(e,t){return Li.comparator(e.key,t.key)||li(e.fs,t.fs)}},{key:"ss",value:function(e,t){return li(e.fs,t.fs)||Li.comparator(e.key,t.key)}}]),e}(),Mc=function(){function e(t,n){(0,v.Z)(this,e),this.Jt=t,this.referenceDelegate=n,this.An=[],this.ds=1,this.ws=new Eo(Lc.es)}return(0,p.Z)(e,[{key:"checkEmpty",value:function(e){return Hs.resolve(0===this.An.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];var a=new au(i,t,n,r);this.An.push(a);var o,s=(0,u.Z)(r);try{for(s.s();!(o=s.n()).done;){var c=o.value;this.ws=this.ws.add(new Lc(c.key,i)),this.Jt.addToCollectionParentIndex(e,c.key.path.popLast())}}catch(l){s.e(l)}finally{s.f()}return Hs.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Hs.resolve(this._s(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.gs(n),i=r<0?0:r;return Hs.resolve(this.An.length>i?this.An[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Hs.resolve(0===this.An.length?-1:this.ds-1)}},{key:"getAllMutationBatches",value:function(e){return Hs.resolve(this.An.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Lc(t,0),i=new Lc(t,Number.POSITIVE_INFINITY),a=[];return this.ws.forEachInRange([r,i],(function(e){var t=n._s(e.fs);a.push(t)})),Hs.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Eo(li);return t.forEach((function(e){var t=new Lc(e,0),i=new Lc(e,Number.POSITIVE_INFINITY);n.ws.forEachInRange([t,i],(function(e){r=r.add(e.fs)}))})),Hs.resolve(this.ys(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;Li.isDocumentKey(i)||(i=i.child(""));var a=new Lc(new Li(i),0),o=new Eo(li);return this.ws.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)}),a),Hs.resolve(this.ys(o))}},{key:"ys",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t._s(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Gr(0===this.ps(t.batchId,"removed")),this.An.shift();var r=this.ws;return Hs.forEach(t.mutations,(function(i){var a=new Lc(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ws=r}))}},{key:"ee",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Lc(t,0),r=this.ws.firstAfterOrEqual(n);return Hs.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.An.length,Hs.resolve()}},{key:"ps",value:function(e,t){return this.gs(e)}},{key:"gs",value:function(e){return 0===this.An.length?0:e-this.An[0].batchId}},{key:"_s",value:function(e){var t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}]),e}(),Pc=function(){function e(t,n){(0,v.Z)(this,e),this.Jt=t,this.Ts=n,this.docs=new wo(Li.comparator),this.size=0}return(0,p.Z)(e,[{key:"addEntry",value:function(e,t,n){var r=t.key,i=this.docs.get(r),a=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-a,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Hs.resolve(n?n.document.clone():Ji.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=So();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.clone():Ji.newInvalidDocument(e))})),Hs.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){for(var r=So(),i=new Li(t.path.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var o=a.getNext(),s=o.key,u=o.value,c=u.document,l=u.readTime;if(!t.path.isPrefixOf(s.path))break;l.compareTo(n)<=0||Ra(t,c)&&(r=r.insert(c.key,c.clone()))}return Hs.resolve(r)}},{key:"Es",value:function(e,t){return Hs.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Fc(this)}},{key:"getSize",value:function(e){return Hs.resolve(this.size)}}]),e}(),Fc=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).De=e,r}return(0,p.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(t.De.addEntry(e,i.document,t.getReadTime(r))):t.De.removeEntry(r)})),Hs.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.De.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.De.getEntries(e,t)}}]),n}(Qu),Vc=function(){function e(t){(0,v.Z)(this,e),this.persistence=t,this.Is=new Wu((function(e){return ta(e)}),na),this.lastRemoteSnapshotVersion=vi.min(),this.highestTargetId=0,this.As=0,this.Rs=new Oc,this.targetCount=0,this.Ps=Lu.ie()}return(0,p.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Is.forEach((function(e,n){return t(n)})),Hs.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Hs.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Hs.resolve(this.As)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Ps.next(),Hs.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),Hs.resolve()}},{key:"ce",value:function(e){this.Is.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Ps=new Lu(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.ce(t),this.targetCount+=1,Hs.resolve()}},{key:"updateTargetData",value:function(e,t){return this.ce(t),Hs.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,Hs.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Is.forEach((function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Is.delete(o),a.push(r.removeMatchingKeysForTargetId(e,s.targetId)),i++)})),Hs.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Hs.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Is.get(t)||null;return Hs.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Rs.rs(t,n),Hs.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Rs.cs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Hs.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Rs.us(t),Hs.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Rs.ls(t);return Hs.resolve(n)}},{key:"containsKey",value:function(e,t){return Hs.resolve(this.Rs.containsKey(t))}}]),e}(),Uc=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.bs={},this.Be=new si(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=t(this),this.He=new Vc(this),this.Jt=new Iu,this.Je=function(e,t){return new Pc(e,(function(e){return r.referenceDelegate.vs(e)}))}(this.Jt),this.k=new uu(n),this.Ye=new Rc(this.k)}return(0,p.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Ue=!1,Promise.resolve()}},{key:"started",get:function(){return this.Ue}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(){return this.Jt}},{key:"getMutationQueue",value:function(e){var t=this.bs[e.toKey()];return t||(t=new Mc(this.Jt,this.referenceDelegate),this.bs[e.toKey()]=t),t}},{key:"getTargetCache",value:function(){return this.He}},{key:"getRemoteDocumentCache",value:function(){return this.Je}},{key:"getBundleCache",value:function(){return this.Ye}},{key:"runTransaction",value:function(e,t,n){var r=this;qr("MemoryPersistence","Starting transaction:",e);var i=new qc(this.Be.next());return this.referenceDelegate.Vs(),n(i).next((function(e){return r.referenceDelegate.Ss(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ds",value:function(e,t){return Hs.or(Object.values(this.bs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),qc=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,p.Z)(n)}(Gs),Bc=function(){function e(t){(0,v.Z)(this,e),this.persistence=t,this.Cs=new Oc,this.Ns=null}return(0,p.Z)(e,[{key:"xs",get:function(){if(this.Ns)return this.Ns;throw zr()}},{key:"addReference",value:function(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),Hs.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),Hs.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.xs.add(t.toString()),Hs.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Cs.us(t.targetId).forEach((function(e){return n.xs.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.xs.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Vs",value:function(){this.Ns=new Set}},{key:"Ss",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Hs.forEach(this.xs,(function(r){var i=Li.fromPath(r);return t.$s(e,i).next((function(e){e||n.removeEntry(i)}))})).next((function(){return t.Ns=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.$s(e,t).next((function(e){e?n.xs.delete(t.toString()):n.xs.add(t.toString())}))}},{key:"vs",value:function(e){return 0}},{key:"$s",value:function(e,t){var n=this;return Hs.or([function(){return Hs.resolve(n.Cs.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ds(e,t)}])}}],[{key:"ks",value:function(t){return new e(t)}}]),e}();function jc(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Kc(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function zc(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Gc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,p.Z)(e,[{key:"Os",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Fs",value:function(t,n,r){var i,a=JSON.parse(r),o="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return o&&a.error&&((o="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new Yr(a.error.code,a.error.message))),o?new e(t,n,a.state,i):(Br("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),Hc=function(){function e(t,n,r){(0,v.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,p.Z)(e,[{key:"Os",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Fs",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Yr(i.error.code,i.error.message))),a?new e(t,i.state,r):(Br("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Wc=function(){function e(t,n){(0,v.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,p.Z)(e,null,[{key:"Fs",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=Oo(),o=0;i&&o<r.activeTargetIds.length;++o)i=Oi(r.activeTargetIds[o]),a=a.add(r.activeTargetIds[o]);return i?new e(t,a):(Br("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Qc=function(){function e(t,n){(0,v.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,p.Z)(e,null,[{key:"Fs",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Br("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),Yc=function(){function e(){(0,v.Z)(this,e),this.activeTargetIds=Oo()}return(0,p.Z)(e,[{key:"Ms",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Ls",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Os",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),Xc=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.window=t,this.Oe=n,this.persistenceKey=r,this.Bs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new wo(li),this.started=!1,this.js=[];var o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Qs=jc(this.persistenceKey,this.Bs),this.Ws=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new Yc),this.Gs=new RegExp("^firestore_clients_".concat(o,"_([^_]*)$")),this.zs=new RegExp("^firestore_mutations_".concat(o,"_(\\d+)(?:_(.*))?$")),this.Hs=new RegExp("^firestore_targets_".concat(o,"_(\\d+)$")),this.Js=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Ys=function(e){return"firestore_bundle_loaded_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}return(0,p.Z)(e,[{key:"start",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n,r,i,a,o,s,c,l,h,f,d=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Tn();case 2:t=e.sent,n=(0,u.Z)(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.Bs){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(jc(this.persistenceKey,i)))&&(o=Wc.Fs(i,a))&&(this.Ks=this.Ks.insert(o.clientId,o));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.Xs(),(s=this.storage.getItem(this.Js))&&(c=this.Zs(s))&&this.ti(c),l=(0,u.Z)(this.js);try{for(l.s();!(h=l.n()).done;)f=h.value,this.qs(f)}catch(v){l.e(v)}finally{l.f()}this.js=[],this.window.addEventListener("pagehide",(function(){return d.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.Ws,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.ei(this.Ks)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.Ks.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.ni(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.ni(e,t,n),this.si(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(zc(this.persistenceKey,e));if(n){var r=Hc.Fs(e,n);r&&(t=r.state)}}return this.ii.Ms(e),this.Xs(),t}},{key:"removeLocalQueryTarget",value:function(e){this.ii.Ls(e),this.Xs()}},{key:"isLocalQueryTarget",value:function(e){return this.ii.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(zc(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.ri(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.si(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.oi(e)}},{key:"notifyBundleLoaded",value:function(){this.ai()}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return qr("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){qr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){qr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"qs",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(qr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Qs)return void Br("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,c.Z)(m().mark((function e(){var r,i,a,o,s,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=41;break}if(null===n.key){e.next=39;break}if(!t.Gs.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.ci(n.key),e.abrupt("return",t.ui(r,null));case 6:if(!(i=t.hi(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.ui(i.clientId,i));case 9:e.next=39;break;case 11:if(!t.zs.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.li(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.fi(a));case 16:e.next=39;break;case 18:if(!t.Hs.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(o=t.di(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.wi(o));case 23:e.next=39;break;case 25:if(n.key!==t.Js){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(s=t.Zs(n.newValue))){e.next=30;break}return e.abrupt("return",t.ti(s));case 30:e.next=39;break;case 32:if(n.key!==t.Ws){e.next=37;break}u=function(e){var t=si.I;if(null!=e)try{var n=JSON.parse(e);Gr("number"==typeof n),t=n}catch(e){Br("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),u!==si.I&&t.sequenceNumberHandler(u),e.next=39;break;case 37:if(n.key!==t.Ys){e.next=39;break}return e.abrupt("return",t.syncEngine._i());case 39:e.next=42;break;case 41:t.js.push(n);case 42:case"end":return e.stop()}}),e)}))))}}},{key:"ii",get:function(){return this.Ks.get(this.Bs)}},{key:"Xs",value:function(){this.setItem(this.Qs,this.ii.Os())}},{key:"ni",value:function(e,t,n){var r=new Gc(this.currentUser,e,t,n),i=Kc(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}},{key:"si",value:function(e){var t=Kc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"oi",value:function(e){var t={clientId:this.Bs,onlineState:e};this.storage.setItem(this.Js,JSON.stringify(t))}},{key:"ri",value:function(e,t,n){var r=zc(this.persistenceKey,e),i=new Hc(e,t,n);this.setItem(r,i.Os())}},{key:"ai",value:function(){this.setItem(this.Ys,"value-not-used")}},{key:"ci",value:function(e){var t=this.Gs.exec(e);return t?t[1]:null}},{key:"hi",value:function(e,t){var n=this.ci(e);return Wc.Fs(n,t)}},{key:"li",value:function(e,t){var n=this.zs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Gc.Fs(new Mr(i),r,t)}},{key:"di",value:function(e,t){var n=this.Hs.exec(e),r=Number(n[1]);return Hc.Fs(r,t)}},{key:"Zs",value:function(e){return Qc.Fs(e)}},{key:"fi",value:function(){var e=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.mi(t.batchId,t.state,t.error));case 2:qr("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"wi",value:function(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}},{key:"ui",value:function(e,t){var n=this,r=t?this.Ks.insert(e,t):this.Ks.remove(e),i=this.ei(this.Ks),a=this.ei(r),o=[],s=[];return a.forEach((function(e){i.has(e)||o.push(e)})),i.forEach((function(e){a.has(e)||s.push(e)})),this.syncEngine.yi(o,s).then((function(){n.Ks=r}))}},{key:"ti",value:function(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"ei",value:function(e){var t=Oo();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"bt",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Jc=function(){function e(){(0,v.Z)(this,e),this.pi=new Yc,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,p.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.Ti[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.pi.Ls(e)}},{key:"isLocalQueryTarget",value:function(e){return this.pi.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.Ti[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.pi.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.pi.activeTargetIds.has(e)}},{key:"start",value:function(){return this.pi=new Yc,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(){}}]),e}(),$c=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"Ei",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),el=function(){function e(){var t=this;(0,v.Z)(this,e),this.Ii=function(){return t.Ai()},this.Ri=function(){return t.Pi()},this.bi=[],this.vi()}return(0,p.Z)(e,[{key:"Ei",value:function(e){this.bi.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}},{key:"vi",value:function(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}},{key:"Ai",value:function(){qr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=(0,u.Z)(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Pi",value:function(){qr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=(0,u.Z)(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"bt",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),tl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},nl=function(){function e(t){(0,v.Z)(this,e),this.Vi=t.Vi,this.Si=t.Si}return(0,p.Z)(e,[{key:"Di",value:function(e){this.Ci=e}},{key:"Ni",value:function(e){this.ki=e}},{key:"onMessage",value:function(e){this.xi=e}},{key:"close",value:function(){this.Si()}},{key:"send",value:function(e){this.Vi(e)}},{key:"$i",value:function(){this.Ci()}},{key:"Fi",value:function(e){this.ki(e)}},{key:"Oi",value:function(e){this.xi(e)}}]),e}(),rl=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return(0,p.Z)(n,[{key:"Ki",value:function(e,t,n,r){return new Promise((function(i,a){var o=new Or;o.listenOnce(_r.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case Zr.NO_ERROR:var t=o.getResponseJson();qr("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Zr.TIMEOUT:qr("Connection",'RPC "'+e+'" timed out'),a(new Yr(Qr.DEADLINE_EXCEEDED,"Request time out"));break;case Zr.HTTP_ERROR:var n=o.getStatus();if(qr("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var s=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(Qr).indexOf(t)>=0?t:Qr.UNKNOWN}(r.status);a(new Yr(s,r.message))}else a(new Yr(Qr.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new Yr(Qr.UNAVAILABLE,"Connection failed."));break;default:zr()}}finally{qr("Connection",'RPC "'+e+'" completed.')}}));var s=JSON.stringify(r);o.send(t,"POST",s,n,15)}))}},{key:"Qi",value:function(e,t,n){var r=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Sr(),a=Ar(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Nr({})),this.qi(o.initMessageHeaders,t,n),(0,b.uI)()||(0,b.b$)()||(0,b.d)()||(0,b.w1)()||(0,b.Mn)()||(0,b.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=r.join("");qr("Connection","Creating WebChannel: "+s,o);var u=i.createWebChannel(s,o),c=!1,l=!1,h=new nl({Vi:function(e){l?qr("Connection","Not sending because WebChannel is closed:",e):(c||(qr("Connection","Opening WebChannel transport."),u.open(),c=!0),qr("Connection","WebChannel sending:",e),u.send(e))},Si:function(){return u.close()}}),f=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return f(u,Rr.EventType.OPEN,(function(){l||qr("Connection","WebChannel transport opened.")})),f(u,Rr.EventType.CLOSE,(function(){l||(l=!0,qr("Connection","WebChannel transport closed"),h.Fi())})),f(u,Rr.EventType.ERROR,(function(e){l||(l=!0,jr("Connection","WebChannel transport errored:",e),h.Fi(new Yr(Qr.UNAVAILABLE,"The operation could not be completed")))})),f(u,Rr.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];Gr(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){qr("Connection","WebChannel received error:",i);var a=i.status,o=function(e){var t=fo[e];if(void 0!==t)return ko(t)}(a),s=i.message;void 0===o&&(o=Qr.INTERNAL,s="Unknown error status: "+a+" with message "+i.message),l=!0,h.Fi(new Yr(o,s)),u.close()}else qr("Connection","WebChannel received:",n),h.Oi(n)}})),f(a,Dr.STAT_EVENT,(function(e){e.stat===Cr.PROXY?qr("Connection","Detected buffering proxy"):e.stat===Cr.NOPROXY&&qr("Connection","Detected no buffering proxy")})),setTimeout((function(){h.$i()}),0),h}}]),n}(function(){function e(t){(0,v.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Mi=n+"://"+t.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return(0,p.Z)(e,[{key:"Bi",value:function(e,t,n,r,i){var a=this.Ui(e,t);qr("RestConnection","Sending: ",a,n);var o={};return this.qi(o,r,i),this.Ki(e,a,o,n).then((function(e){return qr("RestConnection","Received: ",e),e}),(function(t){throw jr("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t}))}},{key:"ji",value:function(e,t,n,r,i){return this.Bi(e,t,n,r,i)}},{key:"qi",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Pr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"Ui",value:function(e,t){var n=tl[e];return"".concat(this.Mi,"/v1/").concat(t,":").concat(n)}}]),e}());function il(){return"undefined"!=typeof window?window:null}function al(){return"undefined"!=typeof document?document:null}function ol(e){return new Go(e,!0)}var sl=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,v.Z)(this,e),this.Oe=t,this.timerId=n,this.Wi=r,this.Gi=i,this.zi=a,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}return(0,p.Z)(e,[{key:"reset",value:function(){this.Hi=0}},{key:"Xi",value:function(){this.Hi=this.zi}},{key:"Zi",value:function(e){var t=this;this.cancel();var n=Math.floor(this.Hi+this.tr()),r=Math.max(0,Date.now()-this.Yi),i=Math.max(0,n-r);i>0&&qr("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Hi," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,i,(function(){return t.Yi=Date.now(),e()})),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}},{key:"er",value:function(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}},{key:"cancel",value:function(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}},{key:"tr",value:function(){return(Math.random()-.5)*this.Hi}}]),e}(),ul=function(){function e(t,n,r,i,a,o,s,u){(0,v.Z)(this,e),this.Oe=t,this.nr=r,this.sr=i,this.ir=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new sl(t,n)}return(0,p.Z)(e,[{key:"hr",value:function(){return 1===this.state||5===this.state||this.lr()}},{key:"lr",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.dr()}},{key:"stop",value:function(){var e=(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.hr(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"wr",value:function(){this.state=0,this.ur.reset()}},{key:"_r",value:function(){var e=this;this.lr()&&null===this.ar&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,(function(){return e.mr()})))}},{key:"gr",value:function(e){this.yr(),this.stream.send(e)}},{key:"mr",value:function(){var e=(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.lr()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"yr",value:function(){this.ar&&(this.ar.cancel(),this.ar=null)}},{key:"pr",value:function(){this.cr&&(this.cr.cancel(),this.cr=null)}},{key:"close",value:function(){var e=(0,c.Z)(m().mark((function e(t,n){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==t?this.ur.reset():n&&n.code===Qr.RESOURCE_EXHAUSTED?(Br(n.toString()),Br("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):n&&n.code===Qr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Ni(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"Tr",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Er(this.rr),n=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,s.Z)(t,2),i=r[0],a=r[1];e.rr===n&&e.Ir(i,a)}),(function(n){t((function(){var t=new Yr(Qr.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Ar(t)}))}))}},{key:"Ir",value:function(e,t){var n=this,r=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di((function(){r((function(){return n.state=2,n.cr=n.Oe.enqueueAfterDelay(n.sr,1e4,(function(){return n.lr()&&(n.state=3),Promise.resolve()})),n.listener.Di()}))})),this.stream.Ni((function(e){r((function(){return n.Ar(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"dr",value:function(){var e=this;this.state=5,this.ur.Zi((0,c.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Ar",value:function(e){return qr("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Er",value:function(e){var t=this;return function(n){t.Oe.enqueueAndForget((function(){return t.rr===e?n():(qr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),cl=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,s){var u;return(0,v.Z)(this,n),(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,s)).k=o,u}return(0,p.Z)(n,[{key:"Rr",value:function(e,t){return this.ir.Qi("Listen",e,t)}},{key:"onMessage",value:function(e){this.ur.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:zr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.C?(Gr(void 0===t||"string"==typeof t),Ti.fromBase64String(t||"")):(Gr(void 0===t||t instanceof Uint8Array),Ti.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&function(e){var t=void 0===e.code?Qr.UNKNOWN:ko(e.code);return new Yr(t,e.message||"")}(o);n=new Vo(r,i,a,s||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var c=es(e,u.document.name),l=Yo(u.document.updateTime),h=new Yi({mapValue:{fields:u.document.fields}}),f=Ji.newFoundDocument(c,l,h),d=u.targetIds||[],v=u.removedTargetIds||[];n=new Po(d,v,f.key,f)}else if("documentDelete"in t){t.documentDelete;var p=t.documentDelete;p.document;var y=es(e,p.document),m=p.readTime?Yo(p.readTime):vi.min(),g=Ji.newNoDocument(y,m),k=p.removedTargetIds||[];n=new Po([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=es(e,w.document),I=w.removedTargetIds||[];n=new Po([],I,b,null)}else{if(!("filter"in t))return zr();t.filter;var E=t.filter;E.targetId;var T=E.count||0,x=new mo(T),S=E.targetId;n=new Fo(S,x)}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return vi.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?vi.min():t.readTime?Yo(t.readTime):vi.min()}(e);return this.listener.Pr(t,n)}},{key:"br",value:function(e){var t={};t.database=rs(this.k),t.addTarget=function(e,t){var n,r=t.target;return(n=ra(r)?{documents:ls(e,r)}:{query:hs(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Wo(e,t.resumeToken):t.snapshotVersion.compareTo(vi.min())>0&&(n.readTime=Ho(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,e);n&&(t.labels=n),this.gr(t)}},{key:"vr",value:function(e){var t={};t.database=rs(this.k),t.removeTarget=e,this.gr(t)}}]),n}(ul),ll=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,s){var u;return(0,v.Z)(this,n),(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,s)).k=o,u.Vr=!1,u}return(0,p.Z)(n,[{key:"Sr",get:function(){return this.Vr}},{key:"start",value:function(){this.Vr=!1,this.lastStreamToken=void 0,(0,a.Z)((0,o.Z)(n.prototype),"start",this).call(this)}},{key:"Tr",value:function(){this.Vr&&this.Dr([])}},{key:"Rr",value:function(e,t){return this.ir.Qi("Write",e,t)}},{key:"onMessage",value:function(e){if(Gr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();var t=function(e,t){return e&&e.length>0?(Gr(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Yo(e.updateTime):Yo(t);return n.isEqual(vi.min())&&(n=Yo(t)),new Ja(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Yo(e.commitTime);return this.listener.Cr(n,t)}return Gr(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}},{key:"kr",value:function(){var e={};e.database=rs(this.k),this.gr(e)}},{key:"Dr",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return us(t.k,e)}))};this.gr(n)}}]),n}(ul),hl=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a){var o;return(0,v.Z)(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.ir=i,o.k=a,o.$r=!1,o}return(0,p.Z)(n,[{key:"Fr",value:function(){if(this.$r)throw new Yr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Bi",value:function(e,t,n){var r=this;return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=(0,s.Z)(i,2),o=a[0],u=a[1];return r.ir.Bi(e,t,n,o,u)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===Qr.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new Yr(Qr.UNKNOWN,e.toString())}))}},{key:"ji",value:function(e,t,n){var r=this;return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=(0,s.Z)(i,2),o=a[0],u=a[1];return r.ir.ji(e,t,n,o,u)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===Qr.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new Yr(Qr.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.$r=!0}}]),n}(function(){return(0,p.Z)((function e(){(0,v.Z)(this,e)}))}()),fl=function(){function e(t,n){(0,v.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}return(0,p.Z)(e,[{key:"Br",value:function(){var e=this;0===this.Or&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.Mr=null,e.qr("Backend didn't respond within 10 seconds."),e.Ur("Offline"),Promise.resolve()})))}},{key:"Kr",value:function(e){"Online"===this.state?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.Ur("Offline")))}},{key:"set",value:function(e){this.jr(),this.Or=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}},{key:"Ur",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"qr",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.Lr?(Br(t),this.Lr=!1):qr("OnlineStateTracker",t)}},{key:"jr",value:function(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}]),e}(),dl=(0,p.Z)((function e(t,n,r,i,a){var o=this;(0,v.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=a,this.Hr.Ei((function(e){r.enqueueAndForget((0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Tl(o),!e.t0){e.next=5;break}return qr("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Wr(t)).Gr.add(4),e.next=4,yl(n);case 4:return n.Jr.set("Unknown"),n.Gr.delete(4),e.next=8,vl(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.Jr=new fl(r,i)}));function vl(e){return pl.apply(this,arguments)}function pl(){return pl=(0,c.Z)(m().mark((function e(t){var n,r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Tl(t)){e.next=18;break}n=(0,u.Z)(t.zr),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])}))),pl.apply(this,arguments)}function yl(e){return ml.apply(this,arguments)}function ml(){return ml=(0,c.Z)(m().mark((function e(t){var n,r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,u.Z)(t.zr),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])}))),ml.apply(this,arguments)}function gl(e,t){var n=Wr(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),El(n)?Il(n):Xl(n).lr()&&wl(n,t))}function kl(e,t){var n=Wr(e),r=Xl(n);n.Wr.delete(t),r.lr()&&bl(n,t),0===n.Wr.size&&(r.lr()?r._r():Tl(n)&&n.Jr.set("Unknown"))}function wl(e,t){e.Yr.X(t.targetId),Xl(e).br(t)}function bl(e,t){e.Yr.X(t),Xl(e).vr(t)}function Il(e){e.Yr=new qo({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Et:function(t){return e.Wr.get(t)||null}}),Xl(e).start(),e.Jr.Br()}function El(e){return Tl(e)&&!Xl(e).hr()&&e.Wr.size>0}function Tl(e){return 0===Wr(e).Gr.size}function xl(e){e.Yr=void 0}function Sl(e){return Al.apply(this,arguments)}function Al(){return Al=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Wr.forEach((function(e,n){wl(t,e)}));case 1:case"end":return e.stop()}}),e)}))),Al.apply(this,arguments)}function Zl(e,t){return _l.apply(this,arguments)}function _l(){return _l=(0,c.Z)(m().mark((function e(t,n){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:xl(t),El(t)?(t.Jr.Kr(n),Il(t)):t.Jr.set("Unknown");case 1:case"end":return e.stop()}}),e)}))),_l.apply(this,arguments)}function Dl(e,t,n){return Cl.apply(this,arguments)}function Cl(){return Cl=(0,c.Z)(m().mark((function e(t,n,r){var i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.Jr.set("Online"),!(n instanceof Vo&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=(0,u.Z)(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.Wr.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.Wr.delete(o),t.Yr.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),qr("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Nl(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof Po?t.Yr.ot(n):n instanceof Fo?t.Yr.dt(n):t.Yr.ut(n),r.isEqual(vi.min())){e.next=29;break}return e.prev=14,e.next=17,mc(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Yr.gt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.Wr.get(t);if(n){e.Wr.set(t,n.withResumeToken(Ti.EMPTY_BYTE_STRING,n.snapshotVersion)),bl(e,t);var r=new su(n.target,t,1,n.sequenceNumber);wl(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),qr("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Nl(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),Cl.apply(this,arguments)}function Nl(e,t,n){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,c.Z)(m().mark((function e(t,n,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Js(n)){e.next=2;break}throw n;case 2:return t.Gr.add(1),e.next=5,yl(t);case 5:t.Jr.set("Offline"),r||(r=function(){return mc(t.localStore)}),t.asyncQueue.enqueueRetryable((0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qr("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.Gr.delete(1),e.next=6,vl(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)}))),Rl.apply(this,arguments)}function Ol(e,t){return t().catch((function(n){return Nl(e,n,t)}))}function Ll(e){return Ml.apply(this,arguments)}function Ml(){return Ml=(0,c.Z)(m().mark((function e(t){var n,r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Wr(t),r=Jl(n),i=n.Qr.length>0?n.Qr[n.Qr.length-1].batchId:-1;case 2:if(!Pl(n)){e.next=19;break}return e.prev=3,e.next=6,wc(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.Qr.length&&r._r(),e.abrupt("break",19);case 10:i=a.batchId,Fl(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Nl(n,e.t0);case 17:e.next=2;break;case 19:Vl(n)&&Ul(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Ml.apply(this,arguments)}function Pl(e){return Tl(e)&&e.Qr.length<10}function Fl(e,t){e.Qr.push(t);var n=Jl(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function Vl(e){return Tl(e)&&!Jl(e).hr()&&e.Qr.length>0}function Ul(e){Jl(e).start()}function ql(e){return Bl.apply(this,arguments)}function Bl(){return Bl=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Jl(t).kr();case 1:case"end":return e.stop()}}),e)}))),Bl.apply(this,arguments)}function jl(e){return Kl.apply(this,arguments)}function Kl(){return Kl=(0,c.Z)(m().mark((function e(t){var n,r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Jl(t),r=(0,u.Z)(t.Qr);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Dr(a.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}}),e)}))),Kl.apply(this,arguments)}function zl(e,t,n){return Gl.apply(this,arguments)}function Gl(){return Gl=(0,c.Z)(m().mark((function e(t,n,r){var i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.Qr.shift(),a=ou.from(i,n,r),e.next=3,Ol(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Ll(t);case 5:case"end":return e.stop()}}),e)}))),Gl.apply(this,arguments)}function Hl(e,t){return Wl.apply(this,arguments)}function Wl(){return Wl=(0,c.Z)(m().mark((function e(t,n){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Jl(t).Sr,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,c.Z)(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!go(i=n.code)||i===Qr.ABORTED){e.next=7;break}return r=t.Qr.shift(),Jl(t).wr(),e.next=5,Ol(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Ll(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Vl(t)&&Ul(t);case 5:case"end":return e.stop()}}),e)}))),Wl.apply(this,arguments)}function Ql(e,t){return Yl.apply(this,arguments)}function Yl(){return Yl=(0,c.Z)(m().mark((function e(t,n){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Wr(t),!n){e.next=7;break}return r.Gr.delete(2),e.next=5,vl(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.Gr.add(2),e.next=12,yl(r);case 12:r.Jr.set("Unknown");case 13:case"end":return e.stop()}}),e)}))),Yl.apply(this,arguments)}function Xl(e){return e.Xr||(e.Xr=function(e,t,n){var r=Wr(e);return r.Fr(),new cl(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:Sl.bind(null,e),Ni:Zl.bind(null,e),Pr:Dl.bind(null,e)}),e.zr.push(function(){var t=(0,c.Z)(m().mark((function t(n){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.Xr.wr(),El(e)?Il(e):e.Jr.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.Xr.stop();case 6:xl(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Xr}function Jl(e){return e.Zr||(e.Zr=function(e,t,n){var r=Wr(e);return r.Fr(),new ll(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:ql.bind(null,e),Ni:Hl.bind(null,e),Nr:jl.bind(null,e),Cr:zl.bind(null,e)}),e.zr.push(function(){var t=(0,c.Z)(m().mark((function t(n){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Zr.wr(),t.next=4,Ll(e);case 4:t.next=9;break;case 6:return t.next=8,e.Zr.stop();case 8:e.Qr.length>0&&(qr("RemoteStore","Stopping write stream with ".concat(e.Qr.length," pending writes")),e.Qr=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Zr}var $l=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Xr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,p.Z)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Yr(Qr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function eh(e,t){if(Br("AsyncQueue","".concat(t,": ").concat(e)),Js(e))return new Yr(Qr.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var th=function(){function e(t){(0,v.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||Li.comparator(e.key,n.key)}:function(e,t){return Li.comparator(e.key,t.key)},this.keyedMap=Zo(),this.sortedSet=new wo(this.comparator)}return(0,p.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),nh=function(){function e(){(0,v.Z)(this,e),this.eo=new wo(Li.comparator)}return(0,p.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):zr():this.eo=this.eo.insert(t,e)}},{key:"no",value:function(){var e=[];return this.eo.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),rh=function(){function e(t,n,r,i,a,o,s,u){(0,v.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u}return(0,p.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Da(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,th.emptySet(n),a,r,i,!0,!1)}}]),e}(),ih=(0,p.Z)((function e(){(0,v.Z)(this,e),this.so=void 0,this.listeners=[]})),ah=(0,p.Z)((function e(){(0,v.Z)(this,e),this.queries=new Wu((function(e){return Ca(e)}),Da),this.onlineState="Unknown",this.io=new Set}));function oh(e,t){return sh.apply(this,arguments)}function sh(){return sh=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Wr(t),i=n.query,a=!1,(o=r.queries.get(i))||(a=!0,o=new ih),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:o.so=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),s=eh(e.t0,"Initialization of query '".concat(Na(n.query),"' failed")),e.abrupt("return",void n.onError(s));case 13:r.queries.set(i,o),o.listeners.push(n),n.ro(r.onlineState),o.so&&n.oo(o.so)&&fh(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),sh.apply(this,arguments)}function uh(e,t){return ch.apply(this,arguments)}function ch(){return ch=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Wr(t),i=n.query,a=!1,(o=r.queries.get(i))&&(s=o.listeners.indexOf(n))>=0&&(o.listeners.splice(s,1),a=0===o.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)}))),ch.apply(this,arguments)}function lh(e,t){var n,r=Wr(e),i=!1,a=(0,u.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.query,c=r.queries.get(s);if(c){var l,h=(0,u.Z)(c.listeners);try{for(h.s();!(l=h.n()).done;){l.value.oo(o)&&(i=!0)}}catch(f){h.e(f)}finally{h.f()}c.so=o}}}catch(f){a.e(f)}finally{a.f()}i&&fh(r)}function hh(e,t,n){var r=Wr(e),i=r.queries.get(t);if(i){var a,o=(0,u.Z)(i.listeners);try{for(o.s();!(a=o.n()).done;){a.value.onError(n)}}catch(s){o.e(s)}finally{o.f()}}r.queries.delete(t)}function fh(e){e.io.forEach((function(e){e.next()}))}var dh=function(){function e(t,n,r){(0,v.Z)(this,e),this.query=t,this.ao=n,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=r||{}}return(0,p.Z)(e,[{key:"oo",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=(0,u.Z)(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(o){r.e(o)}finally{r.f()}e=new rh(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.co?this.ho(e)&&(this.ao.next(e),a=!0):this.lo(e,this.onlineState)&&(this.fo(e),a=!0),this.uo=e,a}},{key:"onError",value:function(e){this.ao.error(e)}},{key:"ro",value:function(e){this.onlineState=e;var t=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}},{key:"lo",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.wo||!n)&&(!e.docs.isEmpty()||"Offline"===t)}},{key:"ho",value:function(e){if(e.docChanges.length>0)return!0;var t=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"fo",value:function(e){e=rh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}]),e}(),vh=function(){function e(t,n){(0,v.Z)(this,e),this.payload=t,this.byteLength=n}return(0,p.Z)(e,[{key:"_o",value:function(){return"metadata"in this.payload}}]),e}(),ph=function(){function e(t){(0,v.Z)(this,e),this.k=t}return(0,p.Z)(e,[{key:"Hn",value:function(e){return es(this.k,e)}},{key:"Jn",value:function(e){return e.metadata.exists?os(this.k,e.document,!1):Ji.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}},{key:"Yn",value:function(e){return Yo(e)}}]),e}(),yh=function(){function e(t,n,r){(0,v.Z)(this,e),this.mo=t,this.localStore=n,this.k=r,this.queries=[],this.documents=[],this.progress=mh(t)}return(0,p.Z)(e,[{key:"yo",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"po",value:function(e){var t,n=new Map,r=new ph(this.k),i=(0,u.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var o,s=r.Hn(a.metadata.name),c=(0,u.Z)(a.metadata.queries);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=(n.get(l)||No()).add(s);n.set(l,h)}}catch(f){c.e(f)}finally{c.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n,r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_c(this.localStore,new ph(this.k),this.documents,this.mo.id);case 2:t=e.sent,n=this.po(this.documents),r=(0,u.Z)(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Cc(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",new uc(Object.assign({},this.progress),t)));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function mh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var gh=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.key=t})),kh=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.key=t})),wh=function(){function e(t,n){(0,v.Z)(this,e),this.query=t,this.To=n,this.Eo=null,this.current=!1,this.Io=No(),this.mutatedKeys=No(),this.Ao=Oa(t),this.Ro=new th(this.Ao)}return(0,p.Z)(e,[{key:"Po",get:function(){return this.To}},{key:"bo",value:function(e,t){var n=this,r=t?t.vo:new nh,i=t?t.Ro:this.Ro,a=t?t.mutatedKeys:this.mutatedKeys,o=i,s=!1,u=Ia(this.query)&&i.size===this.query.limit?i.last():null,c=Ea(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),h=Ra(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.Vo(l,h)||(r.track({type:2,doc:h}),v=!0,(u&&n.Ao(h,u)>0||c&&n.Ao(h,c)<0)&&(s=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(u||c)&&(s=!0)),v&&(h?(o=o.add(h),a=d?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))})),Ia(this.query)||Ea(this.query))for(;o.size>this.query.limit;){var l=Ia(this.query)?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Ro:o,vo:r,Bn:s,mutatedKeys:a}}},{key:"Vo",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;var a=e.vo.no();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zr()}};return n(e)-n(t)}(e.type,t.type)||r.Ao(e.doc,t.doc)})),this.So(n);var o=t?this.Do():[],s=0===this.Io.size&&this.current?1:0,u=s!==this.Eo;return this.Eo=s,0!==a.length||u?{snapshot:new rh(this.query,e.Ro,i,a,e.mutatedKeys,0===s,u,!1),Co:o}:{Co:o}}},{key:"ro",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new nh,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}},{key:"No",value:function(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}},{key:"So",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.To=t.To.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.To=t.To.delete(e)})),this.current=e.current)}},{key:"Do",value:function(){var e=this;if(!this.current)return[];var t=this.Io;this.Io=No(),this.Ro.forEach((function(t){e.No(t.key)&&(e.Io=e.Io.add(t.key))}));var n=[];return t.forEach((function(t){e.Io.has(t)||n.push(new kh(t))})),this.Io.forEach((function(e){t.has(e)||n.push(new gh(e))})),n}},{key:"ko",value:function(e){this.To=e.zn,this.Io=No();var t=this.bo(e.documents);return this.applyChanges(t,!0)}},{key:"xo",value:function(){return rh.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}]),e}(),bh=(0,p.Z)((function e(t,n,r){(0,v.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),Ih=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.key=t,this.$o=!1})),Eh=function(){function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Fo={},this.Oo=new Wu((function(e){return Ca(e)}),Da),this.Mo=new Map,this.Lo=new Set,this.Bo=new wo(Li.comparator),this.Uo=new Map,this.qo=new Oc,this.Ko={},this.jo=new Map,this.Qo=Lu.re(),this.onlineState="Unknown",this.Wo=void 0}return(0,p.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Wo}}]),e}();function Th(e,t){return xh.apply(this,arguments)}function xh(){return xh=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o,s,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=gf(t),!(o=r.Oo.get(n))){e.next=6;break}i=o.targetId,r.sharedClientState.addLocalQueryTarget(i),a=o.view.xo(),e.next=15;break;case 6:return e.next=8,bc(r.localStore,Za(n));case 8:return s=e.sent,u=r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.targetId,e.next=13,Sh(r,n,i,"current"===u);case 13:a=e.sent,r.isPrimaryClient&&gl(r.remoteStore,s);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),xh.apply(this,arguments)}function Sh(e,t,n,r){return Ah.apply(this,arguments)}function Ah(){return Ah=(0,c.Z)(m().mark((function e(t,n,r,i){var a,o,s,u,l,h;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Go=function(e,n,r){return function(){var e=(0,c.Z)(m().mark((function e(t,n,r,i){var a,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.bo(r),e.t0=a.Bn,!e.t0){e.next=6;break}return e.next=5,Tc(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.bo(t,a)}));case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,o),e.abrupt("return",(Hh(t,n.targetId,s.Co),s.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,Tc(t.localStore,n,!0);case 3:return a=e.sent,o=new wh(n,a.zn),s=o.bo(a.documents),u=Mo.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),l=o.applyChanges(s,t.isPrimaryClient,u),Hh(t,r,l.Co),h=new bh(n,r,o),e.abrupt("return",(t.Oo.set(n,h),t.Mo.has(r)?t.Mo.get(r).push(n):t.Mo.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}}),e)}))),Ah.apply(this,arguments)}function Zh(e,t){return _h.apply(this,arguments)}function _h(){return _h=(0,c.Z)(m().mark((function e(t,n){var r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Wr(t),i=r.Oo.get(n),!((a=r.Mo.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.Mo.set(i.targetId,a.filter((function(e){return!Da(e,n)}))),void r.Oo.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,Ic(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),kl(r.remoteStore,i.targetId),zh(r,i.targetId)})).catch(Uu);case 9:e.next=14;break;case 11:return zh(r,i.targetId),e.next=14,Ic(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)}))),_h.apply(this,arguments)}function Dh(e,t,n){return Ch.apply(this,arguments)}function Ch(){return Ch=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=kf(t),e.prev=1,e.next=4,function(e,t){var n,r=Wr(e),i=di.now(),a=t.reduce((function(e,t){return e.add(t.key)}),No());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(e){return r.Wn.vn(e,a).next((function(a){n=a;var o,s=[],c=(0,u.Z)(t);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=io(l,n.get(l.key));null!=h&&s.push(new uo(l.key,h,Xi(h.value.mapValue),$a.exists(!0)))}}catch(f){c.e(f)}finally{c.f()}return r.An.addMutationBatch(e,i,s,t)}))})).then((function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Ko[e.currentUser.toKey()];r||(r=new wo(li)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Yh(i,a.changes);case 9:return e.next=11,Ll(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=eh(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Ch.apply(this,arguments)}function Nh(e,t){return Rh.apply(this,arguments)}function Rh(){return Rh=(0,c.Z)(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),e.prev=1,e.next=4,gc(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Uo.get(t);n&&(Gr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.$o=!0:e.modifiedDocuments.size>0?Gr(n.$o):e.removedDocuments.size>0&&(Gr(n.$o),n.$o=!1))})),e.next=8,Yh(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Uu(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),Rh.apply(this,arguments)}function Oh(e,t,n){var r=Wr(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Oo.forEach((function(e,n){var r=n.view.ro(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=Wr(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=(0,u.Z)(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.ro(t)&&(r=!0)}}catch(o){a.e(o)}finally{a.f()}})),r&&fh(n)}(r.eventManager,t),i.length&&r.Fo.Pr(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Lh(e,t,n){return Mh.apply(this,arguments)}function Mh(){return Mh=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o,s,u,c;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=Wr(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Uo.get(n),!(o=a&&a.key)){e.next=14;break}return s=(s=new wo(Li.comparator)).insert(o,Ji.newNoDocument(o,vi.min())),u=No().add(o),c=new Lo(vi.min(),new Map,new Eo(li),s,u),e.next=9,Nh(i,c);case 9:i.Bo=i.Bo.remove(o),i.Uo.delete(n),Qh(i),e.next=16;break;case 14:return e.next=16,Ic(i.localStore,n,!1).then((function(){return zh(i,n,r)})).catch(Uu);case 16:case"end":return e.stop()}}),e)}))),Mh.apply(this,arguments)}function Ph(e,t){return Fh.apply(this,arguments)}function Fh(){return Fh=(0,c.Z)(m().mark((function e(t,n){var r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),i=n.batch.batchId,e.prev=1,e.next=4,yc(r.localStore,n);case 4:return a=e.sent,Kh(r,i,null),jh(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,Yh(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Uu(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Fh.apply(this,arguments)}function Vh(e,t,n){return Uh.apply(this,arguments)}function Uh(){return Uh=(0,c.Z)(m().mark((function e(t,n,r){var i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Wr(t),e.prev=1,e.next=4,function(e,t){var n=Wr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.An.lookupMutationBatch(e,t).next((function(t){return Gr(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t)})).next((function(){return n.An.performConsistencyCheck(e)})).next((function(){return n.Wn.vn(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,Kh(i,n,r),jh(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Yh(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Uu(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Uh.apply(this,arguments)}function qh(e,t){return Bh.apply(this,arguments)}function Bh(){return Bh=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Tl((r=Wr(t)).remoteStore)||qr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=Wr(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.An.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.jo.get(i)||[]).push(n),r.jo.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),o=eh(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(o);case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),Bh.apply(this,arguments)}function jh(e,t){(e.jo.get(t)||[]).forEach((function(e){e.resolve()})),e.jo.delete(t)}function Kh(e,t,n){var r=Wr(e),i=r.Ko[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function zh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=(0,u.Z)(e.Mo.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.Oo.delete(a),n&&e.Fo.zo(a,n)}}catch(o){i.e(o)}finally{i.f()}e.Mo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach((function(t){e.qo.containsKey(t)||Gh(e,t)}))}function Gh(e,t){e.Lo.delete(t.path.canonicalString());var n=e.Bo.get(t);null!==n&&(kl(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Qh(e))}function Hh(e,t,n){var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof gh?(e.qo.addReference(a.key,t),Wh(e,a)):a instanceof kh?(qr("SyncEngine","Document no longer in limbo: "+a.key),e.qo.removeReference(a.key,t),e.qo.containsKey(a.key)||Gh(e,a.key)):zr()}}catch(o){i.e(o)}finally{i.f()}}function Wh(e,t){var n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(qr("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Qh(e))}function Qh(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){var t=e.Lo.values().next().value;e.Lo.delete(t);var n=new Li(ki.fromString(t)),r=e.Qo.next();e.Uo.set(r,new Ih(n)),e.Bo=e.Bo.insert(n,r),gl(e.remoteStore,new su(Za(ba(n.path)),r,2,si.I))}}function Yh(e,t,n){return Xh.apply(this,arguments)}function Xh(){return Xh=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Wr(t),a=[],o=[],s=[],e.t0=i.Oo.isEmpty(),e.t0){e.next=9;break}return i.Oo.forEach((function(e,t){s.push(i.Go(t,n,r).then((function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=lc.$n(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.Fo.Pr(a),e.next=9,function(){var e=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o,s,c,l,h;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Hs.forEach(n,(function(t){return Hs.forEach(t.kn,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Hs.forEach(t.xn,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Js(e.t0)){e.next=10;break}throw e.t0;case 10:qr("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=(0,u.Z)(n);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.targetId,o.fromCache||(c=r.qn.get(s),l=c.snapshotVersion,h=c.withLastLimboFreeSnapshotVersion(l),r.qn=r.qn.insert(s,h))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),Xh.apply(this,arguments)}function Jh(e,t){return $h.apply(this,arguments)}function $h(){return $h=(0,c.Z)(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Wr(t)).currentUser.isEqual(n)){e.next=11;break}return qr("SyncEngine","User change. New user:",n.toKey()),e.next=5,vc(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.jo.forEach((function(e){e.forEach((function(e){e.reject(new Yr(Qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.jo.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Yh(r,i.Gn);case 11:case"end":return e.stop()}}),e)}))),$h.apply(this,arguments)}function ef(e,t){var n=Wr(e),r=n.Uo.get(t);if(r&&r.$o)return No().add(r.key);var i=No(),a=n.Mo.get(t);if(!a)return i;var o,s=(0,u.Z)(a);try{for(s.s();!(o=s.n()).done;){var c=o.value,l=n.Oo.get(c);i=i.unionWith(l.view.Po)}}catch(h){s.e(h)}finally{s.f()}return i}function tf(e,t){return nf.apply(this,arguments)}function nf(){return nf=(0,c.Z)(m().mark((function e(t,n){var r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),e.next=3,Tc(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.ko(i),e.abrupt("return",(r.isPrimaryClient&&Hh(r,n.targetId,a.Co),a));case 6:case"end":return e.stop()}}),e)}))),nf.apply(this,arguments)}function rf(e){return af.apply(this,arguments)}function af(){return af=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wr(t),e.abrupt("return",Sc(n.localStore).then((function(e){return Yh(n,e)})));case 2:case"end":return e.stop()}}),e)}))),af.apply(this,arguments)}function of(e,t,n,r){return sf.apply(this,arguments)}function sf(){return sf=(0,c.Z)(m().mark((function e(t,n,r,i){var a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Wr(t),e.next=3,function(e,t){var n=Wr(e),r=Wr(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Zt(e,t).next((function(t){return t?n.Wn.vn(e,t):Hs.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(o=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Ll(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Kh(a,n,i||null),jh(a,n),function(e,t){Wr(Wr(e).An).ee(t)}(a.localStore,n)):zr();case 11:return e.next=13,Yh(a,o);case 13:e.next=16;break;case 15:qr("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)}))),sf.apply(this,arguments)}function uf(e,t){return cf.apply(this,arguments)}function cf(){return cf=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o,s,c,l,h;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gf(r=Wr(t)),kf(r),!0!==n||!0===r.Wo){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,lf(r,i.toArray());case 5:return a=e.sent,r.Wo=!0,e.next=9,Ql(r.remoteStore,!0);case 9:o=(0,u.Z)(a);try{for(o.s();!(s=o.n()).done;)c=s.value,gl(r.remoteStore,c)}catch(f){o.e(f)}finally{o.f()}e.next=25;break;case 13:if(!1!==n||!1===r.Wo){e.next=25;break}return l=[],h=Promise.resolve(),r.Mo.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?l.push(t):h=h.then((function(){return zh(r,t),Ic(r.localStore,t,!0)})),kl(r.remoteStore,t)})),e.next=19,h;case 19:return e.next=21,lf(r,l);case 21:return function(e){var t=Wr(e);t.Uo.forEach((function(e,n){kl(t.remoteStore,n)})),t.qo.hs(),t.Uo=new Map,t.Bo=new wo(Li.comparator)}(r),r.Wo=!1,e.next=25,Ql(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)}))),cf.apply(this,arguments)}function lf(e,t,n){return hf.apply(this,arguments)}function hf(){return hf=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o,s,c,l,h,f,d,v,p,y,g,k;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Wr(t),a=[],o=[],s=(0,u.Z)(n),e.prev=2,s.s();case 4:if((c=s.n()).done){e.next=45;break}if(l=c.value,h=void 0,!(f=i.Mo.get(l))||0===f.length){e.next=34;break}return e.next=11,bc(i.localStore,Za(f[0]));case 11:h=e.sent,d=(0,u.Z)(f),e.prev=13,d.s();case 15:if((v=d.n()).done){e.next=24;break}return p=v.value,y=i.Oo.get(p),e.next=20,tf(i,y);case 20:(g=e.sent).snapshot&&o.push(g.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),d.e(e.t0);case 29:return e.prev=29,d.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,xc(i.localStore,l);case 36:return k=e.sent,e.next=39,bc(i.localStore,k);case 39:return h=e.sent,e.next=42,Sh(i,ff(k),l,!1);case 42:a.push(h);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),s.e(e.t1);case 50:return e.prev=50,s.f(),e.finish(50);case 53:return e.abrupt("return",(i.Fo.Pr(o),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])}))),hf.apply(this,arguments)}function ff(e){return wa(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function df(e){var t=Wr(e);return Wr(Wr(t.localStore).persistence).Tn()}function vf(e,t,n,r){return pf.apply(this,arguments)}function pf(){return pf=(0,c.Z)(m().mark((function e(t,n,r,i){var a,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Wr(t)).Wo){e.next=5;break}qr("SyncEngine","Ignoring unexpected query state notification."),e.next=21;break;case 5:if(!a.Mo.has(n)){e.next=21;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?9:"rejected"===e.t0?16:20;break;case 9:return e.next=11,Sc(a.localStore);case 11:return o=e.sent,s=Lo.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=15,Yh(a,o,s);case 15:return e.abrupt("break",21);case 16:return e.next=18,Ic(a.localStore,n,!0);case 18:return zh(a,n,i),e.abrupt("break",21);case 20:zr();case 21:case"end":return e.stop()}}),e)}))),pf.apply(this,arguments)}function yf(e,t,n){return mf.apply(this,arguments)}function mf(){return mf=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o,s,c,l,h,f,d;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=gf(t)).Wo){e.next=45;break}a=(0,u.Z)(n),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=21;break}if(s=o.value,!i.Mo.has(s)){e.next=10;break}return qr("SyncEngine","Adding an already active target "+s),e.abrupt("continue",19);case 10:return e.next=12,xc(i.localStore,s);case 12:return c=e.sent,e.next=15,bc(i.localStore,c);case 15:return l=e.sent,e.next=18,Sh(i,ff(c),l.targetId,!1);case 18:gl(i.remoteStore,l);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:h=(0,u.Z)(r),e.prev=30,d=m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.Mo.has(t),!e.t0){e.next=5;break}return e.next=5,Ic(i.localStore,t,!1).then((function(){kl(i.remoteStore,t),zh(i,t)})).catch(Uu);case 5:case"end":return e.stop()}}),e)})),h.s();case 33:if((f=h.n()).done){e.next=37;break}return e.delegateYield(d(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),h.e(e.t2);case 42:return e.prev=42,h.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])}))),mf.apply(this,arguments)}function gf(e){var t=Wr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ef.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lh.bind(null,t),t.Fo.Pr=lh.bind(null,t.eventManager),t.Fo.zo=hh.bind(null,t.eventManager),t}function kf(e){var t=Wr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ph.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Vh.bind(null,t),t}function wf(e,t,n){var r=Wr(e);(function(){var e=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o,s,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=Wr(e),r=Yo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Ye.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=10;break}return e.next=9,n.close();case 9:return e.abrupt("return",void r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)));case 10:return r._updateProgress(mh(i)),a=new yh(i,t.localStore,n.k),e.next=14,n.Ho();case 14:o=e.sent;case 15:if(!o){e.next=25;break}return e.next=18,a.yo(o);case 18:return(s=e.sent)&&r._updateProgress(s),e.next=22,n.Ho();case 22:o=e.sent;case 23:e.next=15;break;case 25:return e.next=27,a.complete();case 27:return u=e.sent,e.next=30,Yh(t,u.In,void 0);case 30:return e.next=32,function(e,t){var n=Wr(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Ye.saveBundleMetadata(e,t)}))}(t.localStore,i);case 32:r._completeWith(u.progress),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),jr("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n,r){return e.apply(this,arguments)}})()(r,t,n).then((function(){r.sharedClientState.notifyBundleLoaded()}))}var bf=function(){function e(){(0,v.Z)(this,e),this.synchronizeTabs=!1}return(0,p.Z)(e,[{key:"initialize",value:function(){var e=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.k=ol(t.databaseInfo.databaseId),this.sharedClientState=this.Jo(t),this.persistence=this.Yo(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.Xo(t),this.localStore=this.Zo(t);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Xo",value:function(e){return null}},{key:"Zo",value:function(e){return dc(this.persistence,new hc,e.initialUser,this.k)}},{key:"Yo",value:function(e){return new Uc(Bc.ks,this.k)}},{key:"Jo",value:function(e){return new Jc}},{key:"terminate",value:function(){var e=(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),If=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).ta=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return(0,p.Z)(n,[{key:"initialize",value:function(){var e=(0,c.Z)(m().mark((function e(t){var r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)((0,o.Z)(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,Ac(this.localStore);case 4:return e.next=6,this.ta.initialize(this,t);case 6:return e.next=8,kf(this.ta.syncEngine);case 8:return e.next=10,Ll(this.ta.remoteStore);case 10:return e.next=12,this.persistence.sn((function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()}));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Zo",value:function(e){return dc(this.persistence,new hc,e.initialUser,this.k)}},{key:"Xo",value:function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new Ku(t,e.asyncQueue)}},{key:"Yo",value:function(e){var t=sc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Au.withCacheSize(this.cacheSizeBytes):Au.DEFAULT;return new ic(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,il(),al(),this.k,this.sharedClientState,!!this.forceOwnership)}},{key:"Jo",value:function(e){return new Jc}}]),n}(bf),Ef=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,r,!1)).ta=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return(0,p.Z)(n,[{key:"initialize",value:function(){var e=(0,c.Z)(m().mark((function e(t){var r,i=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)((0,o.Z)(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.ta.syncEngine,e.t0=this.sharedClientState instanceof Xc,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={mi:of.bind(null,r),gi:vf.bind(null,r),yi:yf.bind(null,r),Tn:df.bind(null,r),_i:rf.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.sn(function(){var e=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,uf(i.ta.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start(i.localStore):t||i.gcScheduler.stop());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Jo",value:function(e){var t=il();if(!Xc.bt(t))throw new Yr(Qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=sc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Xc(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(If),Tf=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"initialize",value:function(){var e=(0,c.Z)(m().mark((function e(t,n){var r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Oh(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Jh.bind(null,this.syncEngine),e.next=12,Ql(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new ah}},{key:"createDatastore",value:function(e){var t,n=ol(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new rl(t));return function(e,t,n,r){return new hl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Oh(o.syncEngine,e,0)},a=el.bt()?new el:new $c,new dl(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,o){var s=new Eh(e,t,n,r,i,a);return o&&(s.Wo=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return function(){var e=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wr(t),qr("RemoteStore","RemoteStore shutting down."),n.Gr.add(5),e.next=5,yl(n);case 5:n.Hr.shutdown(),n.Jr.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore)}}]),e}();function xf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,c.Z)(m().mark((function r(){var i;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Sf=function(){function e(t){(0,v.Z)(this,e),this.observer=t,this.muted=!1}return(0,p.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.ea(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"na",value:function(){this.muted=!0}},{key:"ea",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),Af=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.sa=t,this.k=n,this.metadata=new Xr,this.buffer=new Uint8Array,this.ia=new TextDecoder("utf-8"),this.ra().then((function(e){e&&e._o()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}return(0,p.Z)(e,[{key:"close",value:function(){return this.sa.cancel()}},{key:"getMetadata",value:function(){var e=(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Ho",value:function(){var e=(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.ra());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ra",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n,r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.oa();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.ia.decode(t),r=Number(n),isNaN(r)&&this.aa("length string (".concat(n,") is not valid number")),e.next=9,this.ca(r);case 9:return i=e.sent,e.abrupt("return",new vh(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ua",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"oa",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.ua()<0)){e.next=7;break}return e.next=3,this.ha();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.ua())<0&&this.aa("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ca",value:function(){var e=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.ha();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.aa("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.ia.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"aa",value:function(e){throw this.sa.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"ha",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sa.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Zf=function(){function e(t){(0,v.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return(0,p.Z)(e,[{key:"lookup",value:function(){var e=(0,c.Z)(m().mark((function e(t){var n,r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new Yr(Qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=(0,c.Z)(m().mark((function e(t,n){var r,i,a,o,s,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),i=rs(r.k)+"/documents",a={documents:n.map((function(e){return $o(r.k,e)}))},e.next=5,r.ji("BatchGetDocuments",i,a);case 5:return o=e.sent,s=new Map,o.forEach((function(e){var t=ss(r.k,e);s.set(t.key.toString(),t)})),u=[],e.abrupt("return",(n.forEach((function(e){var t=s.get(e.toString());Gr(!!t),u.push(t)})),u));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new po(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=(0,c.Z)(m().mark((function e(){var t,n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=Li.fromPath(t);n.mutations.push(new yo(r,n.precondition(r)))})),e.next=7,function(){var e=(0,c.Z)(m().mark((function e(t,n){var r,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wr(t),i=rs(r.k)+"/documents",a={writes:n.map((function(e){return us(r.k,e)}))},e.next=3,r.Bi("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw zr();t=vi.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Yr(Qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?$a.updateTime(t):$a.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(vi.min()))throw new Yr(Qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $a.updateTime(t)}return $a.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),_f=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.la=5,this.ur=new sl(this.asyncQueue,"transaction_retry")}return(0,p.Z)(e,[{key:"run",value:function(){this.la-=1,this.fa()}},{key:"fa",value:function(){var e=this;this.ur.Zi((0,c.Z)(m().mark((function t(){var n,r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new Zf(e.datastore),(r=e.da(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.wa(t)}))}))})).catch((function(t){e.wa(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"da",value:function(e){try{var t=this.updateFunction(e);return!Ni(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"wa",value:function(e){var t=this;this.la>0&&this._a(e)?(this.la-=1,this.asyncQueue.enqueueAndForget((function(){return t.fa(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"_a",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!go(t)}return!1}}]),e}(),Df=function(){function e(t,n,r,i){var a=this;(0,v.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Mr.UNAUTHENTICATED,this.clientId=ci.A(),this.authCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qr("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(){return Promise.resolve()}))}return(0,p.Z)(e,[{key:"getConfiguration",value:function(){var e=(0,c.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new Yr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new Xr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,c.Z)(m().mark((function n(){var r;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=eh(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function Cf(e,t){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,c.Z)(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),qr("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,vc(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),Nf.apply(this,arguments)}function Rf(e,t){return Of.apply(this,arguments)}function Of(){return Of=(0,c.Z)(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Lf(t);case 3:return r=e.sent,qr("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return function(){var e=(0,c.Z)(m().mark((function e(t,n){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Wr(t)).asyncQueue.verifyOperationInProgress(),qr("RemoteStore","RemoteStore received new credentials"),i=Tl(r),r.Gr.add(3),e.next=6,yl(r);case 6:return i&&r.Jr.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.Gr.delete(3),e.next=12,vl(r);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(n.remoteStore,e)})),t.onlineComponents=n;case 12:case"end":return e.stop()}}),e)}))),Of.apply(this,arguments)}function Lf(e){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return qr("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,Cf(t,new bf);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)}))),Mf.apply(this,arguments)}function Pf(e){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,c.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return qr("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,Rf(t,new Tf);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)}))),Ff.apply(this,arguments)}function Vf(e){return Lf(e).then((function(e){return e.persistence}))}function Uf(e){return Lf(e).then((function(e){return e.localStore}))}function qf(e){return Pf(e).then((function(e){return e.remoteStore}))}function Bf(e){return Pf(e).then((function(e){return e.syncEngine}))}function jf(e){return Kf.apply(this,arguments)}function Kf(){return Kf=(0,c.Z)(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pf(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Th.bind(null,n.syncEngine),r.onUnlisten=Zh.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)}))),Kf.apply(this,arguments)}function zf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function i(){return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Sf({next:function(a){t.enqueueAndForget((function(){return uh(e,o)}));var s=a.docs.has(n);!s&&a.fromCache?i.reject(new Yr(Qr.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&a.fromCache&&r&&"server"===r.source?i.reject(new Yr(Qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new dh(ba(n.path),a,{includeMetadataChanges:!0,wo:!0});return oh(e,o)},i.next=3,jf(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function Gf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function i(){return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Sf({next:function(n){t.enqueueAndForget((function(){return uh(e,o)})),n.fromCache&&"server"===r.source?i.reject(new Yr(Qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),o=new dh(n,a,{includeMetadataChanges:!0,wo:!0});return oh(e,o)},i.next=3,jf(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var Hf=(0,p.Z)((function e(t,n,r,i,a,o,s,u){(0,v.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u})),Wf=function(){function e(t,n){(0,v.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,p.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}]),e}(),Qf=new Map;function Yf(e,t,n){if(!n)throw new Yr(Qr.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Xf(e,t,n,r){if(!0===t&&!0===r)throw new Yr(Qr.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function Jf(e){if(!Li.isDocumentKey(e))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function $f(e){if(Li.isDocumentKey(e))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function ed(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":zr()}function td(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Yr(Qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ed(e);throw new Yr(Qr.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function nd(e,t){if(t<=0)throw new Yr(Qr.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var rd=function(){function e(t){var n;if((0,v.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new Yr(Qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Yr(Qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Xf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return(0,p.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),id=function(){function e(t,n,r){(0,v.Z)(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rd({}),this._settingsFrozen=!1,t instanceof Wf?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Yr(Qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wf(e.options.projectId)}(t))}return(0,p.Z)(e,[{key:"app",get:function(){if(!this._app)throw new Yr(Qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new Yr(Qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new $r;switch(e.type){case"gapi":var t=e.client;return Gr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new ri(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Yr(Qr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=Qf.get(e);t&&(qr("ComponentProvider","Removing Datastore"),Qf.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function ad(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=td(e,id))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&jr("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var o,s;if("string"==typeof i.mockUserToken)o=i.mockUserToken,s=Mr.MOCK_USER;else{o=(0,b.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new Yr(Qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new Mr(u)}e._authCredentials=new ei(new Jr(o,s))}}var od=function(){function e(t,n,r){(0,v.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,p.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new ud(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),sd=function(){function e(t,n,r){(0,v.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,p.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),ud=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,ba(i)))._path=i,a.type="collection",a}return(0,p.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new od(this.firestore,null,new Li(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(sd);function cd(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,b.m9)(e),Yf("collection","path",t),e instanceof id){var a=ki.fromString.apply(ki,[t].concat(r));return $f(a),new ud(e,null,a)}if(!(e instanceof od||e instanceof ud))throw new Yr(Qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ki.fromString.apply(ki,[t].concat(r)));return $f(o),new ud(e.firestore,null,o)}function ld(e,t){if(e=td(e,id),Yf("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new sd(e,null,function(e){return new ka(ki.emptyPath(),e)}(t))}function hd(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,b.m9)(e),1===arguments.length&&(t=ci.A()),Yf("doc","path",t),e instanceof id){var a=ki.fromString.apply(ki,[t].concat(r));return Jf(a),new od(e,null,new Li(a))}if(!(e instanceof od||e instanceof ud))throw new Yr(Qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ki.fromString.apply(ki,[t].concat(r)));return Jf(o),new od(e.firestore,e instanceof ud?e.converter:null,new Li(o))}function fd(e,t){return e=(0,b.m9)(e),t=(0,b.m9)(t),(e instanceof od||e instanceof ud)&&(t instanceof od||t instanceof ud)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function dd(e,t){return e=(0,b.m9)(e),t=(0,b.m9)(t),e instanceof sd&&t instanceof sd&&e.firestore===t.firestore&&Da(e._query,t._query)&&e.converter===t.converter}var vd=function(){function e(){var t=this;(0,v.Z)(this,e),this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new sl(this,"async_queue_retry"),this.Ra=function(){var e=al();e&&qr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.ur.er()};var n=al();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Ra)}return(0,p.Z)(e,[{key:"isShuttingDown",get:function(){return this.ya}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Pa(),this.ba(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;var t=al();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ra)}}},{key:"enqueue",value:function(e){var t=this;if(this.Pa(),this.ya)return new Promise((function(){}));var n=new Xr;return this.ba((function(){return t.ya&&t.Ia?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.ga.push(e),t.va()}))}},{key:"va",value:function(){var e=(0,c.Z)(m().mark((function e(){var t=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.ga.length){e.next=14;break}return e.prev=1,e.next=4,this.ga[0]();case 4:this.ga.shift(),this.ur.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Js(e.t0)){e.next=12;break}throw e.t0;case 12:qr("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.ga.length>0&&this.ur.Zi((function(){return t.va()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"ba",value:function(e){var t=this,n=this.ma.then((function(){return t.Ea=!0,e().catch((function(e){t.Ta=e,t.Ea=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Br("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Ea=!1,e}))}));return this.ma=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Pa(),this.Aa.indexOf(e)>-1&&(t=0);var i=$l.createAndSchedule(this,e,t,n,(function(e){return r.Va(e)}));return this.pa.push(i),i}},{key:"Pa",value:function(){this.Ta&&zr()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Sa",value:function(){var e=(0,c.Z)(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ma,e.next=3,t;case 3:if(t!==this.ma){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Da",value:function(e){var t,n=(0,u.Z)(this.pa);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Ca",value:function(e){var t=this;return this.Sa().then((function(){t.pa.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=(0,u.Z)(t.pa);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.Sa()}))}},{key:"Na",value:function(e){this.Aa.push(e)}},{key:"Va",value:function(e){var t=this.pa.indexOf(e);this.pa.splice(t,1)}}]),e}();function pd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=(0,u.Z)(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e)}var yd=function(){function e(){(0,v.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new Xr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,p.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),md=-1,gd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new vd,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return(0,p.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||Id(this),this._firestoreClient.terminate()}}]),n}(id);function kd(e,t){var n=(0,g.qX)(e,"firestore");if(n.isInitialized()){var r=n.getImmediate(),i=n.getOptions();if((0,b.vZ)(i,t))return r;throw new Yr(Qr.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Yr(Qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t})}function wd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,g.Mq)();return(0,g.qX)(e,"firestore").getImmediate()}function bd(e){return e._firestoreClient||Id(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Id(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new Hf(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Df(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Ed(e,t){Rd(e=td(e,gd));var n=bd(e),r=e._freezeSettings(),i=new Tf;return xd(n,i,new If(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Td(e){Rd(e=td(e,gd));var t=bd(e),n=e._freezeSettings(),r=new Tf;return xd(t,r,new Ef(r,n.cacheSizeBytes))}function xd(e,t,n){var r=new Xr;return e.asyncQueue.enqueue((0,c.Z)(m().mark((function i(){return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Cf(e,n);case 3:return i.next=5,Rf(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===Qr.FAILED_PRECONDITION||e.code===Qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i.t0),r.reject(i.t0);case 13:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function Sd(e){if(e._initialized&&!e._terminated)throw new Yr(Qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new Xr;return e._queue.enqueueAndForgetEvenWhileRestricted((0,c.Z)(m().mark((function n(){return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Qs.bt()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Qs.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(sc(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function Ad(e){return function(e){var t=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function n(){return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=qh,n.next=3,Bf(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(bd(e=td(e,gd)))}function Zd(e){return function(e){return e.asyncQueue.enqueue((0,c.Z)(m().mark((function t(){var n,r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Vf(e);case 2:return n=t.sent,t.next=5,qf(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=Wr(e);return t.Gr.delete(0),vl(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(bd(e=td(e,gd)))}function _d(e){return function(e){return e.asyncQueue.enqueue((0,c.Z)(m().mark((function t(){var n,r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Vf(e);case 2:return n=t.sent,t.next=5,qf(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,c.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Wr(t)).Gr.add(0),e.next=4,yl(n);case 4:n.Jr.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(bd(e=td(e,gd)))}function Dd(e){return(0,g.wN)(e.app,"firestore"),e._delete()}function Cd(e,t){var n=bd(e=td(e,gd)),r=new yd;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new Af(e,t)}(function(e,t){if(e instanceof Uint8Array)return xf(e,t);if(e instanceof ArrayBuffer)return xf(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,ol(t));e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=wf,t.next=3,Bf(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function Nd(e,t){return function(e,t){return e.asyncQueue.enqueue((0,c.Z)(m().mark((function n(){return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=Wr(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Ye.getNamedQuery(e,t)}))},n.next=3,Uf(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(bd(e=td(e,gd)),t).then((function(t){return t?new sd(e,null,t.query):null}))}function Rd(e){if(e._initialized||e._terminated)throw new Yr(Qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Od=function(){function e(){(0,v.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bi(n)}return(0,p.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Ld(){return new Od("__name__")}var Md=function(){function e(t){(0,v.Z)(this,e),this._byteString=t}return(0,p.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Ti.fromBase64String(t))}catch(t){throw new Yr(Qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Ti.fromUint8Array(t))}}]),e}(),Pd=(0,p.Z)((function e(t){(0,v.Z)(this,e),this._methodName=t})),Fd=function(){function e(t,n){if((0,v.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new Yr(Qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new Yr(Qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,p.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return li(this._lat,e._lat)||li(this._long,e._long)}}]),e}(),Vd=/^__.*__$/,Ud=function(){function e(t,n,r){(0,v.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,p.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new uo(e,this.data,this.fieldMask,t,this.fieldTransforms):new so(e,this.data,t,this.fieldTransforms)}}]),e}(),qd=function(){function e(t,n,r){(0,v.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,p.Z)(e,[{key:"toMutation",value:function(e,t){return new uo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function Bd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zr()}}var jd=function(){function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.settings=t,this.databaseId=n,this.k=r,this.ignoreUndefinedProperties=i,void 0===a&&this.ka(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return(0,p.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"xa",get:function(){return this.settings.xa}},{key:"$a",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Fa",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Oa:!1});return r.Ma(e),r}},{key:"La",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Oa:!1});return r.ka(),r}},{key:"Ba",value:function(e){return this.$a({path:void 0,Oa:!0})}},{key:"Ua",value:function(e){return cv(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"ka",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}},{key:"Ma",value:function(e){if(0===e.length)throw this.Ua("Document fields must not be empty");if(Bd(this.xa)&&Vd.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}]),e}(),Kd=function(){function e(t,n,r){(0,v.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.k=r||ol(t)}return(0,p.Z)(e,[{key:"ja",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new jd({xa:e,methodName:t,Ka:n,path:bi.emptyPath(),Oa:!1,qa:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}]),e}();function zd(e){var t=e._freezeSettings(),n=ol(e._databaseId);return new Kd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Gd(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.ja(a.merge||a.mergeFields?2:0,t,n,i);av("Data must be an object, but it was:",o,r);var s,c,l=rv(r,o);if(a.merge)s=new Ii(o.fieldMask),c=o.fieldTransforms;else if(a.mergeFields){var h,f=[],d=(0,u.Z)(a.mergeFields);try{for(d.s();!(h=d.n()).done;){var v=h.value,p=ov(t,v,n);if(!o.contains(p))throw new Yr(Qr.INVALID_ARGUMENT,"Field '".concat(p,"' is specified in your field mask but missing from your input data."));lv(f,p)||f.push(p)}}catch(y){d.e(y)}finally{d.f()}s=new Ii(f),c=o.fieldTransforms.filter((function(e){return s.covers(e.field)}))}else s=null,c=o.fieldTransforms;return new Ud(new Yi(l),s,c)}var Hd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.xa)throw 1===e.xa?e.Ua("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Ua("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Pd);function Wd(e,t,n){return new jd({xa:3,Ka:t.settings.Ka,methodName:e._methodName,Oa:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}var Qd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Xa(e.path,new ja)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Pd),Yd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).Qa=r,i}return(0,p.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Wd(this,e,!0),n=this.Qa.map((function(e){return nv(e,t)})),r=new Ka(n);return new Xa(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Pd),Xd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).Qa=r,i}return(0,p.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Wd(this,e,!0),n=this.Qa.map((function(e){return nv(e,t)})),r=new Ga(n);return new Xa(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Pd),Jd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).Wa=r,i}return(0,p.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Wa(e.k,Fa(e.k,this.Wa));return new Xa(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Pd);function $d(e,t,n,r){var i=e.ja(1,t,n);av("Data must be an object, but it was:",i,r);var a=[],o=Yi.empty();yi(r,(function(e,r){var s=uv(t,e,n);r=(0,b.m9)(r);var u=i.La(s);if(r instanceof Hd)a.push(s);else{var c=nv(r,u);null!=c&&(a.push(s),o.set(s,c))}}));var s=new Ii(a);return new qd(o,s,i.fieldTransforms)}function ev(e,t,n,r,i,a){var o=e.ja(1,t,n),s=[ov(t,r,n)],u=[i];if(a.length%2!=0)throw new Yr(Qr.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)s.push(ov(t,a[c])),u.push(a[c+1]);for(var l=[],h=Yi.empty(),f=s.length-1;f>=0;--f)if(!lv(l,s[f])){var d=s[f],v=u[f];v=(0,b.m9)(v);var p=o.La(d);if(v instanceof Hd)l.push(d);else{var y=nv(v,p);null!=y&&(l.push(d),h.set(d,y))}}var m=new Ii(l);return new qd(h,m,o.fieldTransforms)}function tv(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return nv(n,e.ja(r?4:3,t))}function nv(e,t){if(iv(e=(0,b.m9)(e)))return av("Unsupported field value:",t,e),rv(e,t);if(e instanceof Pd)return function(e,t){if(!Bd(t.xa))throw t.Ua("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Ua("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Oa&&4!==t.xa)throw t.Ua("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=(0,u.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=nv(n.value,t.Ba(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(s){a.e(s)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,b.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Fa(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=di.fromDate(e);return{timestampValue:Ho(t.k,n)}}if(e instanceof di){var r=new di(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ho(t.k,r)}}if(e instanceof Fd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Md)return{bytesValue:Wo(t.k,e._byteString)};if(e instanceof od){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Ua("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Xo(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ua("Unsupported field value: ".concat(ed(e)))}(e,t)}function rv(e,t){var n={};return mi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):yi(e,(function(e,r){var i=nv(r,t.Fa(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function iv(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof di||e instanceof Fd||e instanceof Md||e instanceof od||e instanceof Pd)}function av(e,t,n){if(!iv(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=ed(n);throw"an object"===r?t.Ua(e+" a custom object"):t.Ua(e+" "+r)}}function ov(e,t,n){if((t=(0,b.m9)(t))instanceof Od)return t._internalPath;if("string"==typeof t)return uv(e,t);throw cv("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var sv=new RegExp("[~\\*/\\[\\]]");function uv(e,t,n){if(t.search(sv)>=0)throw cv("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,i.Z)(Od,(0,d.Z)(t.split(".")))._internalPath}catch(r){throw cv("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function cv(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var u="";return(a||o)&&(u+=" (found",a&&(u+=" in field ".concat(r)),o&&(u+=" in document ".concat(i)),u+=")"),new Yr(Qr.INVALID_ARGUMENT,s+e+u)}function lv(e,t){return e.some((function(e){return e.isEqual(t)}))}var hv=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,p.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new od(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new fv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(dv("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),fv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"data",value:function(){return(0,a.Z)((0,o.Z)(n.prototype),"data",this).call(this)}}]),n}(hv);function dv(e,t){return"string"==typeof t?uv(e,t):t instanceof Od?t._internalPath:t._delegate._internalPath}var vv=function(){function e(t,n){(0,v.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,p.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),pv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,s){var u;return(0,v.Z)(this,n),(u=t.call(this,e,r,i,a,s))._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return(0,p.Z)(n,[{key:"exists",value:function(){return(0,a.Z)((0,o.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new yv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(dv("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(hv),yv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.Z)((0,o.Z)(n.prototype),"data",this).call(this,e)}}]),n}(pv),mv=function(){function e(t,n,r,i){(0,v.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new vv(i.hasPendingWrites,i.fromCache),this.query=r}return(0,p.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new yv(n._firestore,n._userDataWriter,r.key,r,new vv(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Yr(Qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new yv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new vv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new yv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new vv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:gv(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function gv(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zr()}}function kv(e,t){return e instanceof pv&&t instanceof pv?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof mv&&t instanceof mv&&e._firestore===t._firestore&&dd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function wv(e){if(Ea(e)&&0===e.explicitOrderBy.length)throw new Yr(Qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bv=(0,p.Z)((function e(){(0,v.Z)(this,e)}));function Iv(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=o._apply(e)}return e}var Ev=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).Ga=e,a.za=r,a.Ha=i,a.type="where",a}return(0,p.Z)(n,[{key:"_apply",value:function(e){var t=zd(e.firestore),n=function(e,t,n,r,i,a,o){var s;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on FieldPath.documentId()."));if("in"===a||"not-in"===a){Fv(o,a);var c,l=[],h=(0,u.Z)(o);try{for(h.s();!(c=h.n()).done;){var f=c.value;l.push(Pv(r,e,f))}}catch(v){h.e(v)}finally{h.f()}s={arrayValue:{values:l}}}else s=Pv(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Fv(o,a),s=tv(n,"where",o,"in"===a||"not-in"===a);var d=ia.create(i,a,s);return function(e,t){if(t.V()){var n=xa(e);if(null!==n&&!n.isEqual(t.field))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=Ta(e);null!==r&&Vv(e,t.field,r)}var i=function(e,t){var n,r=(0,u.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(v){r.e(v)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new Yr(Qr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Yr(Qr.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,d),d}(e._query,0,t,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new sd(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(bv);function Tv(e,t,n){var r=t,i=dv("where",e);return new Ev(i,r,n)}var xv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).Ga=e,i.Ja=r,i.type="orderBy",i}return(0,p.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new pa(t,n);return function(e,t){if(null===Ta(e)){var n=xa(e);null!==n&&Vv(e,n,t.field)}}(e,r),r}(e._query,this.Ga,this.Ja);return new sd(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new ka(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(bv);function Sv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=t,r=dv("orderBy",e);return new xv(r,n)}var Av=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).type=e,a.Ya=r,a.Xa=i,a}return(0,p.Z)(n,[{key:"_apply",value:function(e){return new sd(e.firestore,e.converter,_a(e._query,this.Ya,this.Xa))}}]),n}(bv);function Zv(e){return nd("limit",e),new Av("limit",e,"F")}function _v(e){return nd("limitToLast",e),new Av("limitToLast",e,"L")}var Dv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).type=e,a.Za=r,a.tc=i,a}return(0,p.Z)(n,[{key:"_apply",value:function(e){var t=Mv(e,this.type,this.Za,this.tc);return new sd(e.firestore,e.converter,function(e,t){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(bv);function Cv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Dv("startAt",t,!0)}function Nv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Dv("startAfter",t,!1)}var Rv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).type=e,a.Za=r,a.tc=i,a}return(0,p.Z)(n,[{key:"_apply",value:function(e){var t=Mv(e,this.type,this.Za,this.tc);return new sd(e.firestore,e.converter,function(e,t){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(bv);function Ov(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Rv("endBefore",t,!0)}function Lv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Rv("endAt",t,!1)}function Mv(e,t,n,r){if(n[0]=(0,b.m9)(n[0]),n[0]instanceof hv)return function(e,t,n,r,i){if(!r)throw new Yr(Qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,o=[],s=(0,u.Z)(Aa(e));try{for(s.s();!(a=s.n()).done;){var c=a.value;if(c.field.isKeyField())o.push(ji(t,r.key));else{var l=r.data.field(c.field);if(_i(l))throw new Yr(Qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var h=c.field.canonicalString();throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(h,"' (used as the orderBy) does not exist."))}o.push(l)}}}catch(f){s.e(f)}finally{s.f()}return new da(o,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=zd(e.firestore);return function(e,t,n,r,i,a){var o=e.explicitOrderBy;if(i.length>o.length)throw new Yr(Qr.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var s=[],u=0;u<i.length;u++){var c=i[u];if(o[u].field.isKeyField()){if("string"!=typeof c)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!Sa(e)&&-1!==c.indexOf("/"))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ki.fromString(c));if(!Li.isDocumentKey(l))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new Li(l);s.push(ji(t,h))}else{var f=tv(n,r,c);s.push(f)}}return new da(s,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Pv(e,t,n){if("string"==typeof(n=(0,b.m9)(n))){if(""===n)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sa(t)&&-1!==n.indexOf("/"))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ki.fromString(n));if(!Li.isDocumentKey(r))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return ji(e,new Li(r))}if(n instanceof od)return ji(e,n._key);throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ed(n),"."))}function Fv(e,t){if(!Array.isArray(e)||0===e.length)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new Yr(Qr.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function Vv(e,t,n){if(!n.isEqual(t))throw new Yr(Qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var Uv=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Mi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ai(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Zi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw zr()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return yi(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new Fd(Ai(e.latitude),Ai(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=Di(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ci(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=Si(e);return new di(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ki.fromString(e);Gr(Es(n));var r=new Wf(n.get(1),n.get(3)),i=new Li(n.popFirst(5));return r.isEqual(t)||Br("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function qv(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Bv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,p.Z)(n,[{key:"convertBytes",value:function(e){return new Md(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new od(this.firestore,null,t)}}]),n}(Uv),jv=function(){function e(t,n){(0,v.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=zd(t)}return(0,p.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=Kv(e,this._firestore),i=qv(r.converter,t,n),a=Gd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,$a.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=Kv(e,this._firestore),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return r="string"==typeof(t=(0,b.m9)(t))||t instanceof Od?ev(this._dataReader,"WriteBatch.update",i._key,t,n,o):$d(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,$a.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=Kv(e,this._firestore);return this._mutations=this._mutations.concat(new po(t._key,$a.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new Yr(Qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function Kv(e,t){if((e=(0,b.m9)(e)).firestore!==t)throw new Yr(Qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function zv(e){e=td(e,od);var t=td(e.firestore,gd);return zf(bd(t),e._key).then((function(n){return ap(t,e,n)}))}var Gv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,p.Z)(n,[{key:"convertBytes",value:function(e){return new Md(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new od(this.firestore,null,t)}}]),n}(Uv);function Hv(e){e=td(e,od);var t=td(e.firestore,gd),n=bd(t),r=new Gv(t);return function(e,t){var n=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function r(){return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,c.Z)(m().mark((function e(t,n,r){var i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=Wr(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.Wn.Rn(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new Yr(Qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=eh(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Uf(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new pv(t,r,e._key,n,new vv(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Wv(e){e=td(e,od);var t=td(e.firestore,gd);return zf(bd(t),e._key,{source:"server"}).then((function(n){return ap(t,e,n)}))}function Qv(e){e=td(e,sd);var t=td(e.firestore,gd),n=bd(t),r=new Gv(t);return wv(e._query),Gf(n,e._query).then((function(n){return new mv(t,r,e,n)}))}function Yv(e){e=td(e,sd);var t=td(e.firestore,gd),n=bd(t),r=new Gv(t);return function(e,t){var n=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function r(){return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,c.Z)(m().mark((function e(t,n,r){var i,a,o,s,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Tc(t,n,!0);case 3:i=e.sent,a=new wh(n,i.zn),o=a.bo(i.documents),s=a.applyChanges(o,!1),r.resolve(s.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),u=eh(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(u);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Uf(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new mv(t,r,e,n)}))}function Xv(e){e=td(e,sd);var t=td(e.firestore,gd),n=bd(t),r=new Gv(t);return Gf(n,e._query,{source:"server"}).then((function(n){return new mv(t,r,e,n)}))}function Jv(e,t,n){e=td(e,od);var r=td(e.firestore,gd),i=qv(e.converter,t,n);return ip(r,[Gd(zd(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,$a.none())])}function $v(e,t,n){e=td(e,od);for(var r=td(e.firestore,gd),i=zd(r),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return ip(r,[("string"==typeof(t=(0,b.m9)(t))||t instanceof Od?ev(i,"updateDoc",e._key,t,n,o):$d(i,"updateDoc",e._key,t)).toMutation(e._key,$a.exists(!0))])}function ep(e){return ip(td(e.firestore,gd),[new po(e._key,$a.none())])}function tp(e,t){var n=td(e.firestore,gd),r=hd(e),i=qv(e.converter,t);return ip(n,[Gd(zd(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,$a.exists(!1))]).then((function(){return r}))}function np(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=(0,b.m9)(e);var s={includeMetadataChanges:!1},u=0;"object"!=typeof n[u]||pd(n[u])||(s=n[u],u++);var l,h,f,d={includeMetadataChanges:s.includeMetadataChanges};if(pd(n[u])){var v=n[u];n[u]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[u+1]=null===(a=v.error)||void 0===a?void 0:a.bind(v),n[u+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof od)h=td(e.firestore,gd),f=ba(e._key.path),l={next:function(t){n[u]&&n[u](ap(h,e,t))},error:n[u+1],complete:n[u+2]};else{var p=td(e,sd);h=td(p.firestore,gd),f=p._query;var y=new Gv(h);l={next:function(e){n[u]&&n[u](new mv(h,y,p,e))},error:n[u+1],complete:n[u+2]},wv(e._query)}return function(e,t,n,r){var i=new Sf(r),a=new dh(t,i,n);return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=oh,t.next=3,jf(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.na(),e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=uh,t.next=3,jf(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(bd(h),f,d,l)}function rp(e,t){return function(e,t){var n=new Sf(t);return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Wr(e).io.add(t),t.next()},t.next=3,jf(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.na(),e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Wr(e).io.delete(t)},t.next=3,jf(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(bd(e=td(e,gd)),pd(t)?t:{next:t})}function ip(e,t){return function(e,t){var n=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function r(){return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Dh,r.next=3,Bf(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(bd(e),t)}function ap(e,t,n){var r=n.docs.get(t._key),i=new Gv(e);return new pv(e,i,t._key,r,new vv(n.hasPendingWrites,n.fromCache),t.converter)}var op=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,p.Z)(n,[{key:"get",value:function(e){var t=this,r=Kv(e,this._firestore),i=new Gv(this._firestore);return(0,a.Z)((0,o.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new pv(t._firestore,i,r._key,e._document,new vv(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,v.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=zd(t)}return(0,p.Z)(e,[{key:"get",value:function(e){var t=this,n=Kv(e,this._firestore),r=new Bv(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return zr();var i=e[0];if(i.isFoundDocument())return new hv(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new hv(t._firestore,r,n._key,null,n.converter);throw zr()}))}},{key:"set",value:function(e,t,n){var r=Kv(e,this._firestore),i=qv(r.converter,t,n),a=Gd(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=Kv(e,this._firestore),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return r="string"==typeof(t=(0,b.m9)(t))||t instanceof Od?ev(this._dataReader,"Transaction.update",i._key,t,n,o):$d(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=Kv(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function sp(e,t){return function(e,t){var n=new Xr;return e.asyncQueue.enqueueAndForget((0,c.Z)(m().mark((function r(){var i;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e){return Pf(e).then((function(e){return e.datastore}))}(e);case 2:i=r.sent,new _f(e.asyncQueue,i,t,n).run();case 4:case"end":return r.stop()}}),r)})))),n.promise}(bd(e=td(e,gd)),(function(n){return t(new op(e,n))}))}function up(){return new Hd("deleteField")}function cp(){return new Qd("serverTimestamp")}function lp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Yd("arrayUnion",t)}function hp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Xd("arrayRemove",t)}function fp(e){return new Jd("increment",e)}function dp(e){return bd(e=td(e,gd)),new jv(e,(function(t){return ip(e,t)}))}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Pr=e}(g.Jn),(0,g.Xd)(new k.wA("firestore",(function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new gd(i,new ti(e.getProvider("auth-internal")),new ai(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC")),(0,g.KN)(Lr,"3.4.1",e),(0,g.KN)(Lr,"3.4.1","esm2017")}()},7762:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(181);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,r.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}},1752:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(1120);function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}function a(){return a="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=i(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(this,arguments)}},6085:function(e,t,n){n.d(t,{ZR:function(){return d.ZR},Jn:function(){return N},l4:function(){return g},H9:function(){return I},Vr:function(){return E},Af:function(){return w},Z8:function(){return A},lz:function(){return b},qX:function(){return x},Xd:function(){return T},wN:function(){return S},P2:function(){return M},Mq:function(){return O},C6:function(){return L},ZF:function(){return R},TP:function(){return V},KN:function(){return F},Ub:function(){return U}});var r,i,a=n(5861),o=n(7762),s=n(4942),u=n(5671),c=n(3144),l=n(7757),h=n(2339),f=n(2413),d=n(4766),v=function(){function e(t){(0,u.Z)(this,e),this.container=t}return(0,c.Z)(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var p="@firebase/app",y="0.7.11",m=new f.Yd("@firebase/app"),g="[DEFAULT]",k=(r={},(0,s.Z)(r,p,"fire-core"),(0,s.Z)(r,"@firebase/app-compat","fire-core-compat"),(0,s.Z)(r,"@firebase/analytics","fire-analytics"),(0,s.Z)(r,"@firebase/analytics-compat","fire-analytics-compat"),(0,s.Z)(r,"@firebase/app-check","fire-app-check"),(0,s.Z)(r,"@firebase/app-check-compat","fire-app-check-compat"),(0,s.Z)(r,"@firebase/auth","fire-auth"),(0,s.Z)(r,"@firebase/auth-compat","fire-auth-compat"),(0,s.Z)(r,"@firebase/database","fire-rtdb"),(0,s.Z)(r,"@firebase/database-compat","fire-rtdb-compat"),(0,s.Z)(r,"@firebase/functions","fire-fn"),(0,s.Z)(r,"@firebase/functions-compat","fire-fn-compat"),(0,s.Z)(r,"@firebase/installations","fire-iid"),(0,s.Z)(r,"@firebase/installations-compat","fire-iid-compat"),(0,s.Z)(r,"@firebase/messaging","fire-fcm"),(0,s.Z)(r,"@firebase/messaging-compat","fire-fcm-compat"),(0,s.Z)(r,"@firebase/performance","fire-perf"),(0,s.Z)(r,"@firebase/performance-compat","fire-perf-compat"),(0,s.Z)(r,"@firebase/remote-config","fire-rc"),(0,s.Z)(r,"@firebase/remote-config-compat","fire-rc-compat"),(0,s.Z)(r,"@firebase/storage","fire-gcs"),(0,s.Z)(r,"@firebase/storage-compat","fire-gcs-compat"),(0,s.Z)(r,"@firebase/firestore","fire-fst"),(0,s.Z)(r,"@firebase/firestore-compat","fire-fst-compat"),(0,s.Z)(r,"fire-js","fire-js"),(0,s.Z)(r,"firebase","fire-js-all"),r),w=new Map,b=new Map;function I(e,t){try{e.container.addComponent(t)}catch(n){m.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function E(e,t){e.container.addOrOverwriteComponent(t)}function T(e){var t=e.name;if(b.has(t))return m.debug("There were multiple attempts to register component ".concat(t,".")),!1;b.set(t,e);var n,r=(0,o.Z)(w.values());try{for(r.s();!(n=r.n()).done;){I(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function x(e,t){return e.container.getProvider(t)}function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;x(e,t).clearInstance(n)}function A(){b.clear()}var Z,_=(i={},(0,s.Z)(i,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),(0,s.Z)(i,"bad-app-name","Illegal App name: '{$appName}"),(0,s.Z)(i,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),(0,s.Z)(i,"app-deleted","Firebase App named '{$appName}' already deleted"),(0,s.Z)(i,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),(0,s.Z)(i,"invalid-log-argument","First argument to `onLog` must be null or a function."),i),D=new d.LL("app","Firebase",_),C=function(){function e(t,n,r){var i=this;(0,u.Z)(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new h.wA("app",(function(){return i}),"PUBLIC"))}return(0,c.Z)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw D.create("app-deleted",{appName:this._name})}}]),e}(),N="9.6.1";function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==typeof t){var n=t;t={name:n}}var r=Object.assign({name:g,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw D.create("bad-app-name",{appName:String(i)});var a=w.get(i);if(a){if((0,d.vZ)(e,a.options)&&(0,d.vZ)(r,a.config))return a;throw D.create("duplicate-app",{appName:i})}var s,u=new h.H0(i),c=(0,o.Z)(b.values());try{for(c.s();!(s=c.n()).done;){var l=s.value;u.addComponent(l)}}catch(v){c.e(v)}finally{c.f()}var f=new C(e,r,u);return w.set(i,f),f}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=w.get(e);if(!t)throw D.create("no-app",{appName:e});return t}function L(){return Array.from(w.values())}function M(e){return P.apply(this,arguments)}function P(){return P=(0,a.Z)(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,!w.has(n)){e.next=6;break}return w.delete(n),e.next=5,Promise.all(t.container.getProviders().map((function(e){return e.delete()})));case 5:t.isDeleted=!0;case 6:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}function F(e,t,n){var r,i=null!==(r=k[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void m.warn(s.join(" "))}T(new h.wA("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}function V(e,t){if(null!==e&&"function"!==typeof e)throw D.create("invalid-log-argument");(0,f.Am)(e,t)}function U(e){(0,f.Ub)(e)}Z="",T(new h.wA("platform-logger",(function(e){return new v(e)}),"PRIVATE")),F(p,y,Z),F(p,y,"esm2017"),F("fire-js","")},2339:function(e,t,n){n.d(t,{wA:function(){return h},H0:function(){return v}});var r=n(3433),i=n(5861),a=n(9439),o=n(7762),s=n(5671),u=n(3144),c=n(7757),l=n(4766),h=function(){function e(t,n,r){(0,s.Z)(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return(0,u.Z)(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),f="[DEFAULT]",d=function(){function e(t,n){(0,s.Z)(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return(0,u.Z)(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new l.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:f})}catch(l){}var t,n=(0,o.Z)(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,a.Z)(t.value,2),i=r[0],s=r[1],u=this.normalizeInstanceIdentifier(i);try{var c=this.getOrInitializeService({instanceIdentifier:u});s.resolve(c)}catch(l){}}}catch(h){n.e(h)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=(0,i.Z)(c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat((0,r.Z)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),(0,r.Z)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,s=this.getOrInitializeService({instanceIdentifier:r,options:n}),u=(0,o.Z)(this.instancesDeferred.entries());try{for(u.s();!(i=u.n()).done;){var c=(0,a.Z)(i.value,2),l=c[0],h=c[1],f=this.normalizeInstanceIdentifier(l);r===f&&h.resolve(s)}}catch(d){u.e(d)}finally{u.f()}return s}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(s){}}}catch(u){i.e(u)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===f?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.component?this.component.multipleInstances?e:f:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var v=function(){function e(t){(0,s.Z)(this,e),this.name=t,this.providers=new Map}return(0,u.Z)(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new d(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}()},2413:function(e,t,n){n.d(t,{in:function(){return i},Yd:function(){return v},Ub:function(){return p},Am:function(){return y}});var r,i,a=n(7762),o=n(5671),s=n(3144),u=n(4942),c=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));var l={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},h=i.INFO,f=(r={},(0,u.Z)(r,i.DEBUG,"log"),(0,u.Z)(r,i.VERBOSE,"log"),(0,u.Z)(r,i.INFO,"info"),(0,u.Z)(r,i.WARN,"warn"),(0,u.Z)(r,i.ERROR,"error"),r),d=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=f[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},v=function(){function e(t){(0,o.Z)(this,e),this.name=t,this._logLevel=h,this._logHandler=d,this._userLogHandler=null,c.push(this)}return(0,s.Z)(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?l[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.DEBUG].concat(t)),this._logHandler.apply(this,[this,i.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.VERBOSE].concat(t)),this._logHandler.apply(this,[this,i.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.INFO].concat(t)),this._logHandler.apply(this,[this,i.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.WARN].concat(t)),this._logHandler.apply(this,[this,i.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.ERROR].concat(t)),this._logHandler.apply(this,[this,i.ERROR].concat(t))}}]),e}();function p(e){c.forEach((function(t){t.setLogLevel(e)}))}function y(e,t){var n,r=(0,a.Z)(c);try{var o=function(){var r=n.value,a=null;t&&t.level&&(a=l[t.level]),r.userLogHandler=null===e?null:function(t,n){for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];var u=o.map((function(e){if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!==a&&void 0!==a?a:t.logLevel)&&e({level:i[n].toLowerCase(),message:u,args:o,type:t.name})}};for(r.s();!(n=r.n()).done;)o()}catch(s){r.e(s)}finally{r.f()}}}}]);